

namespace = yemotaferi

# Starting Event
country_event = {
	id = yemotaferi.1
	title = yemotaferi.1.t
	desc = yemotaferi.1.d
	picture = DIPLOMACY_SIGNING_eventPicture
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		tag = S50
	}

	option = {
		name = yemotaferi.1.a
		hidden_effect = {
			set_country_flag = S50_council_of_wardens_unlocked
		}
		add_government_reform = yemotaferi_council_of_wardens
	}
}

# Heir Selection
country_event = {
	id = yemotaferi.2
	title = yemotaferi.2.t
	desc = yemotaferi.2.d
	picture = DIPLOMAT_INTERROGATION_eventPicture
	is_triggered_only = yes

	trigger = {
		OR = {
			has_reform = yemotaferi_council_of_wardens_rangers
			has_reform = yemotaferi_council_of_wardens
		}
	}

	# Scholar Candidate
	option = {
		name = yemotaferi.2.a

		if = {
			limit = { has_government_attribute = can_see_theocratic_heir_stats }
			define_heir = {
				age = 55
				max_random_adm = 2
				max_random_dip = 2
				max_random_mil = 2
				change_adm = 4
				change_dip = 2
				change_mil = 2
			}
		}
		else = {
			define_heir = {
				age = 55
				max_random_adm = 2
				max_random_dip = 2
				max_random_mil = 2
				change_adm = 4
				change_dip = 2
				change_mil = 2
				hide_skills = yes
			}
		}

		if = {
			limit = {
				has_country_flag = S50_improved_scholar_candidate
			}
			custom_tooltip = S50_scholar_candidate_personality_tt
			hidden_effect = {
				random_list = {
					1 = { add_heir_personality = scholar_personality }
					1 = { add_heir_personality = industrious_personality }
					1 = { add_heir_personality = well_connected_personality }
				}
			}
		}
	}

	# Deathsworn Candidate
	option = {
		name = yemotaferi.2.b

		if = {
			limit = { has_government_attribute = can_see_theocratic_heir_stats }
			define_heir = {
				age = 55
				max_random_adm = 2
				max_random_dip = 2
				max_random_mil = 2
				change_adm = 2
				change_dip = 2
				change_mil = 4
			}
		}
		else = {
			define_heir = {
				age = 55
				max_random_adm = 2
				max_random_dip = 2
				max_random_mil = 2
				change_adm = 2
				change_dip = 2
				change_mil = 4
				hide_skills = yes
			}
		}

		if = {
			limit = {
				has_country_flag = S50_improved_deathsworn_candidate
			}
			custom_tooltip = S50_deathsworn_candidate_personality_tt
			hidden_effect = {
				random_list = {
					1 = { add_heir_personality = strict_personality }
					1 = { add_heir_personality = martial_educator_personality }
					1 = { add_heir_personality = kind_hearted_personality }
				}
			}
		}
	}

	# Rain-Priest Candidate
	option = {
		name = yemotaferi.2.c

		if = {
			limit = { has_government_attribute = can_see_theocratic_heir_stats }
			define_heir = {
				age = 30
				max_random_adm = 3
				max_random_dip = 3
				max_random_mil = 3
			}
		}
		else = {
			define_heir = {
				age = 30
				max_random_adm = 3
				max_random_dip = 3
				max_random_mil = 3
				hide_skills  = yes
			}
		}

		if = {
			limit = {
				has_country_flag = S50_improved_rain_priest_candidate
			}
			define_powerful_mage = { type = heir bonus = 1 }
		}
		else = {
			define_powerful_mage = { type = heir}
		}
	}

	# Shadow Planetouched Candidate
	option = {
		trigger = {
			custom_trigger_tooltip = {
				tooltip = S50_shadow_planetouched_heir_is_available_tt
				has_country_flag = S50_shadow_planetouched_heir_available
			}
			
		}
		highlight = yes
		name = yemotaferi.2.e

		if = {
			limit = { has_government_attribute = can_see_theocratic_heir_stats }
			define_heir = {
				age = 55
				max_random_adm = 2
				max_random_dip = 2
				max_random_mil = 2
				change_adm = 4
				change_dip = 4
				change_mil = 4
			}
		}
		else = {
			define_heir = {
				age = 55
				max_random_adm = 2
				max_random_dip = 2
				max_random_mil = 2
				change_adm = 4
				change_dip = 4
				change_mil = 4
				hide_skills  = yes
			}
		}

		add_heir_personality = shadow_planetouched_personality
	}

	after = {
		hidden_effect = {
			clr_country_flag = S50_shadow_planetouched_heir_available
		}
	}
}

# Pick Parrot or Goose to unite as your vassal
country_event = {
	id = yemotaferi.3
	title = yemotaferi.3.t
	desc = yemotaferi.3.d
	picture = DIPLOMACY_eventPicture
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			S43 = {
				remove_country_modifier = S50_tanizu_rebellious_spirit
			}
			S42 = {
				remove_country_modifier = S50_tanizu_rebellious_spirit
			}
		}
	}

	# Parrot
	option = {
		name = yemotaferi.3.a
		S42 = {
			inherit = S43
		}
		vassalize = S42
		muukombi_area = {
			add_permanent_claim = S42
		}
		gakeigiti_area = {
			add_permanent_claim = S42
		}
		hidden_effect = {
			S42 = {
				change_religion = beast_memory
			}
		}
	}

	# Goose
	option = {
		name = yemotaferi.3.b
		S43 = {
			inherit = S42
		}
		vassalize = S43
		muukombi_area = {
			add_permanent_claim = S43
		}
		gakeigiti_area = {
			add_permanent_claim = S43
		}
		hidden_effect = {
			S43 = {
				change_religion = beast_memory
			}
		}
	}
}

# Migrate to the swamp
country_event = {
	id = yemotaferi.4
	title = yemotaferi.4.t
	desc = yemotaferi.4.d
	picture = STRELTSY_MARCHING_eventPicture
	is_triggered_only = yes

	option = {
		name = yemotaferi.4.a

		custom_tooltip = S50_migration_effect_tt
		hidden_effect = {
			every_owned_province = {
				limit = {
					is_core = ROOT
					NOT = { region = shadow_swamp_region }
					NOT = {
						# Exclude the two starting provinces.
						OR = {
							province_id = 5616
							province_id = 5617
						}
					}
				}

				ROOT = {
                    export_to_variable = {
                        which = migrateDevTaxTemp
                        value = base_tax
                        who = PREV
                    }
                    subtract_variable = { which = migrateDevTaxTemp value = 1 }
                    change_variable = { which = migrateDevTax which = migrateDevTaxTemp }

					export_to_variable = {
                        which = migrateDevManpowerTemp
                        value = base_manpower
                        who = PREV
                    }
                    subtract_variable = { which = migrateDevManpowerTemp value = 1 }
                    change_variable = { which = migrateDevManpower which = migrateDevManpowerTemp }

					export_to_variable = {
                        which = migrateDevProductionTemp
                        value = base_production
                        who = PREV
                    }
                    subtract_variable = { which = migrateDevProductionTemp value = 1 }
                    change_variable = { which = migrateDevProduction which = migrateDevProductionTemp }
                }

				set_base_tax = 1
				set_base_production = 1
				set_base_manpower = 1

				
				if = {
					limit = {
						any_core_country = {
							NOT = {
								tag = L66
								tag = S70 
								tag = S65
								tag = ROOT								
							}
						}
					}
					random_core_country = {
						limit = {
							NOT = {
								tag = L66
								tag = S70 
								tag = S65
								tag = ROOT								
							}	
						}
						save_event_target_as = tag_to_cede_to
					}
				}
				else_if = {
					limit = {
						any_neighbor_province = {
							owner = {
								culture_group = mengi
								NOT = {
									tag = L66
									tag = S65
									tag = ROOT								
								}
							}
						}
					}
					random_neighbor_province = {
						limit = {
							owner = {
								culture_group = mengi
								NOT = {
									tag = L66
									tag = S65
									tag = ROOT								
								}
							}
						}
						owner = { save_event_target_as = tag_to_cede_to }
					}
				}
				else = {
					ROOT = {
						random_neighbor_country = {
							limit = {
								culture_group = mengi
								NOT = {
									tag = L66
									tag = S65							
								}
							}
							save_event_target_as = tag_to_cede_to
						}
					}
				}

				if = {
					limit = { has_saved_event_target = tag_to_cede_to }
					cede_province = event_target:tag_to_cede_to
					remove_core = ROOT
				}
			}

			while = {
				limit = { check_variable = { migrateDevTax = 1 } }
				subtract_variable = { migrateDevTax = 1 }
				random_owned_province = {
					add_base_tax = 1
				}
			}

			while = {
				limit = { check_variable = { migrateDevProduction = 1 } }
				subtract_variable = { migrateDevProduction = 1 }
				random_owned_province = {
					add_base_production = 1
				}
			}

			while = {
				limit = { check_variable = { migrateDevManpower = 1 } }
				subtract_variable = { migrateDevManpower = 1 }
				random_owned_province = {
					add_base_manpower = 1
				}
			}
		}


		6718 = {
			add_devastation = -20
			if = {
				limit = {
					NOT = {
						has_great_project = {
							type = hawatli_wizti_tali
							tier = 2
						}
					}
				}
			
				add_great_project_tier = {
					type = hawatli_wizti_tali
					tier = 1
				}
			}
		}

		set_capital = 6718
	}
}

# Rage Against the Dying of the Night
country_event = {
	id = yemotaferi.5
	title = yemotaferi.5.t
	desc = yemotaferi.5.d
	picture = COMBINED_HAGS_eventPicture
	is_triggered_only = yes

	option = {
		name = yemotaferi.5.a

		hidden_effect = {
			africa = {
				limit = {
					owner = {
						ai = yes
					}
				}
				if = {
					limit = {
						is_core = F68
						NOT = { owned_by = F68 }
					}
					cede_province = F68
				}
				else_if = {
					limit = {
						is_core = F71
						NOT = { owned_by = F71 }
					}
					cede_province = F71
				}
				else_if = {
					limit = {
						is_core = L66
						NOT = { owned_by = L66 }
					}
					cede_province = L66
				}
				else_if = {
					limit = {
						culture = echenka
						NOT = { owned_by = F68 }
					}
					cede_province = F68
					add_core = F68
				}
				else_if = {
					limit = {
						culture = fieldstalker_gnoll
						OR = {
							religion = xhazobkult
							religion = shadow_pact
						}
						NOT = { owned_by = F71 }
					}
					cede_province = F71
					add_core = F71
				}
			}
		}

		if = {
			limit = {
				exists = S70
			}
			S70 = {
				declare_war_with_cb = {
					who = ROOT
					casus_belli = cb_annex
				}
			}
			L66 = { join_all_offensive_wars_of = S70 }
			F71 = { join_all_offensive_wars_of = S70 }
			F68 = { join_all_offensive_wars_of = S70 }

			hidden_effect = {
				S70 = { 
					add_country_modifier = {
						name = S50_shadow_fervour
						duration = 3650
					}
					capital_scope = {
						build_to_forcelimit = {
							infantry = 0.7
							artillery = 0.3
						}
					}
					add_treasury = 1000
				}
			}

		}
		else = {
			L66 = {
				declare_war_with_cb = {
					who = ROOT
					casus_belli = cb_annex
				}
			}
			F71 = { join_all_offensive_wars_of = L66 }
			F68 = { join_all_offensive_wars_of = L66 }
		}
		custom_tooltip = empty_line_tt
		L66 = { 
			hidden_effect = {
				add_country_modifier = {
					name = S50_shadow_fervour
					duration = 3650
				}
				capital_scope = {
					build_to_forcelimit = {
						infantry = 0.7
						artillery = 0.3
					}
				}	
				add_treasury = 1000		
			}

			define_war_wizard = { name = "Komina Riftwhisper" level = 3 female = yes}
		}
		F71 = { 
			hidden_effect = {
				add_country_modifier = {
					name = S50_shadow_fervour
					duration = 3650
				}
				capital_scope = {
					build_to_forcelimit = {
						infantry = 0.7
						artillery = 0.3
					}
				}	
				add_treasury = 1000		
			}
			define_war_wizard = { name = "Ilfanill Gloomweaver" level = 3 female = yes}
		}
		F68 = { 
			hidden_effect = {
				add_country_modifier = {
					name = S50_shadow_fervour
					duration = 3650
				}
				capital_scope = {
					build_to_forcelimit = {
						infantry = 0.7
						artillery = 0.3
					}
				}	
				add_treasury = 1000		
			}
			define_war_wizard = { name = "Hireet Smoketusk" level = 3 female = yes}
		}

		custom_tooltip = empty_line_tt
		custom_tooltip = S50_shadow_fervour_tt
		tooltip = {
			S70 = {
				add_country_modifier = {
					name = S50_shadow_fervour
					duration = 3650
				}
			}

		}

		custom_tooltip = S50_final_war_claims_tt
		hidden_effect = {
			set_country_flag = S50_final_hag_war

			every_war_enemy_country = {
				limit = {
					OR = {
						tag = S70
						tag = F71
						tag = F68
						tag = L66
					}
				}
				every_owned_province = {
					add_permanent_claim = ROOT
				}
			}
		}

		
	}
}

# Shattered and Scattered
country_event = {
	id = yemotaferi.6
	title = yemotaferi.6.t
	desc = yemotaferi.6.d
	picture = AFRICAN_BATTLE_eventPicture
	is_triggered_only = yes

	option = {
		name = yemotaferi.6.a
		add_prestige_or_monarch_power = { amount = 100 }

		add_stability_or_adm_power = yes
		add_stability_or_adm_power = yes
		add_stability_or_adm_power = yes

		custom_tooltip = S50_hag_slayer_opinion_tt
		hidden_effect = {
			every_known_country = {
				limit = {
					capital_scope = {
						continent = africa
					}
					NOT = {
						tag = L66
						tag = F71
						tag = F68
						tag = S70
					}
				}
				add_opinion = {
					who = ROOT
					modifier = S50_shattered_hag_coven
				}
			}
		}

		add_country_modifier = {
			name = S50_hag_slayers
			duration = -1
		}

		F71 = {
			kill_leader = { type = "Ilfanill Gloomweaver" }
		}

		hidden_effect = {
			F68 = {
				kill_leader = { type = "Hireet Smoketusk" }
			}
			L66 = {
				kill_leader = { type = "Komina Riftwhisper" }
			}
		}
	}
}

# Soothing her Pain
country_event = {
	id = yemotaferi.7
	title = yemotaferi.7.t
	desc = yemotaferi.7.d
	picture = MAGE_MOON_eventPicture
	is_triggered_only = yes

	option = {
		name = yemotaferi.7.a

		6690 = {
			add_province_modifier = {
				name = S50_shrine_of_shadowroot
				duration = -1
			}
		}

		custom_tooltip = S50_unlocked_bless_the_rivers_tt
		hidden_effect = {
			set_country_flag = S50_unlocked_bless_the_rivers
		}

	}
}

# Lines on a Map
country_event = {
	id = yemotaferi.8
	title = yemotaferi.8.t
	desc = yemotaferi.8.d
	picture = COASTLINE_MAP_eventPicture
	is_triggered_only = yes

	option = {
		name = yemotaferi.8.a

		custom_tooltip = S50_partition_fields_tt
		custom_tooltip = empty_line_tt
		hidden_effect = {
			every_owned_or_subject_province = {
				limit = {
					OR = {
						region = far_salahad_region
						region = gazraak_region
						region = dreksaret_region
					}

				}

				cede_province = F72
				add_core = F72
			}

			every_owned_or_subject_province = {
				limit = {
					OR = {
						region = gol_region
						region = khetapera_region
					}
				}

				cede_province = F68
				add_core = F68
			}
		}

		F68 = {
			large_increase_of_gnollish_tolerance_effect = yes
			anb_add_accepted_culture_or_dip_power = { culture = fieldstalker_gnoll free = yes }
			
			custom_tooltip = empty_line_tt
			custom_tooltip = S50_rombeni_mages_of_muhaqaar_tt
			hidden_effect = {
				set_country_flag = S50_rombeni_mages_of_muhaqaar
			}

			hidden_effect = {
				change_variable = {
					which = gnollish_race_tolerance_ai
					value = 100
				}
			}
		}

		F72 = {
			large_increase_of_human_tolerance_effect = yes
			anb_add_accepted_culture_or_dip_power = { culture = echenka free = yes }
			hidden_effect = {
				change_variable = {
					which = human_race_tolerance_ai
					value = 100
				}
			}
		}

		hidden_effect = {
			# Vassalize in case they weren't yet or didn't exist yet
			vassalize = F72
			vassalize = F68
		}

		custom_tooltip = empty_line_tt
		change_government_reform_progress = 200
		add_prestige_or_monarch_power = { amount = 50 }
		add_stability_or_adm_power = yes
	}
}

# The Beating Heart of Sarhal
country_event = {
	id = yemotaferi.9
	title = yemotaferi.9.t
	desc = yemotaferi.9.d
	picture = SARHEL_MENGI_TEMPLE_eventPicture
	is_triggered_only = yes

	option = {
		name = yemotaferi.9.a
		hidden_effect = {
			remove_country_modifier = S50_league_of_light_1
		}
		add_country_modifier = {
			name = S50_league_of_light_2
			duration = -1
		}

		add_power_projection = { 
			type = 25_permanent_power_projection
			amount = 25 
		}
	}
}

# Sacred Studies Religious Action
country_event = {
	id = yemotaferi.10
	title = yemotaferi.10.t
	desc = yemotaferi.10.d
	picture = MUSLIM_SCHOLAR_WRITING_eventPicture
	is_triggered_only = yes

	option = {
		name = yemotaferi.10.a
		highlight = yes
		trigger = {
			employed_advisor = { category = ADM }
		}

		change_innovativeness = 5
		S50_sacred_studies_effect = { type = tax }
		if = { limit = { has_adm_advisor_2 = yes } S50_sacred_studies_effect = { type = tax } } 
		if = { limit = { has_adm_advisor_3 = yes } S50_sacred_studies_effect = { type = tax } } 
		if = { limit = { has_adm_advisor_4 = yes } S50_sacred_studies_effect = { type = tax } } 
		if = { limit = { has_adm_advisor_5 = yes } S50_sacred_studies_effect = { type = tax } } 
	}

	option = {
		name = yemotaferi.10.b
		highlight = yes
		trigger = {
			employed_advisor = { category = DIP }
		}

		change_innovativeness = 5
		S50_sacred_studies_effect = { type = production }
		if = { limit = { has_dip_advisor_2 = yes } S50_sacred_studies_effect = { type = production } } 
		if = { limit = { has_dip_advisor_3 = yes } S50_sacred_studies_effect = { type = production } } 
		if = { limit = { has_dip_advisor_4 = yes } S50_sacred_studies_effect = { type = production } } 
		if = { limit = { has_dip_advisor_5 = yes } S50_sacred_studies_effect = { type = production } } 
	}

	option = {
		name = yemotaferi.10.c
		highlight = yes
		trigger = {
			employed_advisor = { category = MIL }
		}
		
		change_innovativeness = 5
		S50_sacred_studies_effect = { type = manpower }
		if = { limit = { has_mil_advisor_2 = yes } S50_sacred_studies_effect = { type = manpower } } 
		if = { limit = { has_mil_advisor_3 = yes } S50_sacred_studies_effect = { type = manpower } } 
		if = { limit = { has_mil_advisor_4 = yes } S50_sacred_studies_effect = { type = manpower } } 
		if = { limit = { has_mil_advisor_5 = yes } S50_sacred_studies_effect = { type = manpower } } 

	}
}

# Approach the Treshold Religious Action
country_event = {
	id = yemotaferi.11
	title = yemotaferi.11.t
	desc = yemotaferi.11.d
	picture = MAGE_MOON_ALTER_eventPicture
	is_triggered_only = yes

	option = {
		name = yemotaferi.11.a
		
		add_country_modifier = {
			name = S50_steeped_in_shadow
			duration = 3650
		}

		custom_tooltip = S50_shadow_planetouched_heir_available_tt
		hidden_effect = {
			set_country_flag = S50_shadow_planetouched_heir_available
			add_country_modifier = {
				name = S50_approach_threshold_cooldown_mod
				duration = 9125
				hidden = yes
			}
		}

	}
}

# Bless the Rivers Religious Action
country_event = {
	id = yemotaferi.12
	title = yemotaferi.12.t
	desc = yemotaferi.12.d
	picture = PRAYING_eventPicture
	is_triggered_only = yes

	option = {
		name = yemotaferi.12.a
		
		down_river_from_shadow = {
			limit = {
				OR = {
					country_or_subject_holds = ROOT
					owner = {
						alliance_with = ROOT
					}
				}
			}
			add_province_modifier = {
				name = S50_flourishing_riverbank
				duration = 3650
			}

			add_prosperity = 25
		}
	}
}

# Hidden event to update advisor modifiers
country_event = {
	id = yemotaferi.13
	title = yemotaferi.13.t
	desc = yemotaferi.13.d
	picture = ADVISOR_eventPicture
	is_triggered_only = yes
	hidden = yes

	option = {
		name = yemotaferi.13.a
		
		S50_add_advisor_modifiers_effect = yes
	}
}
