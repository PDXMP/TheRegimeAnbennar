open_stormwall = {
	4774 = {
		if = {
			limit = { NOT = { has_global_flag = stormwall_open } }
			3580 = { add_canal = stormwall_canal }
			3582 = { add_canal = stormwall_canal }
			1621 = { add_canal = stormwall_canal }
			3559 = { add_canal = stormwall_canal }
			3615 = { add_canal = stormwall_canal }
			3616 = { add_canal = stormwall_canal }
			3619 = { add_canal = stormwall_canal }
			3618 = { add_canal = stormwall_canal }
			3624 = { add_canal = stormwall_canal }
			3622 = { add_canal = stormwall_canal }
			6905 = { add_canal = stormwall_canal }
			6859 = { add_canal = stormwall_canal }
			set_global_flag = stormwall_open
		}
		if = {
			limit = { NOT = { has_global_flag = endless_ocean_first_opening } }
			every_country = {
				limit = { religion = endless_ocean }
				country_event = {
					id = endless_ocean_events.100
				}
			}
			set_global_flag = endless_ocean_first_opening
		}
		
	}
}

close_stormwall = {
	hidden_effect = {
		4774 = {
			if = {
				limit = { has_global_flag = stormwall_open }
				3580 = { remove_canal = stormwall_canal }
				3582 = { remove_canal = stormwall_canal }
				1621 = { remove_canal = stormwall_canal }
				3559 = { remove_canal = stormwall_canal }
				3615 = { remove_canal = stormwall_canal }
				3616 = { remove_canal = stormwall_canal }
				3619 = { remove_canal = stormwall_canal }
				3618 = { remove_canal = stormwall_canal }
				3624 = { remove_canal = stormwall_canal }
				3622 = { remove_canal = stormwall_canal }
				6905 = { remove_canal = stormwall_canal }
				6859 = { remove_canal = stormwall_canal }
				clr_global_flag = stormwall_open
			}
		}
	}
}

golodh_wanders = {
	custom_tooltip = golodh_wanders_tt
	# migrate to neighboring province if possible
	hidden_effect = {
		if = {
			limit = { 3517 = { has_province_modifier = golodh_wandering } }
			3517 = { remove_province_modifier = golodh_wandering }
			golodh_wanders_to_province = { province = 3518 }
		}
		else_if = {
			limit = { 3518 = { has_province_modifier = golodh_wandering } }
			3518 = { remove_province_modifier = golodh_wandering }
			random = {
				chance = 50
				set_global_flag = golodh_wanders_to_3517
			}
			if = {
				limit = {
					has_global_flag = golodh_wanders_to_3517
					3517 = {
						OR = {
							is_empty = yes
							owner = { NOT = { has_country_flag = met_golodh } }
						}
					}
				}
				golodh_wanders_to_province = { province = 3517 }
			}
			else_if = {
				limit = {
					3519 = {
						OR = {
							is_empty = yes
							owner = { NOT = { has_country_flag = met_golodh } }
						}
					}
				}
				golodh_wanders_to_province = { province = 3519 }
			}
		}
		else_if = {
			limit = { 3519 = { has_province_modifier = golodh_wandering } }
			3519 = { remove_province_modifier = golodh_wandering }
			golodh_wanders_to_province = { province = 3518 }
		}
	}
}

golodh_wanders_to_province = {
	# separate scripted effect to circumvent the else_if bug
	$province$ = {
		if = {
			limit = {
				OR = {
					is_empty = yes
					owner = { NOT = { has_country_flag = met_golodh } }
				}
			}
			add_permanent_province_modifier = { name = golodh_wandering duration = -1 }
			province_event = { id = insyaa_flavour.11 }
		}
	}
}


utubodi_unification_add_resource = {
	if = {
		limit = { trade_goods = grain }
		FROM = {
			change_variable = {
				which = utubodiKakunorGrainVar
				value = 1
			}
		}
	}
	else_if = {
		limit = { trade_goods = livestock }
		FROM = {
			change_variable = {
				which = utubodiKakunorLivestockVar
				value = 1
			}
		}
	}
	else_if = {
		limit = { trade_goods = wool }
		FROM = {
			change_variable = {
				which = utubodiKakunorWoolVar
				value = 1
			}
		}
	}
	else_if = {
		limit = { trade_goods = tropical_wood }
		FROM = {
			change_variable = {
				which = utubodiKakunorExWoodVar
				value = 1
			}
		}
	}
	else_if = {
		limit = { trade_goods = cloth }
		FROM = {
			change_variable = {
				which = utubodiKakunorClothVar
				value = 1
			}
		}
	}
	else_if = {
		limit = { trade_goods = iron }
		FROM = {
			change_variable = {
				which = utubodiKakunorIronVar
				value = 1
			}
		}
	}
	else_if = {
		limit = { trade_goods = incense }
		FROM = {
			change_variable = {
				which = utubodiKakunorIncenseVar
				value = 1
			}
		}
	}
	else_if = {
		limit = { trade_goods = fur }
		FROM = {
			change_variable = {
				which = utubodiKakunorFurVar
				value = 1
			}
		}
	}
	else_if = {
		limit = { trade_goods = copper }
		FROM = {
			change_variable = {
				which = utubodiKakunorCopperVar
				value = 1
			}
		}
	}
	else_if = {
		limit = { trade_goods = damestear }
		FROM = {
			change_variable = {
				which = utubodiKakunorDamestearVar
				value = 1
			}
		}
	}
}

utubodi_unification_spawn_rebels_particularist = {
	if = {
		limit = { has_province_flag = utubodi_rebels_7_flag }
		for = {
			amount = 8
			effect = "
				spawn_rebels = {
					type = particularist_rebels
					size = 3
				}"
		}
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_6_flag
			NOT = { has_province_flag = utubodi_rebels_7_flag }
		}
		for = {
			amount = 7
			effect = "
				spawn_rebels = {
					type = particularist_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_7_flag
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_5_flag
			NOT = { has_province_flag = utubodi_rebels_6_flag }
		}
		for = {
			amount = 6
			effect = "
				spawn_rebels = {
					type = particularist_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_6_flag
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_4_flag
			NOT = { has_province_flag = utubodi_rebels_5_flag }
		}
		for = {
			amount = 5
			effect = "
				spawn_rebels = {
					type = particularist_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_5_flag
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_3_flag
			NOT = { has_province_flag = utubodi_rebels_4_flag }
		}
		for = {
			amount = 4
			effect = "
				spawn_rebels = {
					type = particularist_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_4_flag
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_2_flag
			NOT = { has_province_flag = utubodi_rebels_3_flag }
		}
		for = {
			amount = 3
			effect = "
				spawn_rebels = {
					type = particularist_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_3_flag
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_1_flag
			NOT = { has_province_flag = utubodi_rebels_2_flag }
		}
		for = {
			amount = 2
			effect = "
				spawn_rebels = {
					type = particularist_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_2_flag
	}
	if = {
		limit = { NOT = { has_province_flag = utubodi_rebels_1_flag } }
		spawn_rebels = {
			type = particularist_rebels
			size = 3
		}
		set_province_flag = utubodi_rebels_1_flag
	}
}

utubodi_unification_spawn_rebels_independence = {
	if = {
		limit = { has_province_flag = utubodi_rebels_7_flag }
		for = {
			amount = 8
			effect = "
				spawn_rebels = {
					type = independence_rebels
					size = 3
				}"
		}
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_6_flag
			NOT = { has_province_flag = utubodi_rebels_7_flag }
		}
		for = {
			amount = 7
			effect = "
				spawn_rebels = {
					type = independence_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_7_flag
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_5_flag
			NOT = { has_province_flag = utubodi_rebels_6_flag }
		}
		for = {
			amount = 6
			effect = "
				spawn_rebels = {
					type = independence_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_6_flag
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_4_flag
			NOT = { has_province_flag = utubodi_rebels_5_flag }
		}
		for = {
			amount = 5
			effect = "
				spawn_rebels = {
					type = independence_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_5_flag
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_3_flag
			NOT = { has_province_flag = utubodi_rebels_4_flag }
		}
		for = {
			amount = 4
			effect = "
				spawn_rebels = {
					type = independence_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_4_flag
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_2_flag
			NOT = { has_province_flag = utubodi_rebels_3_flag }
		}
		for = {
			amount = 3
			effect = "
				spawn_rebels = {
					type = independence_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_3_flag
	}
	if = {
		limit = {
			has_province_flag = utubodi_rebels_1_flag
			NOT = { has_province_flag = utubodi_rebels_2_flag }
		}
		for = {
			amount = 2
			effect = "
				spawn_rebels = {
					type = independence_rebels
					size = 3
				}"
		}
		set_province_flag = utubodi_rebels_2_flag
	}
	if = {
		limit = { NOT = { has_province_flag = utubodi_rebels_1_flag } }
		spawn_rebels = {
			type = independence_rebels
			size = 3
		}
		set_province_flag = utubodi_rebels_1_flag
	}
}

change_utubodi_unification_leaning = {
	change_variable = {
		which = utubodiKakunorKarma
		value = $value$
	}
	utubodi_unification_limit_leaning = yes
}

utubodi_unification_limit_leaning = {
	hidden_effect = {
		if = {
			limit = {
				check_variable = {
					which = utubodiKakunorKarma
					value = 100
				}
			}
			set_variable = {
				which = utubodiKakunorKarma
				value = 100
			}
		}
		else_if = {
			limit = {
				NOT = {
					check_variable = {
						which = utubodiKakunorKarma
						value = -100
					}
				}
			}
			set_variable = {
				which = utubodiKakunorKarma
				value = -100
			}
		}
	}
}

volcanic_truth_sacred_site_modifier_checks = {
	if = {
		limit = {
			has_global_flag = vt_incident_organizational_crisis_lesser_sacred_sites
		}
		if = {
			# First, check if the province and owner satisfy the conditions
			limit = {
				religion = volcanic_truth
				owner = { religion = volcanic_truth }
			}
			# Then check the province modifier
			if = {
				limit = {
					has_province_modifier = $site_name$_sacred_site_lesser_inactive
				}
				remove_province_modifier = $site_name$_sacred_site_lesser_inactive
				add_permanent_province_modifier = {
					name = $site_name$_sacred_site_lesser
					duration = -1
				}
			}
		}
		else_if = { # If you don't satisfy the conditions, and the active version is there, swap it
			limit = {
				has_province_modifier = $site_name$_sacred_site_lesser
			}
			remove_province_modifier = $site_name$_sacred_site_lesser
			add_permanent_province_modifier = {
				name = $site_name$_sacred_site_lesser_inactive
				duration = -1
			}
		}
	}
	if = {
		limit = {
			has_global_flag = vt_incident_organizational_crisis_greater_sacred_sites
		}
		if = {
			# First, check if the province and owner satisfy the conditions. The Greater version requires the gov reform
			limit = {
				religion = volcanic_truth
				owner = {
					religion = volcanic_truth
					has_reform = cuahu_teotlehu_reform
				}
			}
			# Then check the province modifier
			if = {
				limit = {
					has_province_modifier = $site_name$_sacred_site_greater_inactive
				}
				remove_province_modifier = $site_name$_sacred_site_greater_inactive
				add_permanent_province_modifier = {
					name = $site_name$_sacred_site_greater
					duration = -1
				}
			}
		}
		else_if = { # If you don't satisfy the conditions, and the active version is there, swap it
			limit = {
				has_province_modifier = $site_name$_sacred_site_greater
			}
			remove_province_modifier = $site_name$_sacred_site_greater
			add_permanent_province_modifier = {
				name = $site_name$_sacred_site_greater_inactive
				duration = -1
			}
		}
	}
}

volcanic_truth_kiamoa_entrance_modifier_checks = {
	if = {
		# If the province and new owner are the right religion...
		limit = {
			religion = volcanic_truth
			owner = { religion = volcanic_truth }
		}
		if = { #...and it had the inactive version of a modifier, replace it with the active version
			limit = {
				has_province_modifier = volcanic_truth_kiamoa_entrance_guard_inactive
			}
			remove_province_modifier = volcanic_truth_kiamoa_entrance_guard_inactive
			add_permanent_province_modifier = {
				name = volcanic_truth_kiamoa_entrance_guard
				duration = -1
			}
		}
		# If the modifiers were present, or if the active version was already present, it is
		# correct to leave the situation as is
	}
	else_if = { #If either the new owner or the province is no longer VT, replace the active version with inactive
		limit = {
			has_province_modifier = volcanic_truth_kiamoa_entrance_guard
		}
		remove_province_modifier = volcanic_truth_kiamoa_entrance_guard
		add_permanent_province_modifier = {
			name = volcanic_truth_kiamoa_entrance_guard_inactive
			duration = -1
		}
		# If the modifiers were present, or if the inactive version was already present, it is
		# correct to leave the situation as is
	}
}
insyaa_ring_select_region = {
	select_highest_dev_known_country_with_limit = { #random highest dev
		index = 0
		limit = "
			country_is_in_gift_ring_region = yes
			total_development = 33
			NOT = {
				has_country_modifier = insyaa_recently_recived_gift
				tag = ROOT
			}
		"
		effect = "
			save_event_target_as = insyaa_ring_highest_dev
			capital_scope = {
				save_event_target_as = insyaa_ring_highest_dev_capital
			}
		"
	}
	if = {
		limit = { has_country_flag = insyaa_ring_sender_clock }
		if = {
			limit = {
				capital_scope = {
					region = yanacotlele_region
				}
			}
			select_highest_dev_known_country_with_limit = { #random highest dev but in correct region
				index = 1
				limit = "
					capital_scope = { region = anakuele_region }
					total_development = 16
					NOT = {
						has_country_modifier = insyaa_recently_recived_gift
						tag = ROOT
						AND = { has_saved_event_target = insyaa_ring_highest_dev tag = event_target:insyaa_ring_highest_dev }
					}
				"
				effect = "
					save_event_target_as = insyaa_ring_highest_dev_regional
					capital_scope = {
						save_event_target_as = insyaa_ring_highest_dev_regional_capital
					}
				"
			}
			insyaa_ring_save_targets = { region = anakuele_region }
		}
		else_if = {
			limit = {
				capital_scope = {
					region = anakuele_region
				}
			}
			select_highest_dev_known_country_with_limit = { #random highest dev but in correct region
				index = 1
				limit = "
					capital_scope = { region = anakae_region }
					total_development = 16
					NOT = {
						has_country_modifier = insyaa_recently_recived_gift
						tag = ROOT
						AND = { has_saved_event_target = insyaa_ring_highest_dev tag = event_target:insyaa_ring_highest_dev }
					}
				"
				effect = "
					save_event_target_as = insyaa_ring_highest_dev_regional
					capital_scope = {
						save_event_target_as = insyaa_ring_highest_dev_regional_capital
					}
				"
			}
			insyaa_ring_save_targets = { region = anakae_region }
		}
		else_if = {
			limit = {
				capital_scope = {
					region = anakae_region
					
				}
			}
			select_highest_dev_known_country_with_limit = { #random highest dev but in correct region
				index = 1
				limit = "
					capital_scope = { region = cotlkae_region }
					total_development = 16
					NOT = {
						has_country_modifier = insyaa_recently_recived_gift
						tag = ROOT
						AND = { has_saved_event_target = insyaa_ring_highest_dev tag = event_target:insyaa_ring_highest_dev }
					}
				"
				effect = "
					save_event_target_as = insyaa_ring_highest_dev_regional
					capital_scope = {
						save_event_target_as = insyaa_ring_highest_dev_regional_capital
					}
				"
			}
			insyaa_ring_save_targets = { region = cotlkae_region }
		}
		else = {
			select_highest_dev_known_country_with_limit = { #random highest dev but in correct region
				index = 1
				limit = "
					capital_scope = { region = yanacotlele_region }
					total_development = 16
					NOT = {
						has_country_modifier = insyaa_recently_recived_gift
						tag = ROOT
						AND = { has_saved_event_target = insyaa_ring_highest_dev tag = event_target:insyaa_ring_highest_dev }
					}
				"
				effect = "
					save_event_target_as = insyaa_ring_highest_dev_regional
					capital_scope = {
						save_event_target_as = insyaa_ring_highest_dev_regional_capital
					}
				"
			}
			insyaa_ring_save_targets = { region = yanacotlele_region }
		}
	}
	else = {
		if = {
			limit = {
				capital_scope = {
					region = yanacotlele_region
				}
			}
			select_highest_dev_known_country_with_limit = { #random highest dev but in correct region
				index = 1
				limit = "
					capital_scope = { region = cotlkae_region }
					total_development = 16
					NOT = {
						has_country_modifier = insyaa_recently_recived_gift
						tag = ROOT
						AND = { has_saved_event_target = insyaa_ring_highest_dev tag = event_target:insyaa_ring_highest_dev }
					}
				"
				effect = "
					save_event_target_as = insyaa_ring_highest_dev_regional
					capital_scope = {
						save_event_target_as = insyaa_ring_highest_dev_regional_capital
					}
				"
			}
			insyaa_ring_save_targets = { region = cotlkae_region }
		}
		else_if = {
			limit = {
				capital_scope = {
					region = anakuele_region
				}
			}
			select_highest_dev_known_country_with_limit = { #random highest dev but in correct region
				index = 1
				limit = "
					capital_scope = { region = yanacotlele_region }
					total_development = 16
					NOT = {
						has_country_modifier = insyaa_recently_recived_gift
						tag = ROOT
						AND = { has_saved_event_target = insyaa_ring_highest_dev tag = event_target:insyaa_ring_highest_dev }
					}
				"
				effect = "
					save_event_target_as = insyaa_ring_highest_dev_regional
					capital_scope = {
						save_event_target_as = insyaa_ring_highest_dev_regional_capital
					}
				"
			}
			insyaa_ring_save_targets = { region = yanacotlele_region }
		}
		else_if = {
			limit = {
				capital_scope = {
					region = anakae_region
					
				}
			}
			select_highest_dev_known_country_with_limit = { #random highest dev but in correct region
				index = 1
				limit = "
					capital_scope = { region = anakuele_region }
					total_development = 16
					NOT = {
						has_country_modifier = insyaa_recently_recived_gift
						tag = ROOT
						AND = { has_saved_event_target = insyaa_ring_highest_dev tag = event_target:insyaa_ring_highest_dev }
					}
				"
				effect = "
					save_event_target_as = insyaa_ring_highest_dev_regional
					capital_scope = {
						save_event_target_as = insyaa_ring_highest_dev_regional_capital
					}
				"
			}
			insyaa_ring_save_targets = { region = anakuele_region }
		}
		else = {
			select_highest_dev_known_country_with_limit = { #random highest dev but in correct region
				index = 1
				limit = "
					capital_scope = { region = anakae_region }
					total_development = 16
					NOT = {
						has_country_modifier = insyaa_recently_recived_gift
						tag = ROOT
						AND = { has_saved_event_target = insyaa_ring_highest_dev tag = event_target:insyaa_ring_highest_dev }
					}
				"
				effect = "
					save_event_target_as = insyaa_ring_highest_dev_regional
					capital_scope = {
						save_event_target_as = insyaa_ring_highest_dev_regional_capital
					}
				"
			}
			insyaa_ring_save_targets = { region = anakae_region }
		}
	}
}
insyaa_ring_save_targets = {
	random_ally = {
		limit = {
			capital_scope = {
				region = $region$
			}
			NOT = {
				has_country_modifier = insyaa_recently_recived_gift
				AND = {
					has_saved_event_target = insyaa_ring_highest_dev
					tag = event_target:insyaa_ring_highest_dev
				}
				AND = {
					has_saved_event_target = insyaa_ring_highest_dev_regional
					tag = event_target:insyaa_ring_highest_dev_regional
				}
			}
		}
		save_event_target_as = insyaa_ring_ally
		capital_scope = {
			save_event_target_as = insyaa_ring_ally_capital
		}
	}
	random_known_country = {
		limit = {
			capital_scope = {
				region = $region$
			}
			NOT = {
				has_country_modifier = insyaa_recently_recived_gift
				AND = {
					has_saved_event_target = insyaa_ring_highest_dev
					tag = event_target:insyaa_ring_highest_dev
				}
				AND = {
					has_saved_event_target = insyaa_ring_highest_dev_regional
					tag = event_target:insyaa_ring_highest_dev_regional
				}
				AND = {
					has_saved_event_target = insyaa_ring_ally
					tag = event_target:insyaa_ring_ally
				}
			}
		}
		save_event_target_as = insyaa_ring_random
		capital_scope = {
			save_event_target_as = insyaa_ring_random_capital
		}
	}
}
select_diffrent_if_possible_race_provinces = { 
	random_owned_province = {
		limit = {
			NOT = {
				fast_has_pop_of_race = { race = $race1$ }
			}
		}
		save_event_target_as = event_target_$race1$
	}
	[[race2]
		random_owned_province = {
			limit = {
				NOT = {
					fast_has_pop_of_race = { race = $race2$ }
					AND = {
						has_saved_event_target = event_target_$race1$
						province_id = event_target:event_target_$race1$
					}
				}
			}
			save_event_target_as = event_target_$race2$
		}
		if = {
			limit = {
				NOT = { has_saved_event_target = event_target_$race2$ }
			}
			random_owned_province = {
				limit = {
					NOT = {
						fast_has_pop_of_race = { race = $race2$ }
					}
				}
				save_event_target_as = event_target_$race2$
			}
		}
	]
	[[race3]
		random_owned_province = {
			limit = {
				NOT = {
					fast_has_pop_of_race = { race = $race3$ }
					AND = {
						has_saved_event_target = event_target_$race1$
						province_id = event_target:event_target_$race1$
					}
					AND = {
						has_saved_event_target = event_target_$race2$
						province_id = event_target:event_target_$race2$
					}
				}
			}
			save_event_target_as = event_target_$race3$
		}
		if = {
			limit = { NOT = { has_saved_event_target = event_target_$race3$ } }
			random_owned_province = {
				limit = {
					NOT = {
						fast_has_pop_of_race = { race = $race3$ }
					}
				}
				save_event_target_as = event_target_$race3$
			}
		}
	]
	[[race4]
		random_owned_province = {
			limit = {
				NOT = {
					fast_has_pop_of_race = { race = $race4$ }
					AND = {
						has_saved_event_target = event_target_$race1$
						province_id = event_target:event_target_$race1$
					}
					AND = {
						has_saved_event_target = event_target_$race2$
						province_id = event_target:event_target_$race2$
					}
					AND = {
						has_saved_event_target = event_target_$race3$
						province_id = event_target:event_target_$race3$
					}
				}
			}
			save_event_target_as = event_target_$race4$
		}
		if = {
			limit = { NOT = { has_saved_event_target = event_target_$race4$ } }
			random_owned_province = {
				limit = {
					NOT = {
						fast_has_pop_of_race = { race = $race4$ }
					}
				}
				save_event_target_as = event_target_$race4$
			}
		}
	]
	[[race5]
		random_owned_province = {
			limit = {
				NOT = {
					fast_has_pop_of_race = { race = $race5$ }
					AND = {
						has_saved_event_target = event_target_$race1$
						province_id = event_target:event_target_$race1$
					}
					AND = {
						has_saved_event_target = event_target_$race2$
						province_id = event_target:event_target_$race2$
					}
					AND = {
						has_saved_event_target = event_target_$race3$
						province_id = event_target:event_target_$race3$
					}
					AND = {
						has_saved_event_target = event_target_$race4$
						province_id = event_target:event_target_$race4$
					}
				}
			}
			save_event_target_as = event_target_$race5$
		}
		if = {
			limit = { NOT = { has_saved_event_target = event_target_$race5$ } }
			random_owned_province = {
				limit = {
					NOT = {
						fast_has_pop_of_race = { race = $race5$ }
					}
				}
				save_event_target_as = event_target_$race5$
			}
		}
	]
}
#Pachpalka scripted effects
move_pachpalka_effect = {
	if = {
		limit = { has_saved_global_event_target = pachpalka_location }
		set_global_flag = pachpalka_on_the_move
		random_country = {
			limit = {
				capital_scope = {
					continent = oceania
					NOT = {
						superregion = hinuilands_superregion
						region = titanoflora_valley_region
						region = titanoflora_savanna_region
						region = insyaan_mushroom_forest_region
						region = event_target:pachpalka_location
					}
				}
			}
			clr_global_flag = pachpalka_on_the_move
			capital_scope = { save_global_event_target_as = pachpalka_location }
		}
		if = {
			limit = { has_global_flag = pachpalka_on_the_move }
			clear_global_event_target = pachpalka_location
		}
	}
	else = {
		random_country = {
			limit = {
				capital_scope = {
					continent = oceania
					NOT = {
						superregion = hinuilands_superregion
						region = titanoflora_valley_region
						region = titanoflora_savanna_region
						region = insyaan_mushroom_forest_region
					}
				}
			}
			capital_scope = { save_global_event_target_as = pachpalka_location }
		}
	}
	if = { #duplicate if to avoid triggering events in an else
		limit = { has_saved_global_event_target = pachpalka_location }
		event_target:pachpalka_location = {
			owner = {
				random_list = {
					1 = { country_event = { id = insyaa_flavour.30 } } #Strange Kobold Theologian event
					1 = { country_event = { id = insyaa_flavour.32 } } #Strange Kobold Merchant event
					1 = { country_event = { id = insyaa_flavour.34 } } #Strange Kobold Artist event
					1 = { country_event = { id = insyaa_flavour.36 } } #Strange Kobold Philosopher event
				}
			}
		}
	}
}

hire_pachpalka_effect = {
	if = {
		limit = {
			monthly_income = 33
		}
		add_treasury = -100
	}
	else = {
		add_years_of_income = -0.25
	}
	hire_advisor = {
		type = $type$
		name = pachpalka_pseudonym
		skill = 1
		religion = infinite_self
		culture = yawasichya_kobold
		cost_multiplier = 0.5
	}
	add_country_modifier = { name = pachpalka_$type$_school duration = -1 desc = pachpalka_modifier_duration_tt }
	set_country_flag = pachpalka_hired
	set_country_flag = pachpalka_$type$_hired
}

pachpalka_leaves_effect = {
	custom_tooltip = pachpalka_$type$_leaves_tt
	$effect$
	remove_country_modifier = pachpalka_$type$_school
	hidden_effect = {
		clr_country_flag = pachpalka_hired
		clr_country_flag = pachpalka_$type$_hired
		kill_advisor = $type$
		move_pachpalka_effect = yes
	}
}

pachpalka_fired_from_court_effect = {
	if = {
		limit = { has_country_flag = pachpalka_$type$_hired }
		remove_country_modifier = pachpalka_$type$_school
		clr_country_flag = pachpalka_hired
		clr_country_flag = pachpalka_$type$_hired
		set_global_flag = pachpalka_on_the_move #Pachpalka will move in 5 years
	}
}