#Place scripted triggers in common\scripted_triggers\anb_scripted_triggers_custom_diplo_ui.txt

#Scripted effects for category buttons - selects subcategory to show
#If the category has ai acceptance, the scripted effect must be placed inside the 'if'

#show_diplo_container ranges
# 1-999 = reserved
# 1000-1999 = show_diplo_general
# 2000-2999 = show_diplo_government
# 3000-3999 = show_diplo_religion
# 4000-4999 = show_diplo_cultural
# 5000-5999 = show_diplo_estates
# 6000-6999 = show_diplo_unique
# 7000-7999 = show_diplo_<unassigned>
# 8000-8999 = show_diplo_<unassigned>

custdip_category_open_general = {
	set_country_flag = show_diplo_general
	if = { #First open and reset - reopening the same category will go to the same list
		limit = {
			is_variable_mostly_outside_range = { var = show_diplo_container low = 1000 high = 2000 }
		}
		set_variable = { which = show_diplo_container value = 1000 }
		custdip_category_sort_general = { ascending = yes }
	}
}
custdip_category_open_government = {
	set_country_flag = show_diplo_government
	if = {
		limit = {
			is_variable_mostly_outside_range = { var = show_diplo_container low = 2000 high = 3000 }
		}
		set_variable = { which = show_diplo_container value = 2000 }
		custdip_category_sort_government = { ascending = yes }
	}
}
custdip_category_open_religion = {
	set_country_flag = show_diplo_religion
	if = {
		limit = {
			is_variable_mostly_outside_range = { var = show_diplo_container low = 3000 high = 4000 }
		}
		set_variable = { which = show_diplo_container value = 3000 }
		custdip_category_sort_religion = { ascending = yes }
	}
}
custdip_category_open_cultural = {
	set_country_flag = show_diplo_cultural
	if = {
		limit = {
			is_variable_mostly_outside_range = { var = show_diplo_container low = 4000 high = 5000 }
		}
		set_variable = { which = show_diplo_container value = 4000 }
		custdip_category_sort_cultural = { ascending = yes }
	}
}
custdip_category_open_estates = {
	set_country_flag = show_diplo_estates
	if = {
		limit = {
			is_variable_mostly_outside_range = { var = show_diplo_container low = 5000 high = 6000 }
		}
		set_variable = { which = show_diplo_container value = 5000 }
		custdip_category_sort_estates = { ascending = yes }
	}
}
custdip_category_open_unique = {
	set_country_flag = show_diplo_unique
	if = {
		limit = {
			is_variable_mostly_outside_range = { var = show_diplo_container low = 6000 high = 7000 }
		}
		set_variable = { which = show_diplo_container value = 6000 }
		custdip_category_sort_unique = { ascending = yes }
	}
}

custdip_show_next_window = {
	hidden_effect = {
		set_country_flag = custdip_loop #Enter loop
		while = {
			limit = { has_country_flag = custdip_loop }
			clr_country_flag = custdip_loop #Prepare to exit loop
			custdip_category_sort_$category$ = { ascending = yes }
			# 'custdip_loop' flag will be set again if another iteration is needed
			if = {
				limit = { NOT = { has_country_flag = loop_0 } }
				set_country_flag = loop_0
			}
			else = {
				clr_country_flag = custdip_loop # Force exit
			}
		}
		clr_country_flag = loop_0
	}
}

custdip_category_sort_general = {
	if = { #custom_diplomacy_overlord_container
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 1010 } ]
			custdip_general_overlord_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 1010 }
	}
	# else_if = { #custom_diplomacy_subject_container
	# 	limit = {
	# 		[[ascending] custdip_sort_ascending = { window_number = 1020 } ]
	# 		is_subject = yes
	# 	}
	# 	set_variable = { which = show_diplo_container value = 1020 }
	# }
	# else_if = { #Label_me
	# 	limit = {
	# 		[[ascending] custdip_sort_ascending = { window_number = 1030 } ]
	# 		#<subcategory trigger here>
	# 	}
	# 	set_variable = { which = show_diplo_container value = 1030 }
	# }
	else = {
		[[ascending] #First
			set_variable = { which = show_diplo_container value = 1000 }
		]
		set_country_flag = custdip_loop
	}
}
custdip_category_sort_government = {
	if = { #custom_diplomacy_raja #Raja
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 2010 } ]
			custdip_government_raja_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 2010 }
	}
	# else_if = { #Label_me
	# 	limit = {
	# 		[[ascending] custdip_sort_ascending = { window_number = 2020 } ]
	# 		#<subcategory trigger here>
	# 	}
	# 	set_variable = { which = show_diplo_container value = 2020 }
	# }
	else = {
		[[ascending] #First
			set_variable = { which = show_diplo_container value = 2000 }
		]
		set_country_flag = custdip_loop
	}
}
custdip_category_sort_religion = {
	if = { #custom_diplomacy_nsc
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 3010 } ]
			custdip_religion_nsc_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 3010 }
	}
	else_if = { #custom_diplomacy_rs
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 3020 } ]
			custdip_religion_rs_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 3020 }
	}
	else_if = { #custom_diplomacy_sp
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 3030 } ]
			custdip_religion_sp_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 3030 }
	}
	# else_if = { #Label_me
	# 	limit = {
	# 		[[ascending] custdip_sort_ascending = { window_number = 3040 } ]
	# 		#<subcategory trigger here>
	# 	}
	# 	set_variable = { which = show_diplo_container value = 3040 }
	# }
	else = {
		[[ascending] #First
			set_variable = { which = show_diplo_container value = 3000 }
		]
		set_country_flag = custdip_loop
	}
}
custdip_category_sort_cultural = {
	if = { #Label_me
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 4010 } ]
			#<subcategory trigger here>
			always = yes
		}
		set_variable = { which = show_diplo_container value = 4010 }
	}
	# else_if = { #Label_me
	# 	limit = {
	# 		[[ascending] custdip_sort_ascending = { window_number = 4020 } ]
	# 		#<subcategory trigger here>
	# 	}
	# 	set_variable = { which = show_diplo_container value = 4020 }
	# }
	else = {
		[[ascending] #First
			set_variable = { which = show_diplo_container value = 4000 }
		]
		set_country_flag = custdip_loop
	}
}
custdip_category_sort_estates = {
	if = { #custom_diplomacy_vampires_container
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 5010 } ]
			custdip_estates_vampires_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 5010 }
	}
	# else_if = { #Label_me
	# 	limit = {
	# 		[[ascending] custdip_sort_ascending = { window_number = 5020 } ]
	# 		#<subcategory trigger here>
	# 	}
	# 	set_variable = { which = show_diplo_container value = 5020 }
	# }
	else = {
		[[ascending] #First
			set_variable = { which = show_diplo_container value = 5000 }
		]
		set_country_flag = custdip_loop
	}
}
custdip_category_sort_unique = {
	if = { #custom_diplomacy_Y20 #Feiten
		limit = {
			#<subcategory trigger here, first if short>
			[[ascending] custdip_sort_ascending = { window_number = 6010 } ]
			custdip_unique_Y20_trigger = yes
		}
		feiten_skyport_ai_acceptance_calc_effect = yes
		set_variable = { which = show_diplo_container value = 6010 }
	}
	else_if = { #custom_diplomacy_Y10 #Yingzhen
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 6020 } ]
			custdip_unique_Y10_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 6020 }
	}
	else_if = { #custom_diplomacy_Z99 #Black Demesne
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 6030 } ]
			custdip_unique_Z99_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 6030 }
	}
	else_if = { #custom_diplomacy_B58 #Adenica
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 6040 } ]
			custdip_unique_B58_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 6040 }
	}
	else_if = { #custom_diplomacy_F35 #Azkabar
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 6050 } ]
			custdip_unique_F35_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 6050 }
	}
	else_if = { #custom_diplomacy_B32 #Castanor
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 6060 } ]
			custdip_unique_B32_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 6060 }
	}
	# else_if = { #custom_diplomacy_J33 #Kalsyto
	# 	limit = {
	# 		[[ascending] custdip_sort_ascending = { window_number = 6070 } ]
	# 		custdip_unique_J33_trigger = yes
	# 	}
	# 	J33_invite_into_democratic_sphere_ai_acceptance_calc_effect = yes
	# 	set_variable = { which = show_diplo_container value = 6070 }
	# }
	else_if = { #custom_diplomacy_Z97 #Ravelian State
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 6080 } ]
			custdip_unique_Z97_trigger = yes
		}
		Z97_spread_ravelian_faith_ai_acceptance_calc_effect = yes
		Z97_spread_ravelian_estates_ai_acceptance_calc_effect = yes
		set_variable = { which = show_diplo_container value = 6080 }
	}
	else_if = { #custom_diplomacy_B02 #Corintar
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 6090 } ]
			custdip_unique_B02_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 6090 }
	}
	else_if = { #custom_diplomacy_H85 #Truedagger
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 6100 } ]
			custdip_unique_H85_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 6100 }
	}
	else_if = { #custom_diplomacy_B37 #Rogieria
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 6110 } ]
			custdip_unique_B37_trigger = yes
		}
		set_variable = { which = show_diplo_container value = 6110 }
	}
	else_if = { #custom_diplomacy_Y25 #Zongji
		limit = {
			[[ascending] custdip_sort_ascending = { window_number = 6120 } ]
			custdip_unique_Y25_trigger = yes
		}
		Y25_fealty_ai_acceptance_calc_effect = yes
		set_variable = { which = show_diplo_container value = 6120 }
	}
	else = {
		[[ascending] #First
			set_variable = { which = show_diplo_container value = 6000 }
		]
		set_country_flag = custdip_loop
	}
}

reset_evaluated_diplomacy_flag = {
	#Potentially some edge cases with tags respawning with this flag, keep an eye out
	random_known_country = {
		limit = {
			has_country_flag = evaluated_diplomacy_player_@FROM
		}
		clr_country_flag = evaluated_diplomacy_player_@FROM
	}
	ROOT = { set_country_flag = evaluated_diplomacy_player_@FROM }
}



#############################
# Scripted variable exports
#############################


#############################
# AI Acceptance Calcs
#############################
#Must be scripted to use unique variables within each category
### The values need to add up in the tooltip
### Then, standardise them so that the same loc can be re-used


#Variables in FROM scope
feiten_skyport_ai_acceptance_calc_effect = {
	hidden_effect = {
		reset_evaluated_diplomacy_flag = yes
		FROM = {
			set_variable = { which = ai_accept_var_button_1 value = 0 }
			set_variable = { which = ai_accept_var_button_1_pos value = 0 }
			set_variable = { which = ai_accept_var_button_1_neg value = 0 }
			##Positive
			#Republic
			if = {
				limit = { ROOT = { government = republic } }
				# custom_tooltip = feiten_buy_skyport_rights_republic_tt
				change_variable = { ai_accept_var_button_1_pos = 5 }
			}
			#Subject
			if = {
				limit = { ROOT = { is_subject_of = FROM } }
				change_variable = { ai_accept_var_button_1_pos = 25 }
			}
			#Opinion
			if = {
				limit = { ROOT = { has_opinion = { who = FROM value = 199 } } }
				# custom_tooltip = feiten_buy_skyport_rights_200_opinion_tt
				change_variable = { ai_accept_var_button_1_pos = 50 }
			}
			else_if = {
				limit = { ROOT = { has_opinion = { who = FROM value = 150 } } }
				# custom_tooltip = feiten_buy_skyport_rights_150_opinion_tt
				change_variable = { ai_accept_var_button_1_pos = 40 }
			}
			else_if = {
				limit = { ROOT = { has_opinion = { who = FROM value = 100 } } }
				# custom_tooltip = feiten_buy_skyport_rights_100_opinion_tt
				change_variable = { ai_accept_var_button_1_pos = 25 }
			}
			else_if = {
				limit = { ROOT = { has_opinion = { who = FROM value = 50 } } }
				# custom_tooltip = feiten_buy_skyport_rights_50_opinion_tt
				change_variable = { ai_accept_var_button_1_pos = 10 }
			}
			#Trust
			if = {
				limit = { ROOT = { trust = { who = FROM value = 100 } } }
				# custom_tooltip = feiten_buy_skyport_rights_100_trust_tt
				change_variable = { ai_accept_var_button_1_pos = 25 }
			}
			else_if = {
				limit = { ROOT = { trust = { who = FROM value = 90 } } }
				# custom_tooltip = feiten_buy_skyport_rights_90_trust_tt
				change_variable = { ai_accept_var_button_1_pos = 20 }
			}
			else_if = {
				limit = { ROOT = { trust = { who = FROM value = 80 } } }
				# custom_tooltip = feiten_buy_skyport_rights_80_trust_tt
				change_variable = { ai_accept_var_button_1_pos = 15 }
			}
			else_if = {
				limit = { ROOT = { trust = { who = FROM value = 70 } } }
				# custom_tooltip = feiten_buy_skyport_rights_70_trust_tt
				change_variable = { ai_accept_var_button_1_pos = 10 }
			}
			else_if = {
				limit = { ROOT = { trust = { who = FROM value = 60 } } }
				# custom_tooltip = feiten_buy_skyport_rights_60_trust_tt
				change_variable = { ai_accept_var_button_1_pos = 5 }
			}
			#Alliance
			if = {
				limit = { ROOT = { alliance_with = FROM } }
				# custom_tooltip = feiten_buy_skyport_rights_alliance_tt
				change_variable = { ai_accept_var_button_1_pos = 10 }
			}
			
			#Negative
			#Base acceptance
			change_variable = { ai_accept_var_button_1_neg = -20 }
			#Mercantilism
			# custom_tooltip = feiten_buy_skyport_rights_mercantilism_tt
			export_to_variable = {
				variable_name = custdip_mercantilism
				value = trigger_value:mercantilism
				who = ROOT
			}
			multiply_variable = { which = custdip_mercantilism value = -0.5 }
			change_variable = { which = ai_accept_var_button_1_neg which = custdip_mercantilism }
			#Attitude: Neutral
			if = {
				limit = {
					ROOT = {
						ai_attitude = { who = FROM attitude = attitude_neutral }
					}
				}
				# custom_tooltip = feiten_buy_skyport_rights_neutral_tt
				change_variable = { ai_accept_var_button_1_neg = -10 }
			}
			
			#Attitude: Bad
			if = {
				# custom_tooltip = feiten_buy_skyport_rights_bad_attitude_tt
				limit = {
					ROOT = {
						OR = {
							ai_attitude = { who = FROM attitude = attitude_hostile }
							ai_attitude = { who = FROM attitude = attitude_rivalry }
							ai_attitude = { who = FROM attitude = attitude_outraged }
							ai_attitude = { who = FROM attitude = attitude_disloyal }
							ai_attitude = { who = FROM attitude = attitude_rebellious }
							ai_attitude = { who = FROM attitude = attitude_threatened }
							ai_attitude = { who = FROM attitude = attitude_domineering }
						}
					}
				}
				change_variable = { ai_accept_var_button_1_neg = -1000 }
			}
			#Different religion group
			if = {
				limit = { ROOT = { NOT = { religion_group = FROM } } }
				# custom_tooltip = feiten_buy_skyport_rights_religion_tt
				change_variable = { ai_accept_var_button_1_neg = -5 }
			}
			#Target has strong trade
			if = {
				limit = { ROOT = { home_trade_node = { has_most_province_trade_power = ROOT } } }
				# custom_tooltip = feiten_buy_skyport_rights_trade_dominate_tt
				change_variable = { ai_accept_var_button_1_neg = -10 }
			}
			change_variable = { which = ai_accept_var_button_1 which = ai_accept_var_button_1_pos }
			change_variable = { which = ai_accept_var_button_1 which = ai_accept_var_button_1_neg }
		}
	}
}

#Variables in FROM scope
Y25_fealty_ai_acceptance_calc_effect = {
	hidden_effect = {
		reset_evaluated_diplomacy_flag = yes
		FROM = {
			set_variable = { which = ai_accept_var_button_1 value = 0 }
			set_variable = { which = ai_accept_var_button_1_pos value = 0 }
			set_variable = { which = ai_accept_var_button_1_neg value = 0 }
			set_variable = { which = zongjiPrestigious value = 0 }
			set_variable = { which = custdip_ruler_dip value = 0 }
			set_variable = { which = custdip_ruler_mil value = 0 }

			##Positive
			#Y25RulerDip
			if = {
				limit = { dip = 3 }
				export_to_variable = { # This is for use in localisation
					which = custdip_ruler_dip
					value = DIP
				}
				multiply_variable = { which = custdip_ruler_dip value = 2 }
				change_variable = { which = ai_accept_var_button_1_pos which = custdip_ruler_dip }
			}
			#Y25RulerMil
			if = {
				limit = { mil = 3 }
				export_to_variable = { # This is for use in localisation
					which = custdip_ruler_mil
					value = MIL
				}
				change_variable = { which = ai_accept_var_button_1_pos which = custdip_ruler_mil }
			}
			#Y25OurSize
			export_to_variable = {
				which = custdip_our_development
				value = total_development
			}
			change_variable = { which = ai_accept_var_button_1_pos which = custdip_our_development }
			#Y25Prestigious
			if = {
				limit = { prestige = 50 }
				export_to_variable = {
					which = zongjiPrestigious
					value = prestige
				}
				divide_variable = { which = zongjiPrestigious value = 4 }
				change_variable = { which = ai_accept_var_button_1_pos which = zongjiPrestigious }
			}
			#Y25Assertive
			if = {
				limit = {
					power_projection = 50
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 15 }
			}
			#Y25Powerful
			if = {
				limit = {
					army_strength = {
						who = ROOT
						value = 1.5
					}
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 15 }
			}
	
			#Y25ImperialClaims
			if = {
				limit = {
					government_rank = 3
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 20 }
			}
	
			#Ambiguous
			#Y25DipRep
			export_to_variable = {
				which = custdip_diplo_rep
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = custdip_diplo_rep value = 2 }
			if = {
				limit = { diplomatic_reputation = 0 }
				change_variable = { which = ai_accept_var_button_1_pos which = custdip_diplo_rep }
			}
			else = {
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_diplo_rep }
			}
			#Y25vassalizationReasons
			export_to_variable = {
				which = custdip_vassalization_reasons
				value = modifier:accept_vassalization_reasons
				who = FROM
			}
			if = {
				limit = { check_variable = { which = custdip_vassalization_reasons value = 1 } }
				change_variable = { which = ai_accept_var_button_1_pos which = custdip_vassalization_reasons }
			}
			else = {
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_vassalization_reasons }
			}
	
			#Negative
			#Base acceptance
			change_variable = { ai_accept_var_button_1_neg = -45 }
			#Y25TheirSize
			export_to_variable = {
				which = custdip_their_development
				value = total_development
				who = ROOT
			}
			multiply_variable = { which = custdip_their_development value = -1 }
			change_variable = { which = ai_accept_var_button_1_neg which = custdip_their_development }
			#Y25TooBig
			if = {
				limit = {
					ROOT = { total_development = 150 }
				}
				change_variable = { ai_accept_var_button_1_neg = -150 }
			}
			#Y25Weak
			if = {
				limit = {
					NOT = {
						army_strength = {
							who = ROOT
							value = 0.6
						}
					}
				}
				change_variable = { which = ai_accept_var_button_1_neg value = -45 }
			}
			change_variable = { which = ai_accept_var_button_1 which = ai_accept_var_button_1_pos }
			change_variable = { which = ai_accept_var_button_1 which = ai_accept_var_button_1_neg }
		}
	}
}

#Variables in FROM scope
J33_invite_into_democratic_sphere_ai_acceptance_calc_effect = {
	hidden_effect = {
		reset_evaluated_diplomacy_flag = yes
		FROM = {
			#Export all variables first
			set_variable = { which = ai_accept_var_button_1 value = 0 }
			set_variable = { which = ai_accept_var_button_1_pos value = 0 }
			set_variable = { which = ai_accept_var_button_1_neg value = 0 }
			export_to_variable = { which = custdip_opinion value = opinion who = ROOT with = FROM }
			export_to_variable = { which = custdip_trust value = trust who = ROOT with = FROM }
			export_to_variable = { which = custdip_diplo_rep value = modifier:diplomatic_reputation who = FROM }
			export_to_variable = { which = custdip_their_development value = total_development who = ROOT }
			export_to_variable = { which = custdip_border_distance value = border_distance who = FROM with = ROOT }
	
			#DIPLO_OPPINION
			multiply_variable = { which = custdip_opinion value = 0.125 }
			if = {
				limit = { check_variable = { which = custdip_opinion value = 0 } }
				change_variable = { which = ai_accept_var_button_1_pos which = custdip_opinion }
			}
			else = {
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_opinion }
			}
	
			#AI_TRUST_TOWARDS_FROM
			subtract_variable = { which = custdip_trust value = 50 }
			#1 trust = +4 ai points
			multiply_variable = { which = custdip_trust value = 0.4 }
			if = {
				limit = { check_variable = { which = custdip_trust value = 0 } }
				change_variable = { which = ai_accept_var_button_1_pos which = custdip_trust }
			}
			else = {
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_trust }
			}
			#AI_DIPLOMATIC_REPUTATION
			#1 rep = 3
			multiply_variable = { which = custdip_diplo_rep value = 3 }
			if = {
				limit = { check_variable = { which = custdip_diplo_rep value = 0 } }
				change_variable = { which = ai_accept_var_button_1_pos which = custdip_diplo_rep }
			}
			else = {
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_diplo_rep }
			}
			#AI_TOTAL_DEVELOPMENT
			if = {
				limit = {
					NOT = {
						AND = {
							FROM = { has_government_attribute = emissary_of_liberty }
							OR = {
								ROOT = { is_revolutionary = yes }
								ROOT = { has_country_modifier = discontent_sowed }
							}
						}
					}
				}
				multiply_variable = { which = custdip_their_development value = -0.25 }
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_their_development }
			}
			else_if = {
				limit = {
					FROM = { has_government_attribute = emissary_of_liberty }
					OR = {
						ROOT = { is_revolutionary = yes }
						ROOT = { has_country_modifier = discontent_sowed }
					}
					NOT = {
						AND = {
							ROOT = { is_revolutionary = yes }
							ROOT = { has_country_modifier = discontent_sowed }
							FROM = { has_country_modifier = J33_revolutionary_vanguard }
						}
					}
				}
				multiply_variable = { which = custdip_their_development value = -0.125 }
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_their_development }
			}
			else_if = {
				limit = {
					FROM = {
						has_government_attribute = emissary_of_liberty
						has_country_modifier = J33_revolutionary_vanguard
					}
					ROOT = {
						is_revolutionary = yes
						has_country_modifier = discontent_sowed
					}
				}
				multiply_variable = { which = custdip_their_development value = -0.0625 }
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_their_development }
			}
			#DIPLO_HAS_AI_HAS_OWN_SUBJECTS_TT
			if = {
				limit = { ROOT = { num_of_subjects = 1 } }
				change_variable = { which = ai_accept_var_button_1_neg value = -20 }
			}
			#KALSYTO_LIBERATOR_TT
			if = {
				limit = {
					ROOT = {
						capital_scope = {
							OR = {
								continent = asia
								superregion = east_serpentspine_superregion
							}
						}
					}
					FROM = { has_country_flag = J33_liberator_haless }
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 20 }
			}
			#KALSYTO_RACIAL_TT
			if = {
				limit = {
					OR = {
						AND = {
							ROOT = { culture_is_dwarven = yes }
							FROM = { has_country_flag = J33_pro_dwarf }
						}
						AND = {
							ROOT = { culture_is_goblin = yes }
							FROM = { has_country_flag = J33_pro_goblin }
						}
					}
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 15 }
			}
			else_if = {
				limit = {
					OR = {
						AND = {
							ROOT = { culture_is_goblin = yes }
							FROM = { has_country_flag = J33_pro_dwarf }
						}
						AND = {
							ROOT = { culture_is_dwarven = yes }
							FROM = { has_country_flag = J33_pro_goblin }
						}
					}
				}
				change_variable = { which = ai_accept_var_button_1_neg value = -15 }
			}
			#KALSYTO_COLONIAL_TT
			if = {
				limit = {
					ROOT = {
						has_global_flag = J33_agitated_colonies_flag
						is_former_colonial_nation = yes
					}
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 25 }
			}
			#KALSYTO_BLACKMAIL_TT
			if = {
				limit = { FROM = { spy_ideas = 7 } }
				change_variable = { which = ai_accept_var_button_1_pos value = 15 }
			}
			
			#KALSYTO_LIBERATION_TT
			if = {
				limit = {
					FROM = { has_country_flag = J33_liberation_GP }
					ROOT = {
						OR = {
							has_opinion_modifier = {
								modifier = released_in_peace
								who = FROM
								value = 10
							}
							has_opinion_modifier = {
								modifier = returned_core_to_me
								who = FROM
								value = 50
							}
						}
					}
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 15 }
			}
			#attitude_rivalry_DIPLO_ATTITUDE_TT
			#attitude_hostile_DIPLO_ATTITUDE_TT
			#attitude_outraged_DIPLO_ATTITUDE_TT
			#attitude_domineering_DIPLO_ATTITUDE_TT
			if = {
				limit = {
					ROOT = {
						OR = {
							ai_attitude = { who = FROM attitude = attitude_rivalry }
							ai_attitude = { who = FROM attitude = attitude_hostile }
							ai_attitude = { who = FROM attitude = attitude_outraged }
							ai_attitude = { who = FROM attitude = attitude_domineering }
						}
					}
				}
				change_variable = { which = ai_accept_var_button_1_neg value = -1000 }
			}
			#attitude_neutral_DIPLO_ATTITUDE_TT
			else_if = {
				limit = { ROOT = { ai_attitude = { who = FROM attitude = attitude_neutral } } }
				change_variable = { which = ai_accept_var_button_1_neg value = -10 }
			}
			#attitude_allied_DIPLO_ATTITUDE_TT
			#attitude_friendly_DIPLO_ATTITUDE_TT
			#attitude_threatened_DIPLO_ATTITUDE_TT
			else_if = {
				limit = {
					ROOT = {
						OR = {
							ai_attitude = { who = FROM attitude = attitude_allied }
							ai_attitude = { who = FROM attitude = attitude_friendly }
							AND = {
								ai_attitude = { who = FROM attitude = attitude_threatened }
								FROM = { NOT = { has_country_flag = J33_citizen_superiority } }
							}
						}
					}
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 20 }
			}
			#attitude_threatened_DIPLO_ATTITUDE_TT
			else_if = {
				limit = {
					AND = {
						ROOT = { ai_attitude = { who = FROM attitude = attitude_threatened } }
						FROM = { has_country_flag = J33_citizen_superiority }
					}
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 30 }
			}
			#attitude_loyal_DIPLO_ATTITUDE_TT
			else_if = {
				limit = {
					ROOT = { ai_attitude = { who = FROM attitude = attitude_loyal } }
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 1000 }
			}
			#DIPLO_BORDER_DISTANCE_TT
			if = {
				limit = { FROM = { NOT = { has_country_modifier = J33_global_effort } } }
				#5 units = -1
				multiply_variable = { which = custdip_border_distance value = -0.2 }
	
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_border_distance }
			}
			#J33_republic_TT
			if = {
				limit = {
					ROOT = {
						government = republic
						NOT = { has_global_flag = J33_liberty_flag }
					}
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 25 }
			}
			else_if = {
				limit = {
					ROOT = {
						government = republic
						has_global_flag = J33_liberty_flag
					}
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 75 }
			}
			# J33_native_TT
			else_if = {
				limit = { ROOT = { government = native } }
				change_variable = { which = ai_accept_var_button_1_neg value = -10 }
			}
			# J33_tribal_TT
			# else_if = {
			# 	limit = { ROOT = { government = tribal } }
			# 	variable_arithmetic_trigger = {
			# 		change_variable = { which = ai_accept_var_button_1_pos value = 0 }
			# 	}
			# }
			#J33_theocracy_TT
			else_if = {
				limit = {
					ROOT = { government = theocracy }
					NOT = { has_global_flag = J33_singular_divine_flag }
				}
				change_variable = { which = ai_accept_var_button_1_neg value = -10 }
			}
			else_if = {
				limit = {
					ROOT = { government = theocracy }
					has_global_flag = J33_singular_divine_flag
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 25 }
			}
			#J33_monarchy_TT
			else_if = {
				limit = { ROOT = { government = monarchy } }
				change_variable = { which = ai_accept_var_button_1_neg value = -25 }
			}
			#kalsyto_influence_counter_TT
			change_variable = { which = ai_accept_var_button_1_pos which = kalsyto_influence_counter }
	
			#Final calc
			change_variable = { which = ai_accept_var_button_1 which = ai_accept_var_button_1_pos }
			change_variable = { which = ai_accept_var_button_1 which = ai_accept_var_button_1_neg }
		}
	}
}

#Variables in FROM scope
# The Ravelian diplo actions use different, distinct variables so that they don't interfere
# This means they can be shown simultaneously on adjacent buttons
Z97_spread_ravelian_faith_ai_acceptance_calc_effect = {
	hidden_effect = {
		reset_evaluated_diplomacy_flag = yes
		FROM = {
			set_variable = { which = ai_accept_var_button_1 value = 0 }
			set_variable = { which = ai_accept_var_button_1_pos value = 0 }
			set_variable = { which = ai_accept_var_button_1_neg value = 0 }
			export_to_variable = { which = custdip_opinion value = opinion who = ROOT with = FROM }
			export_to_variable = { which = custdip_trust value = trust who = ROOT with = FROM }
			export_to_variable = { which = custdip_diplo_rep value = modifier:diplomatic_reputation who = FROM }
			export_to_variable = { which = custdip_their_development value = total_development who = ROOT }
			export_to_variable = { which = custdip_border_distance value = border_distance who = FROM with = ROOT }

			#Erudite scaling modifiers
			if = {
				limit = {
					FROM = { has_country_modifier = z97_debate2_erudite1 }
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 25 }
			}
			else_if = {
				limit = {
					FROM = { has_country_modifier = z97_debate2_erudite2 }
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 50 }
			}
			else_if = {
				limit = {
					FROM = { has_country_modifier = z97_debate2_erudite3 }
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 75 }
			}

			#DIPLO_OPPINION
			multiply_variable = { which = custdip_opinion value = 0.125 }
			if = {
				limit = { check_variable = { which = custdip_opinion value = 0 } }
				change_variable = { which = ai_accept_var_button_1_pos which = custdip_opinion }
			}
			else = {
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_opinion }
			}
			#AI_TRUST_TOWARDS_FROM
			subtract_variable = { which = custdip_trust value = 50 }
			if = {
				limit = { check_variable = { which = custdip_trust value = 0 } }
				change_variable = { which = ai_accept_var_button_1_pos which = custdip_trust }
			}
			else = {
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_trust }
			}
			#AI_DIPLOMATIC_REPUTATION
			multiply_variable = { which = custdip_diplo_rep value = 5 }
			if = {
				limit = { check_variable = { which = custdip_diplo_rep value = 0 } }
				change_variable = { which = ai_accept_var_button_1_pos which = custdip_diplo_rep }
			}
			else = {
				change_variable = { which = ai_accept_var_button_1_neg which = custdip_diplo_rep }
			}
	
			#AI_TOTAL_DEVELOPMENT
			multiply_variable = { which = custdip_their_development value = -0.1 }
			change_variable = { which = ai_accept_var_button_1_neg which = custdip_their_development }
	
			#DIPLO_BORDER_DISTANCE_TT
			multiply_variable = { which = custdip_border_distance value = -0.1 }
			change_variable = { which = ai_accept_var_button_1_neg which = custdip_border_distance }
	
			#These are all ifs so they don't break in scripted effects
			#attitude_neutral_DIPLO_ATTITUDE_TT
			if = {
				limit = { ROOT = { ai_attitude = { who = FROM attitude = attitude_neutral } } }
				change_variable = { which = ai_accept_var_button_1_neg value = -20 }
			}
			#attitude_allied_DIPLO_ATTITUDE_TT
			if = {
				limit = {
					ROOT = { ai_attitude = { who = FROM attitude = attitude_allied } }
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 50 }
			}
			#attitude_friendly_DIPLO_ATTITUDE_TT
			#attitude_threatened_DIPLO_ATTITUDE_TT
			if = {
				limit = {
					ROOT = {
						ai_attitude = { who = FROM attitude = attitude_friendly }
						ai_attitude = { who = FROM attitude = attitude_threatened }
					}
				}
				change_variable = { which = ai_accept_var_button_1_pos value = 10 }
			}
			#attitude_rivalry_DIPLO_ATTITUDE_TT
			#attitude_hostile_DIPLO_ATTITUDE_TT
			#attitude_outraged_DIPLO_ATTITUDE_TT
			#attitude_domineering_DIPLO_ATTITUDE_TT
			if = {
				limit = {
					ROOT = {
						OR = {
							ai_attitude = { who = FROM attitude = attitude_rivalry }
							ai_attitude = { who = FROM attitude = attitude_hostile }
							ai_attitude = { who = FROM attitude = attitude_outraged }
							ai_attitude = { who = FROM attitude = attitude_domineering }
						}
					}
				}
				change_variable = { which = ai_accept_var_button_1_neg value = -1000 }
			}

			#Final calc
			change_variable = { which = ai_accept_var_button_1 which = ai_accept_var_button_1_pos }
			change_variable = { which = ai_accept_var_button_1 which = ai_accept_var_button_1_neg }
		}
	}
}

#Variables in FROM scope
# The Ravelian diplo actions use different, distinct variables so that they don't interfere
# This means they can be shown simultaneously on adjacent buttons
Z97_spread_ravelian_estates_ai_acceptance_calc_effect = {
	hidden_effect = {
		reset_evaluated_diplomacy_flag = yes
		FROM = {
			set_variable = { which = ai_accept_var_button_2 value = 0 }
			set_variable = { which = ai_accept_var_button_2_pos value = 0 }
			set_variable = { which = ai_accept_var_button_2_neg value = 0 }
			export_to_variable = { which = custdip_opinion value = opinion who = ROOT with = FROM }
			export_to_variable = { which = custdip_trust value = trust who = ROOT with = FROM }
			export_to_variable = { which = custdip_diplo_rep value = modifier:diplomatic_reputation who = FROM }
			export_to_variable = { which = custdip_their_development value = total_development who = ROOT }
			export_to_variable = { which = custdip_border_distance value = border_distance who = FROM with = ROOT }

			#Erudite scaling modifiers
			if = {
				limit = {
					FROM = { has_country_modifier = z97_debate2_erudite1 }
				}
				change_variable = { which = ai_accept_var_button_2_pos value = 25 }
			}
			else_if = {
				limit = {
					FROM = { has_country_modifier = z97_debate2_erudite2 }
				}
				change_variable = { which = ai_accept_var_button_2_pos value = 50 }
			}
			else_if = {
				limit = {
					FROM = { has_country_modifier = z97_debate2_erudite3 }
				}
				change_variable = { which = ai_accept_var_button_2_pos value = 75 }
			}

			#DIPLO_OPPINION
			multiply_variable = { which = custdip_opinion value = 0.125 }
			if = {
				limit = { check_variable = { which = custdip_opinion value = 0 } }
				change_variable = { which = ai_accept_var_button_2_pos which = custdip_opinion }
			}
			else = {
				change_variable = { which = ai_accept_var_button_2_neg which = custdip_opinion }
			}
			#AI_TRUST_TOWARDS_FROM
			subtract_variable = { which = custdip_trust value = 50 }
			if = {
				limit = { check_variable = { which = custdip_trust value = 0 } }
				change_variable = { which = ai_accept_var_button_2_pos which = custdip_trust }
			}
			else = {
				change_variable = { which = ai_accept_var_button_2_neg which = custdip_trust }
			}
			#AI_DIPLOMATIC_REPUTATION
			multiply_variable = { which = custdip_diplo_rep value = 5 }
			if = {
				limit = { check_variable = { which = custdip_diplo_rep value = 0 } }
				change_variable = { which = ai_accept_var_button_2_pos which = custdip_diplo_rep }
			}
			else = {
				change_variable = { which = ai_accept_var_button_2_neg which = custdip_diplo_rep }
			}


			#AI_TOTAL_DEVELOPMENT
			multiply_variable = { which = custdip_their_development value = -0.1 }
			change_variable = { which = ai_accept_var_button_2_neg which = custdip_their_development }

			#DIPLO_BORDER_DISTANCE_TT
			multiply_variable = { which = custdip_border_distance value = -0.1 }
			change_variable = { which = ai_accept_var_button_2_neg which = custdip_border_distance }

			#ravstate_already_religious_mages_tt
			if = {
				limit = { ROOT = { has_estate_privilege = estate_mages_organization_religious } }
				change_variable = { which = ai_accept_var_button_2_pos value = 50 }
			}
			#ravstate_already_ravstate_artificers_tt
			if = {
				limit = { ROOT = { has_estate_privilege = estate_artificers_organization_ravelian_control } }
				change_variable = { which = ai_accept_var_button_2_pos value = 50 }
			}
			#These are all ifs so they don't break in scripted effects
			#attitude_neutral_DIPLO_ATTITUDE_TT
			if = {
				limit = { ROOT = { ai_attitude = { who = FROM attitude = attitude_neutral } } }
				change_variable = { which = ai_accept_var_button_2_neg value = -20 }
			}
			#attitude_allied_DIPLO_ATTITUDE_TT
			if = {
				limit = {
					ROOT = { ai_attitude = { who = FROM attitude = attitude_allied } }
				}
				change_variable = { which = ai_accept_var_button_2_pos value = 50 }
			}
			#attitude_friendly_DIPLO_ATTITUDE_TT
			#attitude_threatened_DIPLO_ATTITUDE_TT
			if = {
				limit = {
					ROOT = {
						ai_attitude = { who = FROM attitude = attitude_friendly }
						ai_attitude = { who = FROM attitude = attitude_threatened }
					}
				}
				change_variable = { which = ai_accept_var_button_2_pos value = 10 }
			}
			#attitude_rivalry_DIPLO_ATTITUDE_TT
			#attitude_hostile_DIPLO_ATTITUDE_TT
			#attitude_outraged_DIPLO_ATTITUDE_TT
			#attitude_domineering_DIPLO_ATTITUDE_TT
			if = {
				limit = {
					ROOT = {
						OR = {
							ai_attitude = { who = FROM attitude = attitude_rivalry }
							ai_attitude = { who = FROM attitude = attitude_hostile }
							ai_attitude = { who = FROM attitude = attitude_outraged }
							ai_attitude = { who = FROM attitude = attitude_domineering }
						}
					}
				}
				change_variable = { which = ai_accept_var_button_2_neg value = -1000 }
			}
			#Final calc
			change_variable = { which = ai_accept_var_button_2 which = ai_accept_var_button_2_pos }
			change_variable = { which = ai_accept_var_button_2 which = ai_accept_var_button_2_neg }
		}
	}
}