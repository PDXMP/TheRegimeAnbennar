### Diggy System Stuff
custom_icon = {
    name = diggy_diggy_estimate
    potential = {
		has_province_flag = diggy_diggy_estimate_flag
		owner = {
			tag = FROM
		}
	}
}

custom_button = {
	name = diggy_diggy_go
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		NOT = {
			has_province_modifier = ruined_hold
			has_province_modifier = partially_ruined_hold
			has_province_modifier = damaged_hold
			owner = { dwarovar_orc_culture_primary = yes } 
		}
		owner = {
			tag = FROM
		}
	}
	trigger = {
		has_subterranean_race = yes
		owner = {
			if = {
				limit = { NOT = { has_country_modifier = dwarven_administration } }
				if = {
					limit = {
						OR = {
							dwarovar_goblin_culture_primary = yes
							primary_culture = darkscale_kobold
						}
					}
					adm_tech = 5
				}
				else = {
					adm_tech = 7
				}
			}
			if = {
				limit = { has_disaster = remnant_stagnation_disaster }
				NOT = { has_disaster = remnant_stagnation_disaster }
			}
		}
		is_core = FROM
		is_owned_by_trade_company = no
		controlled_by = FROM
		custom_trigger_tooltip = {
			tooltip = diggy_no_building #This includes armies and such
			NOT = { has_construction = any }
		}
		NOT = { has_construction = army } #For clarity
		NOT = { has_construction = navy } #For clarity
		if = {
			limit = { is_capital = yes }
			custom_trigger_tooltip = {
				tooltip = building_diggy_tooltip
				NOT = {
					owner = {
						has_country_flag = building_diggy
					}
				}
			}
		}
		if = {
			limit = { has_province_modifier = incomplete_hold }
			NOT = { has_province_modifier = incomplete_hold }
		}
		if = { limit = { has_province_modifier = F23_flooded_depths }
			custom_trigger_tooltip = {
				tooltip = F23_cannot_dig_why
				always = no
			}
		}
		hidden_trigger = { NOT = { has_province_modifier = incomplete_hold_0 } }
		custom_trigger_tooltip = {
			tooltip = diggy_max_deepness_tooltip
			if = {
				limit = { OR = { province_id = 4119 province_id = 4311 AND = { province_id = 2931 OWNER = { has_country_flag = I98_may_come_down_flag } } AND = { province_id = 4093 owner = { has_country_flag = H76_reached_the_bottom } } } } #Big and Second capital
				NOT = { has_province_modifier = dig_11 }
			}
			else = {
				NOT = { has_province_modifier = dig_10 }
			}
		}
		if = { 
			limit = { hold_condition = { Damaged = yes } } 
			hold_condition = { Repaired = yes }
		}
		else_if = {
			limit = { has_province_modifier = dig_1 }
			development = 40
		}
		else_if = {
			limit = { has_province_modifier = dig_2 }
			development = 50
		}
		else_if = {
			limit = { has_province_modifier = dig_3 }
			development = 60
		}
		else_if = {
			limit = { has_province_modifier = dig_4 }
			development = 70
		}
		else_if = {
			limit = { has_province_modifier = dig_5 }
			development = 80
		}
		else_if = {
			limit = { has_province_modifier = dig_6 }
			development = 90
		}
		else_if = {
			limit = { has_province_modifier = dig_7 }
			development = 100
		}
		else_if = {
			limit = { has_province_modifier = dig_8 }
			development = 110
		}
		else_if = {
			limit = { has_province_modifier = dig_9 }
			development = 120
		}
		else_if = {
			limit = { has_province_modifier = dig_10 OR = { province_id = 4119 province_id = 4311 } }
			development = 130
		}
		if = {
			limit = { owner = { has_country_flag = I98_can_befuddle_flag } }
			custom_trigger_tooltip = {
				tooltip = I98_not_befuddling_tt
				NOT = { has_province_flag = I98_befuddling_hold_flag }
			}
		}
		if = {
			limit = { has_province_modifier = gor_vazumbrog_dragons_wound }
			custom_trigger_tooltip = {
				tooltip = gor_vazumbrog_digging_blocked_tt
				OR = {
					AND = {
						has_province_modifier = dig_1
						has_province_flag = gor_vazumbrog_allowed_dig_2
					}
					AND = {
						has_province_modifier = dig_2
						has_province_flag = gor_vazumbrog_allowed_dig_3
					}
				}
			}
		}
	}
	effect = {
		owner = {
			PREV = {
				if = {
					limit = { is_capital = yes }
					setup_digging_deeper_capital = yes
					start_digging_deeper = yes
				}
				else = {
					setup_digging_deeper_non_capital = yes
					start_digging_deeper_non_capital = yes
				}
			}
			set_country_flag = is_digging
			play_sound = diggy_diggy_pickaxe_sfx
		}
	}
	tooltip = dig_hold_go_button_tt
}

custom_button = {
	name = diggy_diggy_repair
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		OR = {
			has_province_modifier = ruined_hold
			has_province_modifier = partially_ruined_hold
			has_province_modifier = damaged_hold
		}
		owner = {
			tag = FROM
		}
	}
	trigger = {
		NOT = { has_construction = any }
		is_core = FROM
		if = {
			limit = { has_province_flag = cannot_repair_hold }
			custom_trigger_tooltip = {
				tooltip = diggy_cannot_repair_hold_tt
				NOT = { has_province_flag = cannot_repair_hold }
			}
		}
		owner = {
			NOT = { num_of_rebel_armies = 1 }
			is_at_war = no
			if = {
				limit = { ai = no }
				mil_power = 50
				adm_power = 50
				dip_power = 50
				treasury = 100
			}
		}
	}
	effect = {
		owner = {
			PREV = {
				hidden_effect = { setup_restoration_speed = yes }
				repair_hold = yes
			}
		}
	}
	tooltip = dig_hold_repair_button_tt
}

custom_text_box = {
	name = diggy_cost_text
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		owner = {
			tag = FROM
		}
	}
}

custom_text_box = {
	name = diggy_cost_text_label
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		owner = {
			tag = FROM
		}
	}
}

custom_text_box = {
	name = diggy_time_text
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		owner = {
			tag = FROM
		}
	}
}

custom_text_box = {
	name = diggy_time_text_label
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		owner = {
			tag = FROM
		}
	}
}

custom_icon = {
	name = diggy_diggy_bar_fill_1
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		OR = {
			has_construction = digging_deeper
			has_construction = restoring_hold
		}
		owner = {
			tag = FROM
		}
		if = {
			limit = { is_capital = yes has_construction = digging_deeper }
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = cProgress
					value = trigger_value:construction_progress
				}
				change_variable = {
					which = cProgress
					which = cons_prog
				}
				subtract_variable = {
					cProgress = 0.5
				}
				multiply_variable = {
					cProgress = 2
				}
				check_variable = {
					cProgress = 0.2
				}
			}
		}
		else = {
			construction_progress = 0.2
		}
	}
}

custom_icon = {
	name = diggy_diggy_bar_fill_2
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		OR = {
			has_construction = digging_deeper
			has_construction = restoring_hold
		}
		owner = {
			tag = FROM
		}
		if = {
			limit = { is_capital = yes has_construction = digging_deeper }
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = cProgress
					value = trigger_value:construction_progress
				}
				change_variable = {
					which = cProgress
					which = cons_prog
				}
				subtract_variable = {
					cProgress = 0.5
				}
				multiply_variable = {
					cProgress = 2
				}
				check_variable = {
					cProgress = 0.4
				}
			}
		}
		else = {
			construction_progress = 0.4
		}
	}
}

custom_icon = {
	name = diggy_diggy_bar_fill_3
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		OR = {
			has_construction = digging_deeper
			has_construction = restoring_hold
		}
		owner = {
			tag = FROM
		}
		if = {
			limit = { is_capital = yes has_construction = digging_deeper }
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = cProgress
					value = trigger_value:construction_progress
				}
				change_variable = {
					which = cProgress
					which = cons_prog
				}
				subtract_variable = {
					cProgress = 0.5
				}
				multiply_variable = {
					cProgress = 2
				}
				check_variable = {
					cProgress = 0.6
				}
			}
		}
		else = {
			construction_progress = 0.6
		}
	}
}

custom_icon = {
	name = diggy_diggy_bar_fill_4
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		OR = {
			has_construction = digging_deeper
			has_construction = restoring_hold
		}
		owner = {
			tag = FROM
		}
		if = {
			limit = { is_capital = yes has_construction = digging_deeper }
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = cProgress
					value = trigger_value:construction_progress
				}
				change_variable = {
					which = cProgress
					which = cons_prog
				}
				subtract_variable = {
					cProgress = 0.5
				}
				multiply_variable = {
					cProgress = 2
				}
				check_variable = {
					cProgress = 0.8
				}
			}
		}
		else = {
			construction_progress = 0.8
		}
	}
}

custom_icon = {
	name = diggy_diggy_bar_fill_5
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		OR = {
			has_construction = digging_deeper
			has_construction = restoring_hold
		}
		owner = {
			tag = FROM
		}
		if = {
			limit = { is_capital = yes has_construction = digging_deeper }
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = cProgress
					value = trigger_value:construction_progress
				}
				change_variable = {
					which = cProgress
					which = cons_prog
				}
				subtract_variable = {
					cProgress = 0.5
				}
				multiply_variable = {
					cProgress = 2
				}
				check_variable = {
					cProgress = 0.99
				}
			}
		}
		else = {
			construction_progress = 0.99
		}
	}
}

custom_icon = {
	name = diggy_diggy_bar_label
	potential = {
		has_province_flag = diggy_diggy_estimate_flag
		owner = {
			tag = FROM
		}
		OR = {
			has_construction = digging_deeper
			has_construction = restoring_hold
		}
	}
	tooltip = diggy_hole_progress_tt
}

custom_icon = {
	name = add_parliament_forbidden
	potential = {
		owned_by = FROM
		has_seat_in_parliament = no
		FROM = { has_country_flag = cant_manually_add_parliament_seats }
	}
	tooltip = add_parliament_forbidden_tt
}



##############################################################################################################################################################################
### PROVINCE UI GLOBAL
##############################################################################################################################################################################
# to add a button here you need to add a new one in the appropriate slot below the others
# these behave like decisions
# after that you need to add them in provinceview.gui, in three spots, do it like it's already done there to find the places CTRL+F 'province button UI' in the gui file
##############################################################################################################################################################################

#generic assets
custom_button = { #Button for the UI when building UI is closed
	name = province_button_button
	tooltip = ""
	potential = {
		owner = {
			OR = {
				tag = FROM
				is_subject_of = FROM
			}
			FROM = {
				NOT = { has_country_flag = province_button_UI_opened }
			}
		}
	}
	trigger = { }
	effect = { FROM = { set_country_flag = province_button_UI_opened } }
}
custom_button = { #Button to close the UI when building UI is closed
	name = province_button_close_button
	tooltip = ""
	potential = { }
	trigger = { }
	effect = { FROM = { clr_country_flag = province_button_UI_opened } }
}
custom_window = { #Window for the UI when building UI is closed
    name = province_button_window_closed
    potential = {
        owner = {
            OR = {
                tag = FROM
                is_subject_of = FROM
            }
            FROM = {
                has_country_flag = province_button_UI_opened
            }
        }
    }
}
custom_window = { #Window for the UI when building UI is open and no monument
    name = province_button_window_no_monument
    potential = {
		owner = {
			OR = {
				tag = FROM
				is_subject_of = FROM
			}
		}
    }
}
custom_window = { #Window for the UI when building UI is open and there is a monument
    name = province_button_window_with_monument
    potential = {
		owner = {
			OR = {
				tag = FROM
				is_subject_of = FROM
			}
		}
    }
}

#Slot 1 - Continent wide button
custom_button = { #Dummy closed
	name = GFX_province_button_dummy_1
	potential = { }
	trigger = {
		always = no
	}
	effect = { }
	tooltip = unified_province_ui_no_continent_button_tt
}
custom_button = { #Sedentarization closed
	name = sedentarization_make_outpost
	tooltip = sed_establish_outpost_button
	potential = {
		has_province_modifier = sed_forbidden
		owner = {
			tag = FROM
			culture_is_centaur = no
		}
		NOT = { has_province_modifier = sed_system_completed }
	}
	trigger = {
		# Hide the normal requirements if there's already an outpost
		if = {
			limit = { sedentarization_province_has_outpost = no }
			FROM = { sedentarization_country_can_place_outpost = yes }
			sedentarization_province_can_recieve_outpost = { owner_scope = FROM }
			if = {
				limit = {
					OR = {
						has_province_flag = sed_incomplete_sedentarization
						has_province_flag = sed_semi_complete_sedentarization
					}
					owner = { has_country_flag = sed_placing_new_phase_two_outpost }
				}
				custom_trigger_tooltip = {
					tooltip = sed_placing_new_phase_two_outpost_tt
					always = no
				}
			}
		}
		# Show the system explainer instead. (TODO probably temporary)
		else = {
			custom_trigger_tooltip = {
				tooltip = sedentarization_explainer_tt
				always = no
			}
		}
	}
	effect = {
		if = {
			limit = { sedentarization_province_has_outpost = no }
			sedentarization_place_brand_new_outpost = yes
		}
	}
}
custom_button = { #Merfolk Settlements
	name = merfolk_settlement_button
	tooltip = merfolk_settlement_tt
	potential = {
		owner = {
			tag = FROM
		}
		if = { #generate
			limit = { owner = { has_country_flag = merfolk_opinion_allied } }
			province_group = dynamic_merfolk_region
			NOT = { has_province_flag = merfolk_settlement }
		}
		else = { #interact
			has_province_flag = merfolk_settlement
			owner = { NOT = { has_country_flag = merfolk_opinion_allied } }
		}
	}
	trigger = {
		if = { #generate
			limit = { owner = { has_country_flag = merfolk_opinion_allied } }
			province_group = dynamic_merfolk_region
			NOT = { has_province_flag = merfolk_settlement }
			owner = { has_country_flag = merfolk_opinion_allied }
			development = 15
			has_trade_building_trigger = yes
			OR = { has_shipyard_building_trigger = yes has_dock_building_trigger = yes }
			
			if = {
				limit = { region = fahvanosy_region }
				NOT = { 6678 = { check_variable = { which = fahvanosyMerfolkCap value = 2 } } }
			}
			else_if = {
				limit = { region = odu_kherass_region }
				NOT = { 6678 = { check_variable = { which = oduKherassMerfolkCap value = 2 } } }
			}
			else_if = {
				limit = { region = ishyamtumu_region }
				if = {
					limit = {
						5631 = {
							has_great_project = {
								type = izmeri_the_black_stone_city
								tier = 3
							}
							owner = { can_use_izmeri_the_black_stone_city = yes }
						}
					}
					NOT = { 6678 = { check_variable = { which = ishyamtumuMerfolkCap value = 2 } } }
				}						
				else = {
					NOT = { 6678 = { check_variable = { which = ishyamtumuMerfolkCap value = 1 } } }
				}
			}
			else_if = {
				limit = { region = ringlet_isles_region }
				NOT = { 6678 = { check_variable = { which = ringletIslesMerfolkCap value = 3 } } }
			}
			else_if = {
				limit = { region = bamaliwuni_region }
				NOT = { 6678 = { check_variable = { which = bamaliwuniMerfolkCap value = 3 } } }
			}
			else_if = {
				limit = { region = throden_gokad_region }
				NOT = { 6678 = { check_variable = { which = throdenGokadMerfolkCap value = 4 } } }
			}
			else_if = {
				limit = { region = ardimya_region }
				NOT = { 6678 = { check_variable = { which = ardimyaMerfolkCap value = 7 } } }
			}
			else_if = {
				limit = { region = jasiir_jadid_region }
				NOT = { 6678 = { check_variable = { which = jasiirJadidMerfolkCap value = 7 } } }
			}
		}
		else = { #interact
			custom_trigger_tooltip = {
				tooltip = improve_merfolk_five_years_tt
				NOT = { has_province_modifier = merfolk_recently_interacted }
			}
		}
	}

	effect = {
		if = { #generate
			limit = { owner = { has_country_flag = merfolk_opinion_allied } }
			province_event = { id = merfolk_events.7 } 
		}
		else = { #interact
			hidden_effect = { add_permanent_province_modifier = { name = merfolk_recently_interacted duration = 1825 } }
			province_event = { id = merfolk_events.0 }
		}
	}
}

#Slot 2 - Province type button
custom_button = { #Dummy closed
	name = GFX_province_button_dummy_2
	potential = { }
	trigger = {
		always = no
	}
	effect = { }
	tooltip = unified_province_ui_no_province_specific_button_tt
}
custom_button = { #Diggy with ui closed
	name = dig_deeper_capital
    potential = {
		OR = {
			has_terrain = dwarven_hold
			has_terrain = dwarven_hold_surface
		}
		#Owner needs to be you, and also not be native/horde since raze/settle buttons get in the way.
		owner = {
			tag = FROM
		}
		#Blorcs can't repair non-capital holds
		OR = {
			is_capital = yes
			NOT = { owner = { dwarovar_orc_culture_primary = yes } }
		}
	}
	trigger = { #not a scripted trigger because the first if stops at it's first check (is capital)
		if = {
			limit = {
				NOT = {
					is_capital = yes
					has_province_modifier = ruined_hold
					has_province_modifier = partially_ruined_hold
					has_province_modifier = damaged_hold
					has_province_modifier = infested_hold
				}
			}
			custom_trigger_tooltip = {
				tooltip = has_centralized_hold_operations_tt
				owner = { has_country_flag = hold_operation }
			}
		}
		if = {
			limit = { owner = { is_nomad = yes } }
			owner = { NOT = { is_nomad = yes } }
		}
		if = {
			limit = { owner = { government = native } }
			owner = { NOT = { government = native } }
		}
	}
	effect = {
		hidden_effect = {
			if = {
				limit = { NOT = { has_province_flag = diggy_diggy_estimate_flag } }
				#Open digging menu
				set_province_flag = diggy_diggy_estimate_flag
				#Set up the digging preview cost and time.
				if = {
					limit = {
						OR = {
							has_province_modifier = ruined_hold
							has_province_modifier = partially_ruined_hold
							has_province_modifier = damaged_hold
						}
					}
					owner = {
						PREV = {
							setup_restoration_speed = yes
						}
					}
				}
				else = {
					if = {
						limit = { is_capital = yes }
						owner = {
							PREV = {
								setup_digging_deeper_capital = yes
							}
						}
					}
					else = {
						owner = {
							PREV = {
								setup_digging_deeper_non_capital = yes
							}
						}
					}
				}
			}
		
			else = {
				clr_province_flag = diggy_diggy_estimate_flag
			}
		}
	}
	tooltip = dig_hold_button_tt
}
custom_button = { #Ebonsteel Expand Infra replacement for players without DLC
	name = ebonsteel_expand_infra_button
	potential = {
		province_group = ebonsteel_provinces
		NOT = { has_dlc = "Leviathan" }
		owner = {
			OR = {
				AND = {
					capital_scope = { superregion = gerudia_superregion }
					OR = {
						AND = {
							culture_group = gerudian
							NOT = { primary_culture = reverian }			
						}
						primary_culture = blue_reachman
						primary_culture = fjord_troll
						primary_culture = jarnklo_harpy
					}
				}
				has_country_modifier = ebonforging_rediscovered
			}
		}
	}
	trigger = {
		if = { 
			limit = {
				owner = { NOT = { has_country_modifier = ebonforging_rediscovered } }
			}
			owner = { has_country_modifier = ebonforging_rediscovered }
		}
		if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_10 }
			custom_trigger_tooltip = {
				tooltip = ebonsteel_max_expand_infra_tt
				always = no
			}
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_9 }
			development = 150
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_8 }
			development = 135
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_7 }
			development = 120
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_6 }
			development = 105
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_5 }
			development = 90
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_4 }
			development = 75
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_3 }
			development = 60
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_2 }
			development = 45
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_1 }
			development = 30
		}
		else = {
			development = 15
		}
		if = {
			limit = { NOT = { has_province_modifier = ebonsteel_expand_infra_10 } }
			owner = { treasury = 25 }
		}
	}
	effect = {
		if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_9 }
			remove_province_modifier = ebonsteel_expand_infra_9
			add_province_modifier = {
				name = ebonsteel_expand_infra_10
				duration = -1
			}
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_8 }
			remove_province_modifier = ebonsteel_expand_infra_8
			add_province_modifier = {
				name = ebonsteel_expand_infra_9
				duration = -1
			}
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_7 }
			remove_province_modifier = ebonsteel_expand_infra_7
			add_province_modifier = {
				name = ebonsteel_expand_infra_8
				duration = -1
			}
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_6 }
			remove_province_modifier = ebonsteel_expand_infra_6
			add_province_modifier = {
				name = ebonsteel_expand_infra_7
				duration = -1
			}
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_5 }
			remove_province_modifier = ebonsteel_expand_infra_5
			add_province_modifier = {
				name = ebonsteel_expand_infra_6
				duration = -1
			}
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_4 }
			remove_province_modifier = ebonsteel_expand_infra_4
			add_province_modifier = {
				name = ebonsteel_expand_infra_5
				duration = -1
			}
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_3 }
			remove_province_modifier = ebonsteel_expand_infra_3
			add_province_modifier = {
				name = ebonsteel_expand_infra_4
				duration = -1
			}
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_2 }
			remove_province_modifier = ebonsteel_expand_infra_2
			add_province_modifier = {
				name = ebonsteel_expand_infra_3
				duration = -1
			}
		}
		else_if = {
			limit = { has_province_modifier = ebonsteel_expand_infra_1 }
			remove_province_modifier = ebonsteel_expand_infra_1
			add_province_modifier = {
				name = ebonsteel_expand_infra_2
				duration = -1
			}
		}
		else_if = {
			limit = { #to avoid weird tooltips
				NOT = { has_province_modifier = ebonsteel_expand_infra_10 }
				owner = { has_country_modifier = ebonforging_rediscovered }
			} 
			add_province_modifier = {
				name = ebonsteel_expand_infra_1
				duration = -1
			}
		}
		if = {
			limit = {
				NOT = { has_province_modifier = ebonsteel_expand_infra_10 }
				owner = { has_country_modifier = ebonforging_rediscovered }
			} 
			owner = { add_treasury = -25 }
		}
	}
	tooltip = ebonsteel_expand_infra_button_tt
}

#Slot 3 - Religion specific button
custom_button = { #Dummy closed
	name = GFX_province_button_dummy_3
	potential = { }
	trigger = {
		always = no
	}
	effect = { }
	tooltip = unified_province_ui_no_religion_button_tt
}
custom_button = { #Transmutative Path UI closed
	name = transmutative_path_infuse_chi_button
	potential = {
		owner = {
			tag = FROM
			religion = transmutative_path
		}
	}
	trigger = {
		hidden_trigger = {
			owner = {
				NOT = {
					has_country_flag = transmutative_path_infuse_chi_menu_open
					has_country_flag = transmutative_path_infuse_trade_goods_menu_open
				}
			}
		}
	}
	effect = {
		province_event = { id = transmutative_path.1 }
	}
	tooltip = infuse_chi_button_tt
}

#Slot 4 - Culture specific button
custom_button = { #Dummy closed
	name = GFX_province_button_dummy_4
	potential = { }
	trigger = {
		always = no
	}
	effect = { }
	tooltip = unified_province_ui_no_culture_button_tt
}

custom_button = {
	name = harpy_roost_button
	tooltip = harpy_roost_tt
	potential = { 
		owner = {
			tag = FROM
			culture_group = harpy
			has_country_flag = harpy_roost_setup_completed # Won't work properly if setup hasn't been completed.
		}
		OR = {
			NOT = { has_province_flag = harpy_roost_present }
			AND = {
				has_province_modifier = harpy_roost_mod_roost_fledgling
				NOT = { has_province_modifier = harpy_roost_under_construction }
			}
			harpy_roost_st_can_build_tier_3_roost_potential = yes
		}
	}
	frame = {
		number = 1
		trigger = {
			NOT = { has_province_flag = harpy_roost_present }
		}
	}
	frame = {
		number = 2
		trigger = {
			has_province_modifier = harpy_roost_mod_roost_fledgling 
		}
	}
	frame = {
		number = 3
		trigger = {
			has_province_modifier = harpy_roost_mod_roost_flourishing_active
			owner = {
				has_country_flag = harpy_roost_tier_3_unlocked
				NOT = {
					is_or_was_tag = {
						tag = Z88
					}
				}
			}
		}
	}
	frame = {
		number = 4
		trigger = {
			has_province_modifier = harpy_roost_mod_roost_flourishing_active
			owner = {
				has_country_flag = harpy_roost_tier_3_unlocked
				is_or_was_tag = {
					tag = Z88
				}
			}
		}
	}
	trigger = { 
		if = { limit = { NOT = { has_province_flag = harpy_roost_present } }
			harpy_roost_st_terrain_is_valid = yes
			FROM = { adm_power = 20 }
			controlled_by = owner
		}
		else_if = { limit = { has_province_modifier = harpy_roost_mod_roost_fledgling NOT = { has_province_modifier = harpy_roost_under_construction } } 
			harpy_roost_st_terrain_is_valid = yes
			FROM = { 
				hidden_trigger = { adm_power = 50 } # Tooltip becomes cleaner like this.
				variable_arithmetic_trigger = {
					custom_tooltip = harpy_roost_st_dev_threshold_tt
					export_to_variable = {
						which = harpy_roost_own_and_subject_development
						value = trigger_value:total_own_and_non_tributary_subject_development
					}
					check_variable = { which = harpy_roost_own_and_subject_development which = harpy_roost_var_next_threshold }
				}
			}
			controlled_by = owner
		}
		else = {
			harpy_roost_st_can_build_tier_3_roost_allow = yes
			controlled_by = owner
		}
	}
	effect = { 
		if = { limit = { NOT = { has_province_flag = harpy_roost_present } }
			harpy_roost_se_add_roost_tier_1 = yes
		}
		else_if = { limit = { has_province_modifier = harpy_roost_mod_roost_fledgling NOT = { has_province_modifier = harpy_roost_under_construction } } 
			harpy_roost_se_add_roost_tier_2 = yes 
		}
		else = {
			harpy_roost_se_add_roost_tier_3 = yes
		}
	}
}

custom_button = { #Wood Elf Ranger Camps
	name = deepwoods_rangers_button
	potential = {
		owner = {
			tag = FROM
			primary_culture = wood_elf
			OR = {
				has_reform = wood_elf_salla
				has_reform = wood_elf_salla_non_rangers
				has_reform = the_great_salla
				has_reform = autocracy_reform_sf
				has_reform = oak_monarchy_reform
			}
		}
		OR = {
			superregion = deepwoods_superregion
			region = domandrod_region
			AND = {
				region = daravans_folly_region
				owner = {
					has_country_flag = I26_folly_rangers
				}
			}
		}
		NOT = { has_terrain = fey_gladeway }
		NOT = { has_terrain = gladeway }
	}
	frame = {
		number = 1
		trigger = {
			NOT = { owner = { has_country_flag = deepwoods_rangers_disabled } }
		}
	}
	frame = {
		number = 2
		trigger = {
			owner = { 
				has_country_flag = deepwoods_rangers_disabled 
				has_country_modifier = mythical_cavalry_hawks
			}
		}
	}
	trigger = {
		if = { limit = { NOT = { owner = { has_country_flag = deepwoods_rangers_disabled } } }
			if = { #If/Else for proper tooltips
				limit = { NOT = { has_province_modifier = deepwoods_rangers_camp } }
				is_below_grove_limit_trigger = { modifier = deepwoods_rangers_camp }
				owner = {
					mil_power = 10
					treasury = 25
				}
				base_manpower = 5
			}
			else = { has_province_modifier = deepwoods_rangers_camp }
		}
		else_if = { limit = { owner = { has_country_flag = mythical_cavalry_hawks_aviary_construction_unlocked } }
			if = { limit = { NOT = { has_province_modifier = I27_great_hawk_aviary_mod } }
				is_below_grove_limit_trigger = { modifier = I27_great_hawk_aviary_mod }
				owner = {
					mil_power = 10
					treasury = 25
				}
				base_manpower = 5
			}
			else = { has_province_modifier = I27_great_hawk_aviary_mod }
		}
	}
	effect = {
		if = { limit = { NOT = { owner = { has_country_flag = deepwoods_rangers_disabled } } }
			if = {
				limit = { NOT = { has_province_modifier = deepwoods_rangers_camp } }
				owner = {
					add_mil_power = -10
					add_treasury = -25
				}
				add_province_modifier = {
					name = deepwoods_rangers_camp
					duration = -1
				}
				apply_strategy_effect = yes
			}
			else = {
				owner = { add_mil_power = 5 }
				remove_province_modifier = deepwoods_rangers_camp
				remove_strategy_effect = yes
			}
		}
		else_if = { limit = { owner = { has_country_flag = mythical_cavalry_hawks_aviary_construction_unlocked } }
			if = { limit = { NOT = { has_province_modifier = I27_great_hawk_aviary_mod } }
				owner = {
					add_mil_power = -10
					add_treasury = -25
				}
				add_province_modifier = {
					name = I27_great_hawk_aviary_mod
					duration = -1
				}
				hidden_effect = { 
					I27_se_apply_aviary_adjacency_mods = yes
					every_neighbor_province = { I27_se_apply_aviary_adjacency_mods = yes } 
				}
			}
			else = {
				owner = { add_mil_power = 5 }
				remove_province_modifier = I27_great_hawk_aviary_mod
				hidden_effect = { # Easier to remove modifiers and then add them back if needed, rather than checking if they should be removed in the first place.
					I27_se_remove_aviary_adjacency_mods = yes
					I27_se_apply_aviary_adjacency_mods = yes
					every_neighbor_province = {
						I27_se_remove_aviary_adjacency_mods = yes
						I27_se_apply_aviary_adjacency_mods = yes
					}
				}
			}
		}
		if = {
			limit = {
				region = daravans_folly_region
				owner = {
					has_country_flag = I26_free_camp
				}
			}
			owner = {
				clr_country_flag = I26_free_camp
				add_mil_power = 10
				add_treasury = 25
			}
		}
	}
	tooltip = deepwoods_rangers_button_tt
}

custom_button = { #build Lencori Behemoth shipyard
	name = lencori_behemoth_shipyard_button
	potential = {
		owner = {
			tag = FROM
			has_country_flag = have_behemoth
			lencori_qualifies_for_behemoths = yes
		}
		has_port = yes
	}
	trigger = {
		has_port = yes
		development = 10
		owner = {
			if = {
				limit = { has_estate_privilege = estate_burghers_control_over_behemoth_shipyards }
				has_estate_privilege = estate_burghers_control_over_behemoth_shipyards
				treasury = 300
			}
			else = {
				treasury = 200
			}
		}
		lencori_owner_qualifies_for_behemoths = yes
		custom_trigger_tooltip = {
			tooltip = lencori_behemoth_shipyard_naval_supplies_tt
			calc_true_if = {
				# This calc_true_if is a workaround to get a live-updating check of a > b
				# by instead checking that a-b > 0
				# where a is the total naval supplies produced
				# and b is the number of existing shipyards (with some math, precomputed by
				# the scripted effect lencori_behemoth_update_all_shipyards)
				amount = 0
				hidden_trigger = {
					owner = {
						check_variable = {
							which = lencori_behemoth_required_naval_supplies
							value = -1000
						}
						calc_true_add_naval_supplies_produced_110 = yes
					}
				}
			}
		}
		if = {
			limit = { NOT = { owner = { has_country_modifier = improved_behemoth_construction } } }
			if = {
				limit = { NOT = { owner = { has_estate_privilege = estate_burghers_control_over_behemoth_shipyards } } }
				owner_has_less_than_n_lencori_behemoth_shipyards = { n = 5 }
			}
			else = {
				owner_has_less_than_n_lencori_behemoth_shipyards = { n = 10 }
			}
		}
		else = {
			if = {
				limit = { owner = { NOT = { has_estate_privilege = estate_burghers_control_over_behemoth_shipyards} } }
				owner_has_less_than_n_lencori_behemoth_shipyards = { n = 10 }
			}
			else = {
				owner_has_less_than_n_lencori_behemoth_shipyards = { n = 15 }
			}
		}
		custom_trigger_tooltip = {
			tooltip = has_no_lencori_behemoth_shipyard_tt
			NOT = {
				OR = {
					has_province_modifier = lencori_behemoth_shipyard
					has_province_modifier = lencori_behemoth_shipyard_impress
					has_province_modifier = lencori_behemoth_shipyard_improved
					has_province_modifier = lencori_behemoth_shipyard_impress_improved
					has_province_modifier = lencori_shipyard_of_lament
				}
			}
		}
	}
	effect = {
		owner = {
			if = {
				limit = { has_estate_privilege = estate_burghers_control_over_behemoth_shipyards }
				add_treasury = -300
				add_estate_loyalty = {
					estate = estate_burghers
					loyalty = 5
				}
			}
			else = {
				add_treasury = -200
			}
			hidden_effect = {
				if = {
					limit = { has_country_modifier = improved_behemoth_construction }
					subtract_variable = {
						which = lencori_behemoth_required_naval_supplies
						value = 5
					}
				}
				else = {
					subtract_variable = {
						which = lencori_behemoth_required_naval_supplies
						value = 10
					}
				}
				export_lencori_behemoth_required_naval_supplies_value_for_tt = yes
			}
		}
		lencori_behemoth_add_shipyard_modifier = yes
	}
	tooltip = lencori_behemoth_shipyard_button_tt
}


#Slot 5 - Tag specific button
custom_button = { #Dummy closed
	name = GFX_province_button_dummy_5
	potential = { }
	trigger = {
		always = no
	}
	effect = { }
	tooltip = unified_province_ui_no_tag_button_tt
}
custom_button = { #333 empire planets
	name = khatalashya_province_button
	tooltip = khatalashya_province_button_tt
	potential = {
		owner = {
			tag = S81
		}
		has_province_flag = khatalashya_ready_to_be_colonized
	}
	trigger = {
		if = {
			limit = {
				has_province_flag = khatalashya_colonized_province
			}
			custom_trigger_tooltip = {
				tooltip = khatalashya_we_can_only_wait
				always = no
			}
		}
		else = {
			khatalashya_can_colonize_this_planet = yes
		}
		NOT = { S81 = { has_country_modifier = khatalashya_colonization_in_progress } }
		if = {
			limit = { S81 = { has_country_flag = the_hivemind_can_start } }
			custom_trigger_tooltip = {
				tooltip = khatalashya_something_is_stirring
				always = no
			}
		}
	}
	effect = {
		khatalashya_planetary_effects = yes
	}
}
custom_button = { #Xanzerbexis Wyvern Farms
	name = A49_create_wyvern_farm_button
	tooltip = A49_wyvern_farm_button_tt
	potential = {
		owner = {
			tag = FROM
			has_country_flag = A49_wyvern_farms_unlocked
		}
		A49_valid_wyvern_farm_province = yes
	}
	trigger = {
		owner = {
			treasury = 500
		}
		if = {
			limit = { has_dlc = "Leviathan" }
			num_of_times_expanded_infrastructure = 1
		}
		else = {
			development = 15
			has_production_building_trigger = yes
		}
	}
	effect = {
		owner = { 
			add_treasury = -500
		}
		set_province_flag = A49_created_wyvern_farm
		add_province_modifier = {
			name = A49_makeshift_hatchery
			duration = 3650
		}
		custom_tooltip = A49_decision_wyvern_farm_tt
		tooltip = {
			add_province_modifier = {
				name = A49_wyvern_farm
				duration = -1
			}
		}
		if = {
			limit = { owner = { has_country_flag = A49_wyvern_farm_upgrade_unlocked } }
			custom_tooltip = A49_decision_wyvern_farm_upgrade_tt
		}
		hidden_effect = {
			province_event = {
				id = flavour_xanzerbexis.1000 #Upgrade to finished wyvern farm
				days = 3650
			}
		}
	}
}
custom_button = { #Arawkelin Deforestation
	name = arawkelin_deforestation_button
	tooltip = arawkelin_deforestation_button_title_tt
    potential = {
		owner = {
			tag = Y65
			tag = FROM
			has_country_flag = arawkelin_deforestation_unlocked
		}
		OR = {
			has_terrain = jungle
			has_terrain = marsh
			has_terrain = ancient_forest
		}
		OR = {
			region = lupulan_rainforest_region
			AND = {
				owner = {
					has_country_flag = arawkelin_deforestation_ringlet_isles_unlocked
				}
				region = ringlet_isles_region
			}
			AND = {
				owner = {
					has_country_flag = arawkelin_deforestation_bamaliwuni_unlocked
				}
				region = bamaliwuni_region
			}
			AND = {
				owner = {
					has_country_flag = arawkelin_deforestation_ishyamtumu_unlocked
				}
				region = ishyamtumu_region
			}
		}
		NOT = {
			OR = {
				has_province_modifier = arawkelin_artificial_farmland
				has_province_modifier = arawkelin_furniture_manufactories
				has_province_modifier = arawkelin_half_deforestation
				has_province_modifier = arawkelin_full_deforestation
				has_province_modifier = arawkelin_deforestation_in_progress
			}
		}
	}

	trigger = {
		owner = {
			treasury = 50
			adm_power = 50
		}
		base_production = 8
		has_production_building_trigger = yes
	}
	effect = {
		owner = {
			add_treasury = -50
			add_adm_power = -50
		}
		add_province_modifier = {
			name = arawkelin_deforestation_in_progress
			duration = -1
		}
		hidden_effect = {
			set_province_flag = arawkelin_deforestation_start
			province_event = {
				id = flavour_arawkelin.101
				days = 3650
			}
		}
	}
}
custom_button = { #Verne Port of Adventure
	name = verne_port_of_adventure_button
	tooltip = verne_port_of_adventure_button_tt
	potential = {
		owner = {
			OR = {
				has_country_flag = verne_unlock_port_of_adventure_button
				overlord = { has_country_flag = verne_unlock_port_of_adventure_button }
			}
		}
		country_or_subject_holds = FROM
		OR = {
			continent = africa
			continent = south_america
			continent = north_america
			region = ringlet_isles_region
		}
		has_port = yes
	}
	trigger = {
		province_has_center_of_trade_of_level = 2
		num_of_units_in_province = {
			amount = 5
			type = infantry
			who = FROM
		}
		NOT = { has_province_modifier = verne_port_of_adventure }
	}
	effect = {
		kill_units = { who = FROM type = infantry amount = 5 }
		create_port_of_adventure = yes
		if = {
			limit = { has_province_flag = merfolk_settlement }
			merfolk_add_opinion_effect_small = yes
		}
		if = {
			limit = {
				region_for_scope_province = {
					is_empty = yes
					has_port = yes
				}
			}
			custom_tooltip = verne_port_of_adventure_button_effect_tt
			hidden_effect = {
				region = {
					limit = {
						is_empty = yes
						has_port = yes
					}
					type = random
					amount = 1
					add_siberian_construction = 100
				}
			}
		}
	}
}

custom_button = { #Chaqway
	name = chaqway_markets_button
	potential = {
		owner = {
			is_or_was_tag = { tag = G87 }
			tag = FROM
		}
	}
	trigger = {
		if = {
			limit = { owner = { has_country_flag = qhatuway_everywhere } }
			OR = {
				province_has_center_of_trade_of_level = 1
				has_river_estuary_trigger = yes
			}
		}
		else = { province_group = umas_fulcra }
		NOT = { has_province_modifier = chaqway_markets }
		owner = { dip_power = 50 }
	}
	effect = {
		if = {
			limit = { owner = { has_country_flag = qhatuway_everywhere } }
			chaqway_merchants = yes
		}
		else = {
			province_event = {
				id = chaqway.2
			}
		}
	}
	tooltip = estabilish_qhatuway
}

custom_button = {
	name = S15_aquaculture_button
	potential = {
		owner = {
			tag = S15
			tag = FROM
			NOT = { has_country_flag = S15_opened_menu }
		}
		has_port = yes
	}
	trigger = {
		owner = {
			OR = {
				mission_completed = S15_the_great_pearl_cave
				mission_completed = S15_rebuild_karassk
			}
		}
		has_port = yes
		NOT = {
			province_id = 5834
			province_id = 5895
			province_id = 5898
			province_id = 5914
			province_id = 5941
			province_id = 5949
			province_id = 6060
		}
		custom_trigger_tooltip = {
			tooltip = S15_aquaculture_building_tt
			NOT = { has_province_flag = S15_aquaculture }
		}
	}
	effect = {
		owner = {
			country_event = {
				id = flavour_karshyr.100
			}
		}
	}
	tooltip = S15_aquaculture_tt
}

custom_button = {	#celmaldor trade league investment
	name = celmaldor_trade_league_investment
	tooltip = z22_trade_league_investment_tt
	potential = { 
		has_global_flag = z22_trade_league_investment
		FROM = {
			is_or_was_tag = { tag = Z22 }
		}
		owner = {
			is_z22_vic_league_member = yes 
			NOT = {
				has_global_flag = z22_in_investment_screen
			}
		}
	}
	trigger = {
		NOT = {
			has_any_ongoing_construction = yes
		}
		num_free_building_slots = 1
		FROM = {
			is_or_was_tag = { tag = Z22 }
			treasury = 100
		}
	}
	effect = {
		set_global_flag = z22_in_investment_screen
		set_province_flag = z22_investment_province_chosen
		hidden_effect = {
			save_event_target_as = z22_investment_province_target
		}
		FROM = {
			country_event = {
				id = flavour_celmaldor.71
			}
		}
	}
}

custom_button = { #Golden Tremor Negeal Button
	name = I57_challenge_to_negeal_button
	tooltip = I57_challenge_to_negeal_button_tt
	potential = { 
		FROM = { has_country_flag = I57_enable_negeal_button_flag }
		NOT = { has_province_flag = I57_won_negeal_flag }
	}
	trigger = {
		has_ruler_leader_from = FROM
		custom_trigger_tooltip = {
			tooltip = I57_unrest_value_tt
			unrest = 0.1
		}
		area_for_scope_province = {
			type = all
			owned_by = FROM
			is_state_core = FROM
			religion = irdaeos_worship
			culture_is_centaur = yes
		}
		if = {
			limit = { 
				has_province_flag = I57_failed_negeal_flag
				FROM = { has_country_flag = I57_challenging_to_negeal_lvl_2_flag }
			}
			area_for_scope_province = {
				type = all
				NOT = { local_autonomy = 25 }
			}
		}
		else_if = {
			limit = { has_province_flag = I57_failed_negeal_flag }
			area_for_scope_province = {
				type = all
				NOT = { local_autonomy = 50 }
			}
		}
		custom_trigger_tooltip = {
			tooltip = I57_challenging_to_negeal_tt
			FROM = {
				NOT = { 
					has_country_flag = I57_challenging_to_negeal_lvl_1_flag 
					has_country_flag = I57_challenging_to_negeal_lvl_2_flag 
					has_country_flag = I57_enchained_rebels_flag
				}
			}
		}
	}
	effect = {
		if = {
			limit = { FROM = { has_country_flag = I57_enabled_stronger_negeal_flag } }
			area = {
				spawn_rebels = {
					size = 4
					type = pretender_rebels
				}
				set_local_autonomy = 100
				add_nationalism = 30
			}
			FROM = { set_country_flag = I57_challenging_to_negeal_lvl_2_flag }
			custom_tooltip = I57_challenging_to_negeal_win_lvl_2_tt
		}
		else = {
			area = {
				spawn_rebels = {
					size = 1
					type = pretender_rebels
				}
				add_local_autonomy = 25
				add_nationalism = 5
			}
			FROM = { set_country_flag = I57_challenging_to_negeal_lvl_1_flag }
			custom_tooltip = I57_challenging_to_negeal_win_lvl_1_tt
		}
		hidden_effect = {
			save_global_event_target_as = I57_negeal_target
		}
		if = {
			limit = { has_province_flag = I57_ordsiwyn_leave_prov_flag }
			custom_tooltip = I57_dev_prov_tt
		}
	}
}

custom_button = { #Umbral Covenant Spire Explode Button
	name = S90_spire_explode_button
	tooltip = S90_spire_explode_tt
	potential = { 
		FROM = { has_country_flag = S90_spire_secrets_complete }
		OR = {
			province_id = 5921
			province_id = 5763
			province_id = 5863
			province_id = 5585
			province_id = 5971
			province_id = 6032
			province_id = 5650
		}
		NOT = { 
			has_province_flag = S90_spire_exploded
		}
	}
	trigger = {
	}
	effect = {
		if = {
			limit = {
				NOT = {
					province_id = 5650
				}
			}
			FROM = {
				change_mana = { amount = 300 }
			}
			trigger_switch = {
				on_trigger = province_id
				5921 = { destroy_great_project = { type = khus_an_zhyani } }
				5763 = { destroy_great_project = { type = kazakesh } }
				5863 = { destroy_great_project = { type = kuiika_gamyi } }
				5585 = { destroy_great_project = { type = kuvunika_citadel } }
				5971 = { destroy_great_project = { type = khaga_yatsa } }
				6032 = { destroy_great_project = { type = arskitse } }
			}
			
		}
		else = {
			FROM = {
				country_event = {
					id = flavor_umbral_covenant.300
				}
			}
		}
		set_province_flag = S90_spire_exploded
	}
}

custom_button = { #Jungle Fortress for Bibyobi
	name = jungle_fortress_button
	potential = {
		owner = {
			has_country_flag = S98_fighting_imperialism_finished
			tag = FROM
		}
		region = dao_nako_region
		OR = {
			culture = kaino
			culture = jiromji
		}
	}
	trigger = {
		NOT = { 
			any_neighbor_province = {
				owned_by = FROM
				has_province_modifier = S98_jungle_fortress
			} 
		}
		owner = {
			treasury = 100
			mil_power = 50
		}
		has_fort_building_trigger = yes
	}
	
	effect = {
		every_neighbor_province = {
			limit = {
				owned_by = FROM
			}
			add_province_modifier = {
				name = S98_jungle_fortress
				duration = -1
			}
		}
		add_province_modifier = {
			name = S98_jungle_fortress
			duration = -1
		}
		owner = {
			add_treasury = -100
			add_mil_power = -50
		}
	}
	tooltip = bibyobi_jungle_fortress_button_tt
}
custom_button = { #Spiked Log - Install Spiky Traps
	name = spiked_log_install_spiky_traps_button
	tooltip = spiked_log_install_spiky_traps_button_tt
	potential = {
		FROM = { has_country_flag = spiked_log_unlock_install_trap_button }
		superregion = deepwoods_superregion
		NOT = {
			province_group = deepwoods_feytouched_gladeways
			province_group = deepwoods_inner_gladeways
		}
	}
	trigger = {
		has_fort_building_trigger = yes
		FROM = {
			mil_power = 25
			manpower = 2
		}
		NOT = { has_province_modifier = spiked_log_spiky_traps }
		spiked_log_install_spiky_trap_button_trigger = { grove = arrow }
		spiked_log_install_spiky_trap_button_trigger = { grove = shadow }
		spiked_log_install_spiky_trap_button_trigger = { grove = river }
		spiked_log_install_spiky_trap_button_trigger = { grove = hunter }
		spiked_log_install_spiky_trap_button_trigger = { grove = thorn }
		spiked_log_install_spiky_trap_button_trigger = { grove = lake }
		spiked_log_install_spiky_trap_button_trigger = { grove = bone }
		spiked_log_install_spiky_trap_button_trigger = { grove = mountain }
		spiked_log_install_spiky_trap_button_trigger = { grove = flower }
	}
	effect = {
		FROM = {
			add_mil_power = -25
			add_manpower = -2
		}
		add_permanent_province_modifier = { name = spiked_log_spiky_traps duration = -1 }
		custom_tooltip = spiked_log_spiky_trap_removal_conditions_tt
	}
}
custom_button = { #Endhuvi Traveling Society Button
	name = R36_traveling_society_button
	tooltip = R36_traveling_society_button_tt
	potential = {
		FROM = { has_country_flag = R36_enable_traveling_society_button_flag }
		is_part_of_kharunyana_river = yes
		NOT = { region = nomsyulhan_region }
		owned_by = FROM	
	}
	trigger = {
		event_target:endhuvi_cinnabar_lotus_province = { owned_by = FROM }
		is_core = FROM
		FROM = { NOT = { has_country_modifier = R36_traveling_society_button_cooldown } }
	}
	effect = {
		FROM = {
			event_target:endhuvi_cinnabar_lotus_province = {
				remove_province_modifier = R36_cinnabar_lotus_society_barge_3
				if = {
					limit = { NOT = { has_province_flag = R36_traveling_society_button_used_for_first_time } }
					set_province_flag = R36_traveling_society_button_used_for_first_time
					add_base_tax = 1
					add_base_production = 1
					add_base_manpower = 1
				}
			}
		}
		add_permanent_province_modifier = {
			name = R36_cinnabar_lotus_society_barge_3
			duration = -1
		}
		save_global_event_target_as = endhuvi_cinnabar_lotus_province
		FROM = {
			hidden_effect = { country_event = { id = flavour_endhuvi.102 } }
			add_country_modifier = {
				name = R36_traveling_society_button_cooldown
				duration = 5475
			}
		}
		custom_tooltip = R36_traveling_society_button_effect_tt
	}
}

custom_button = { #Centaur Nomadism Move Capital Button
	name = IW_move_capital_button
	tooltip = IW_move_capital_button
	potential = {
		owned_by = FROM
		FROM = { has_government_attribute = centaur_nomadism_attribute }
	}
	trigger = {
		custom_trigger_tooltip = {
			tooltip = IW_not_capital_tt
			NOT = { is_capital_of = FROM }
		}
		custom_trigger_tooltip = {
			tooltip = nomadic_capital_just_moved_tt
			FROM = { NOT = { has_country_modifier = nomadic_capital_just_moved } }
		}
		custom_trigger_tooltip = {
			tooltip = IW_adm_power_trigger_tt
			FROM = { 
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = current_adm
						value = trigger_value:adm_power
					}
					check_variable = {
						which = current_adm
						which = nzoc_cost
					}
				}
			}
		}
		controlled_by = FROM
		is_state_core = FROM
		custom_trigger_tooltip = {
			tooltip = IW_no_enemies_nearby_tt
			FROM = {
				all_war_enemy_countries = {
					ROOT = {
						NOT = {
							num_of_units_in_province = {
								amount = 1
								who = PREV
							}
						}
					}
				}
			}
		}
		if = { #Black Herd
			limit = { has_province_modifier = I55_home_to_none_but_stone }
			NOT = { has_province_modifier = I55_home_to_none_but_stone }
		}
	}
	effect = {
		FROM = { 
			hidden_effect = {
				var_effect = {
					var = nzoc_cost
					effect = "add_adm_power"
					sign = -
				}
			}
			set_capital = ROOT
			custom_tooltip = IW_adm_power_effect_tt
			add_nomadic_capital_moved_modifier = { scope = ROOT }
		}
		custom_tooltip = IW_move_capital_button_tt
	}
}

custom_button = {
	name = IW_move_capital_blocker
	potential = {
		owned_by = FROM
		FROM = { has_government_attribute = centaur_nomadism_attribute }
	}
}

# Mechanim Ward Conduit
custom_button = {
	name = mechanim_ward_conduit_button
	tooltip = mechanim_ward_conduit_button_tt
	potential = {
		owner = {
			has_country_modifier = mechanim_administration
			tag_can_use_mechanim_ward_conduit = yes
		}
		continent = oceania
	}
	trigger = {
		NOT = { has_province_modifier = mechanim_ward_conduit }
		province_can_get_mechanim_ward_conduit = yes
		NOT = { province_group = gene_pillars }
		owner = {
			treasury = 100
			adm_power = 50
			dip_power = 50
			mil_power = 50
		}
	}
	effect = {
		owner = {
			add_treasury = -100
			add_adm_power = -50
			add_dip_power = -50
			add_mil_power = -50
		}
		add_province_modifier = { name = mechanim_ward_conduit duration = -1 }
	}
}

# Gor Vazumbrog province actions
custom_button = {
	name = gor_vazumbrog_province_action_road
	tooltip = "Toggle Singing Glyphs"
	potential = {
		owned_by = FROM
		FROM = {
			has_country_flag = vault_singing_glyphs
		}
		has_terrain = dwarven_road
	}
	trigger = {
		area_for_scope_province = {
			type = all
			owned_by = FROM
		}
		custom_trigger_tooltip = {
			tooltip = vault_singing_glyphs_trigger_tt
			OR = {
				NOT = { has_province_flag = gor_vazumbrog_singing_glyphs_cooldown }
				had_province_flag = { flag = gor_vazumbrog_singing_glyphs_cooldown days = 3650 }
			}
		}
	}
	effect = {
		if = {
			limit = {
				OR = {
					has_province_modifier = gor_vazumbrog_singing_glyphs
					has_province_modifier = gor_vazumbrog_singing_glyphs_2
				}
			}
			custom_tooltip = gor_vazumbrog_singing_glyphs_remove_tt
			hidden_effect = {
				area = {
					remove_province_modifier = gor_vazumbrog_singing_glyphs
					remove_province_modifier = gor_vazumbrog_singing_glyphs_2
				}
			}
		}
		else = {
			area = {
				limit = {
					owned_by = FROM
					has_terrain = dwarven_road
				}
				set_province_flag = gor_vazumbrog_singing_glyphs_cooldown
				if = {
					limit = {
						FROM = { has_country_flag = vault_singing_glyphs_downside_revealed }
					}
					add_province_modifier = {
						name = gor_vazumbrog_singing_glyphs_2
						duration = -1
					}
				}
				else = {
					add_province_modifier = {
						name = gor_vazumbrog_singing_glyphs
						duration = -1
					}
				}
			}
			hidden_effect = {
				FROM = {
					set_country_flag = vault_singing_glyphs_used_once
					country_event = { id = flavour_gor_vazumbrog.810 days = 365 }
				}
			}
		}
	}
}

custom_button = {
	name = gor_vazumbrog_province_action_cavern
	tooltip = "Use the Hearthstone Engine"
	potential = {
		owned_by = FROM
		FROM = {
			has_country_flag = vault_hearthstone_engine
		}
		has_terrain = cavern
	}
	trigger = {
		if = {
			limit = { NOT = { has_province_modifier = vault_hearthstone_engine_mod } }
			custom_trigger_tooltip = {
				tooltip = vault_hearthstone_engine_enabled_tt
				NOT = { FROM = { has_country_flag = vault_hearthstone_engine_enabled } }
			}
		}
		custom_trigger_tooltip = {
			tooltip = vault_hearthstone_engine_locked_tt
			NOT = { has_province_flag = vault_hearthstone_engine_locked }
		}
		NOT = { trade_goods = serpentbloom }
	}
	effect = {
		if = {
			limit = {
				NOT = { has_province_modifier = vault_hearthstone_engine_mod }
			}
			add_province_modifier = {
				name = vault_hearthstone_engine_mod
				duration = -1
			}
			hidden_effect = {
				province_event = { id = flavour_gor_vazumbrog.820 days = 90 }
				province_event = { id = flavour_gor_vazumbrog.821 days = 200 } # 3 months plus a bit
				set_province_flag = vault_hearthstone_engine_locked
				FROM = {
					set_country_flag = vault_hearthstone_engine_enabled
					set_country_flag = vault_hearthstone_engine_used_once
				}
			}
		}
		else = {
			remove_province_modifier = vault_hearthstone_engine_mod
			hidden_effect = {
				FROM = { clr_country_flag = vault_hearthstone_engine_enabled }
			}
		}
	}
}

custom_button = {
	name = utubodi_unification_own_button
	potential = {
		owner = {
			tag = FROM
			has_utubodi_unification_mechanic = yes
		}
		utubodi_unification_has_collectable_resource = yes
	}
	trigger = {
		owner = {
			owns = 3675
			NOT = { is_at_war = yes }
			has_utubodi_unification_mechanic = yes
			NOT = { num_of_rebel_armies = 1 }
		}
		utubodi_unification_can_collect_resource = yes
	}
	effect = {
		utubodi_unification_add_resource = yes
		utubodi_unification_spawn_rebels_particularist = yes
		add_devastation = 100
		owner = { change_utubodi_unification_leaning = { value = 20 } }
	}
	tooltip = utubodi_unification_explanation_tooltip
}

custom_button = {
	name = utubodi_unification_vassal_button
	potential = {
		owner = {
			is_subject_of = FROM
			has_utubodi_unification_mechanic = yes
			overlord = { has_utubodi_unification_mechanic = yes }
		}
		utubodi_unification_has_collectable_resource = yes
	}
	trigger = {
		owner = {
			overlord = {
				owns = 3675
			}
			NOT = { is_at_war = yes }
			has_utubodi_unification_mechanic = yes
			NOT = { num_of_rebel_armies = 1 }
		}
		utubodi_unification_can_collect_resource = yes
	}
	effect = {
		utubodi_unification_add_resource = yes
		utubodi_unification_spawn_rebels_independence = yes
		owner = {
			add_liberty_desire = 20
			overlord = { change_utubodi_unification_leaning = { value = -20 } }
		}
	}
	tooltip = utubodi_unification_explanation_tooltip
}

#################################
# Anbennar Province UI Expanded #
#################################

# Scripted effects for managing a progress bar
###Note! The variables will take the names 'aPUI_$name$_var' and 'aPUI_$name$_capacity'

# change_aPUI_var_country = { # Change the variable of the system by an amount
# 	name = <name>
# 	#Pick one of amount or var_amount
# 	amount = <integer>
# 	var_amount = <variable_name>
# }
# change_aPUI_var_provincial = { # Change the variable of the system by an amount
# 	name = <name>
# 	#Pick one of amount or var_amount
# 	amount = <integer>
# 	var_amount = <variable_name>
# }
# set_aPUI_cap = { # Set the maximum value of the progress bar
# 	name = <name>
# 	amount = <integer>
# }
# change_aPUI_cap = { # Change the maximum value of the progress bar
# 	name = <name>
# 	amount = <integer>
# }

#Debug button for testing
custom_button = { #template button to open it, all must set 'aPUI_parent_container_flag'
	name = aPUI_debug_button
	potential = {
		FROM = {
			has_country_flag = aPUI_debug_flag
		}
	}
	effect = {
		if = {
			limit = {
				NOT = {
					has_province_flag = aPUI_template_flag
				}
			}
			clear_all_aPUI_flags = yes
			set_province_flag = aPUI_parent_container_flag
			set_province_flag = aPUI_template_flag
		}
		else = {
			clear_all_aPUI_flags = yes
		}
	}
	tooltip = "aPUI Debug Button"
}
#Baseline UI elements
custom_window = {
	name = aPUI_parent_container
	potential = {
		has_province_flag = aPUI_parent_container_flag
		# FROM = {
		# 	# tag = Z99
		# }
	}
}
custom_button = { #Close button
	name = aPUI_close_button
	effect = {
		#clr_province_flag = aPUI_parent_container_flag
		clear_all_aPUI_flags = yes
	}
}
##Template begins
custom_window = {
	name = aPUI_template_window
	potential = {
		#Must match the format 'aPUI_$name$_flag'
		has_province_flag = aPUI_template_flag
	}
}
custom_text_box = {
	#name = loc key to grab your title
	name = aPUI_template_title
}
custom_button = {
	name = aPUI_goto_province
	# tooltip = x
	# effect = {
	# 	FROM = { country_event = { id = aPUI_goto.001 } }
	# }
}
custom_button = {
	name = aPUI_template_button_1
	# tooltip = x
	# trigger = {
	# 	#Trigger about whether this button should be active
	# 	FROM = {
	# 		check_variable = { #Costs 50 'currency' to use this button
	# 			which = aPUI_template_var
	# 			value = 50
	# 		}
	# 	}
	# }
	# effect = {
	# 	FROM = {
	#		change_aPUI_var = { name = template amount = -50 }
	# 	}
	# 	#rest of effect
	# }
}
custom_text_box = {
	#name = loc key to grab your variable
	name = aPUI_template_var_text
}
custom_text_box = {
	#name = loc key to grab your loc
	name = aPUI_template_textbox
}
custom_icon = {
	name = aPUI_template_progress
	#Must match the format 'aPUI_$name$_framevar'
	frame_variable = aPUI_template_framevar
}
custom_button = {
	name = aPUI_template_frame
	# tooltip = x
	# For custom tooltips:
	# effect = {
	#	custom_tooltip = x
	# }
}

# New systems go here - removing the above once the example is PRed
custom_text_box = {
    name = aPUI_gor_vazumbrog_vault_textbox
    potential = { always = yes }
    tooltip = aPUI_gor_vazumbrog_vault_textbox_tooltip
}

# Gor Vazumbrog aPUI
custom_button = { #gor_vazumbrog_vault button to open it, all must set 'aPUI_parent_container_flag'
	name = aPUI_gor_vazumbrog_vault_button
	tooltip = "Enter the Vault"
	potential = {
		FROM = {
			has_country_flag = aPUI_gor_vazumbrog_vault_enabled_flag
		}
		province_id = 4217
		is_capital = yes
	}
	effect = {
		if = {
			limit = {
				NOT = {
					has_province_flag = aPUI_gor_vazumbrog_vault_flag
				}
			}
			clear_all_aPUI_flags = yes
			set_province_flag = aPUI_parent_container_flag
			set_province_flag = aPUI_gor_vazumbrog_vault_flag
		}
		else = {
			clear_all_aPUI_flags = yes
		}
	}
}
custom_button = { # dummy copy for the "buildings tab closed" button, which cant open the buildings tab
	name = aPUI_gor_vazumbrog_vault_button_dummy
	tooltip = "Access the Vault by opening the Buildings tab"
	potential = {
		FROM = {
			has_country_flag = aPUI_gor_vazumbrog_vault_enabled_flag
		}
		province_id = 4217
		is_capital = yes
	}
	effect = {
	}
}


##Gor_Vazumbrog_Vault begins
custom_window = {
	name = aPUI_gor_vazumbrog_vault_window
	potential = {
		#Must match the format 'aPUI_$name$_flag'
		has_province_flag = aPUI_gor_vazumbrog_vault_flag
	}
}
custom_text_box = {
	#name = loc key to grab your title
	name = aPUI_gor_vazumbrog_vault_title
}
# custom_button = {
# 	name = aPUI_goto_province
# 	# tooltip = x
# 	effect = {
# 		FROM = { country_event = { id = aPUI_goto.001 } }
# 	}
# }
# }
custom_button = {
	name = aPUI_gor_vazumbrog_vault_button_1
	tooltip = GV_TT_VAULT_DUSKGOLD
	potential = {
		FROM = {
			has_country_flag = vault_duskgold_cache
		}

	}
	trigger = {
		custom_trigger_tooltip = {
			tooltip = vault_duskgold_cache_trigger_tt
			FROM = {
				OR = {
					NOT = { has_country_flag = vault_duskgold_cache_enabled }
					had_country_flag = { flag = vault_duskgold_cache_enabled days = 3650
					}
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = { has_country_flag = vault_duskgold_cache_downside_revealed }
			}
			custom_tooltip = vault_duskgold_cache_downside_tt
		}
		if = {
			limit = {
				FROM = {
					NOT = { has_country_flag = vault_duskgold_cache_enabled }
				}
			}
			add_province_modifier = {
				name = gor_vazumbrog_vault_duskgold_cache
				duration = -1
			}
			hidden_effect = {
				FROM = {
					set_country_flag = vault_duskgold_cache_enabled
					country_event = { id = flavour_gor_vazumbrog.790 days = 730 random = 100 }
				}
			}
		}
		else = {
			remove_province_modifier = gor_vazumbrog_vault_duskgold_cache
			hidden_effect = {
				FROM = { clr_country_flag = vault_duskgold_cache_enabled }
			}
		}
	}
}

custom_button = {
	name = aPUI_gor_vazumbrog_vault_button_2
	tooltip = GV_TT_VAULT_CROWN_OF_DOMINION
	potential = {
		FROM = {
			has_country_flag = vault_crown_of_dominion
		}
	}
	trigger = {
		custom_trigger_tooltip = {
			tooltip = vault_crown_of_dominion_trigger_tt
			FROM = {
				NOT = {
					AND = {
						has_country_flag = gor_vazumbrog_crown_of_dominion_downside_revealed
						has_country_flag = gor_vazumbrog_crown_of_dominion_locked
					}
				}
			}
		}
	}
	effect = {
		FROM = {
			if = {
				limit = { NOT = { has_country_flag = gor_vazumbrog_crown_of_dominion_in_use } } # not currently on
				add_country_modifier = {
					name = gor_vazumbrog_crown_of_dominion
					duration = -1
				}
				hidden_effect = {
					set_country_flag = gor_vazumbrog_crown_of_dominion_in_use # currently on
					if = {
						limit = { NOT = { has_country_flag = gor_vazumbrog_crown_of_dominion_downside_revealed } } # 1st round
						country_event = { id = flavour_gor_vazumbrog.761 days = 300 random = 100 }
						country_event = { id = flavour_gor_vazumbrog.762 days = 600 random = 100 }
						country_event = { id = flavour_gor_vazumbrog.763 days = 900 random = 100 }
						country_event = { id = flavour_gor_vazumbrog.764 days = 1200 random = 100 }
					}
					else = { # subsequent rounds
						set_country_flag = gor_vazumbrog_crown_of_dominion_locked
						country_event = { id = flavour_gor_vazumbrog.763 days = 300 random = 100 }
						country_event = { id = flavour_gor_vazumbrog.766 days = 600 random = 100 }
					}
				}
			}
			else_if = {
				limit = {
					has_country_flag = gor_vazumbrog_crown_of_dominion_in_use # currently on
				}
				if = {
					limit = { NOT = { has_country_flag = gor_vazumbrog_crown_of_dominion_locked } } # if not locked yet, you can take it off
					remove_country_modifier = gor_vazumbrog_crown_of_dominion
					clr_country_flag = gor_vazumbrog_crown_of_dominion_in_use # currently on
				}
				else_if = {
					limit = { has_country_flag = gor_vazumbrog_crown_of_dominion_locked } # if locked,
					tooltip = {
						remove_country_modifier = gor_vazumbrog_crown_of_dominion
					}
					hidden_effect = {
						country_event = { id = flavour_gor_vazumbrog.765 }
					}
				}
			}
		}
	}
}

custom_button = {
	name = aPUI_gor_vazumbrog_vault_button_3
	tooltip = GV_TT_VAULT_EARTHSHAPER_SPHERE
	potential = {
		FROM = {
			has_country_flag = vault_earthshaper_sphere
		}
	}
	trigger = {
		custom_trigger_tooltip = {
			tooltip = vault_earthshaper_sphere_trigger_tt
			FROM = {
				NOT = { has_country_modifier = vault_earthshaper_sphere_cooldown }
			}
		}
		FROM = {
			any_owned_province = {
				is_city = yes
				has_terrain = cavern
				controlled_by = FROM
				NOT = {
					has_province_flag = citadel_province
					development = 12
				}
			}
		}
	}
	effect = {
		custom_tooltip = GV_TT_VAULT_EARTHSHAPER_SPHERE_EFFECT
		hidden_effect = {
			FROM = { add_country_modifier = { name = vault_earthshaper_sphere_cooldown duration = 730 } }
			add_province_triggered_modifier = gor_vazumbrog_earthshaper_sphere_randomizer_ptm
		}
	}
}

custom_button = {
	name = aPUI_gor_vazumbrog_vault_button_4
	tooltip = GV_TT_VAULT_LANGUAGE_OF_STONE
	potential = {
		FROM = {
			has_country_flag = vault_language_of_stone
		}
	}
	trigger = {
	}
	effect = {
		if = {
			limit = {
				FROM = { NOT = { has_country_flag = vault_language_of_stone_enabled } }
			}
			custom_tooltip = GV_TT_VAULT_LANGUAGE_OF_STONE_ENABLE
			hidden_effect = {
				add_province_triggered_modifier = gor_vazumbrog_language_of_stone_randomizer_ptm
				FROM = {
					set_country_flag = vault_language_of_stone_enabled
					country_event = { id = flavour_gor_vazumbrog.771 days = 365 }
				}
			}
		}
		else = {
			custom_tooltip = GV_TT_VAULT_LANGUAGE_OF_STONE_DISABLE
			hidden_effect = {
				FROM = {
					every_owned_province = {
						limit = { has_province_flag = vault_language_of_stone_counting_house }
						clr_province_flag = vault_language_of_stone_counting_house
						remove_building = counting_house
						remove_province_modifier = gor_vazumbrog_vault_language_of_stone_downside
					}
					clr_country_flag = vault_language_of_stone_enabled
				}
			}
		}
	}
}

custom_button = {
	name = aPUI_gor_vazumbrog_vault_button_5
	tooltip = GV_TT_VAULT_SEALED_FATES
	potential = {
		FROM = {
			has_country_flag = vault_sealed_fates
		}
	}
	trigger = {
		FROM = { NOT = { check_variable = { sealed_fates_opened = 6 } } }
	}
	effect = {
		FROM = {
			if = {
				limit = { NOT = { check_variable = { which = sealed_fates_opened value = 6 } } }
				custom_tooltip = GV_TT_VAULT_SEALED_FATES_EFFECT
			}
			if = {
				limit = { NOT = { check_variable = { which = sealed_fates_opened value = 1 } } }
				custom_tooltip = divination_0_guidance_spell
				divination_0_guidance_effect = yes
				hidden_effect = { country_event = { id = flavour_gor_vazumbrog.752 days = 90 } }
			}
			else_if = {
				limit = { NOT = { check_variable = { which = sealed_fates_opened value = 2 } } }
				custom_tooltip = divination_1_eye_for_talent_spell
				divination_1_eye_for_talent_effect = yes
				set_country_flag = flavour_gor_vazumbrog.752_skip_advisor # don't kill advisor here since the spell just gave you a discounted one
				hidden_effect = { country_event = { id = flavour_gor_vazumbrog.752 days = 90 } }
			}
			else_if = {
				limit = { NOT = { check_variable = { which = sealed_fates_opened value = 3 } } }
				custom_tooltip = divination_1_deposit_divination_spell
				divination_1_deposit_divination_effect = yes
				hidden_effect = { country_event = { id = flavour_gor_vazumbrog.752 days = 90 } }
			}
			else_if = {
				limit = { NOT = { check_variable = { which = sealed_fates_opened value = 4 } } }
				custom_tooltip = divination_2_scry_spell
				# fire scry in a hidden event to ensure ROOT is set to the country
				tooltip = { divination_2_scry_effect = yes }
				hidden_effect = {
					country_event = { id = flavour_gor_vazumbrog.753 }
					country_event = { id = flavour_gor_vazumbrog.752 days = 90 }
				}
			}
			else_if = {
				limit = { NOT = { check_variable = { which = sealed_fates_opened value = 5 } } }
				custom_tooltip = divination_2_manipulated_fortune_spell
				divination_2_manipulated_fortune_effect = yes
				hidden_effect = { country_event = { id = flavour_gor_vazumbrog.752 days = 90 } }
			}
			else_if = {
				limit = { NOT = { check_variable = { which = sealed_fates_opened value = 6 } } }
				custom_tooltip = divination_3_foresight_spell
				divination_3_foresight_effect = yes
				hidden_effect = { country_event = { id = flavour_gor_vazumbrog.751 days = 90 } }
			}
			hidden_effect = {
				change_variable = {
					which = sealed_fates_opened
					value = 1
				}
			}
		}
	}
}

custom_button = {
	name = aPUI_gor_vazumbrog_vault_button_6
	tooltip = GV_TT_VAULT_CODEX
	potential = {
		FROM = {
			has_country_flag = vault_codex_of_infinite_tactics
		}
	}
	trigger = {
		custom_trigger_tooltip = {
			tooltip = vault_codex_of_infinite_tactics_trigger_tt
			FROM = { NOT = { has_country_modifier = gor_vazumbrog_vault_codex_of_infinite_tactics_cooldown }}
		}
		FROM = {
			mil_power = 50
		}
	}
	effect = {
		FROM = {
			add_mil_power = -50
			custom_tooltip = GV_TT_VAULT_CODEX_EFFECT
			hidden_effect = {
				create_general_with_current_tradition = {
					add_fire = 1
					add_shock = 1
					add_manuever = 1
					add_siege = 1
					culture = ROOT
				}
			}
			if = {
				limit = { has_country_modifier = gor_vazumbrog_vault_codex_of_infinite_tactics_downside }
				remove_country_modifier = gor_vazumbrog_vault_codex_of_infinite_tactics_downside
				add_country_modifier = { name = gor_vazumbrog_vault_codex_of_infinite_tactics_downside_2 duration = 3650 }
			}
			else_if = {
				limit = { has_country_modifier = gor_vazumbrog_vault_codex_of_infinite_tactics_downside_2 }
				extend_country_modifier = { name = gor_vazumbrog_vault_codex_of_infinite_tactics_downside_2 duration = 3650 }
			}
			hidden_effect = {
				add_country_modifier = { name = gor_vazumbrog_vault_codex_of_infinite_tactics_cooldown duration = 1825 }
				country_event = { id = flavour_gor_vazumbrog.711 days = 730 }
			}
		}
	}
}

custom_button = {
	name = aPUI_gor_vazumbrog_vault_button_7
	tooltip = GV_TT_VAULT_ALGORITHM_OF_ETERNITY
	potential = {
		FROM = {
			has_country_flag = vault_algorithm_of_eternity
		}
	}
	trigger = {
		FROM = {
			ruler_is_not_immortal = yes
		}
		custom_trigger_tooltip = {
			tooltip = vault_algorithm_of_eternity_trigger_tt
			FROM = {
				OR = {
					NOT = { has_country_flag = vault_algorithm_of_eternity_enabled }
					had_country_flag = { flag = vault_algorithm_of_eternity_enabled days = 5475 }
				}
			}
		}
	}
	effect = {
		custom_tooltip = GV_TT_VAULT_ALGORITHM_OF_ETERNITY_EFFECT
		hidden_effect = {
			add_province_triggered_modifier = gor_vazumbrog_algorithm_of_eternity_randomizer_ptm
			FROM = {
				clr_country_flag = vault_algorithm_of_eternity_enabled
				set_country_flag = vault_algorithm_of_eternity_enabled
			}
		}
	}
}

custom_button = {
	name = aPUI_gor_vazumbrog_vault_button_8
	tooltip = GV_TT_VAULT_ENDLESS_LEDGER
	potential = {
		FROM = {
			has_country_flag = vault_endless_ledger
		}
	}
	effect = {
		FROM = {
			if = {
				limit = {
					NOT = { has_country_flag = vault_endless_ledger_enabled }
				}

				hidden_effect = { set_country_flag = vault_endless_ledger_enabled }
				if = {
					limit = {
						has_country_flag = vault_endless_ledger_downside_revealed
					}
					add_country_modifier = {
						name = gor_vazumbrog_endless_ledger_2
						duration = -1
					}
				}
				else = {
					add_country_modifier = {
						name = gor_vazumbrog_endless_ledger
						duration = -1
					}
				}
				hidden_effect = {
					country_event = { id = flavour_gor_vazumbrog.780 days = 365 }
				}
			}
			else = {
				FROM = {
					remove_country_modifier = gor_vazumbrog_endless_ledger
					remove_country_modifier = gor_vazumbrog_endless_ledger_2
					hidden_effect = {
						clr_country_flag = vault_endless_ledger_enabled
					}
				}
			}
		}
	}
}

custom_button = {
	name = aPUI_gor_vazumbrog_vault_button_11
	tooltip = GV_TT_VAULT_DELVE
	trigger = {
		# Custom tooltips to have individual X/OK marks while not having an extra FROM outside
		custom_trigger_tooltip = {
			tooltip = gor_vazumbrog_vault_delve_in_progress_tt
			FROM = { NOT = { has_country_modifier = gor_vazumbrog_vault_delve_in_progress } }
		}
		custom_trigger_tooltip = {
			tooltip = gorVazumbrogVaultDelvesAvailable_tooltip
			FROM = { check_variable = { gorVazumbrogVaultDelvesAvailable = 1 } }
		}
		custom_trigger_tooltip = {
			tooltip = mil_power_50_tt
			FROM = { mil_power = 50 }
		}
		custom_trigger_tooltip = {
			tooltip = treasury_500_tt
			FROM = { treasury = 500 }
		}
		custom_trigger_tooltip = {
			tooltip = gor_vazumbrog_vault_delve_custom_trigger
			# complicated stuff to hide/consolidate these delve-specific triggers
			# -- needed because I heard if statements in custom ui triggers spam error log
			FROM = {
				NOT = {
					AND = { # use the cavern action at least once
						has_country_flag = vault_hearthstone_engine
						NOT = {	has_country_flag = vault_hearthstone_engine_used_once }
					}
					AND = { # use the road action at least once
						has_country_flag = vault_singing_glyphs
						NOT = {	has_country_flag = vault_singing_glyphs_used_once }
					}
					AND = { # research step 1
						has_country_flag = vault_crown_of_dominion
						NOT = {
							has_country_flag = vault_anvil_of_unmaking_basic_research
							has_estate = estate_artificers
						}
					}
					AND = { # research step 2
						has_country_flag = vault_anvil_of_unmaking_basic_research
						NOT = {
							has_country_flag = vault_anvil_of_unmaking_advanced_research
							any_owned_province = { has_province_modifier = gor_vazumbrog_black_damestear_workshop }
						}
					}
				}
			}
		}
	}
	effect = {
		FROM = {
			add_mil_power = -50
			add_treasury = -500
			hidden_effect = {
				country_event = { id = flavour_gor_vazumbrog.555 }
			}
		}
	}
}