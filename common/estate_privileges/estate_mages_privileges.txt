##########################
### BASE ORGANIZATIONS ###
##########################

estate_mages_organization_state = {
	icon = privilege_promote_maratha_nobility
	loyalty = 0.05
	land_share = 10
	is_valid = {
		NOT = { tag = A85 }
		NOT = { has_mages_special_organization_privilege = yes }
	}
	can_select = { can_pay_for_organization_swap = { estate = mages } }
	can_revoke = {
		always = no
	}
	on_granted = {
		pay_for_organization_swap = { organization = state }
		hidden_effect = {
			if = {
				limit = { NOT = { is_year = 1445 } }
				take_estate_land_share_gigantic = { estate = estate_mages }
			}
		}
		scaling_with_influence_privilege_tooltip = {
			estate_privilege = estate_mages_organization_state
		}
	}

	influence_scaled_conditional_modifier = {
		trigger = {
			NOT = {
				estate_loyalty = {
					estate = estate_mages
					loyalty = 30
				}
			}
		}
		modifier = {
			mages_estate_experience_mod = -0.2
		}
	}
	influence_scaled_conditional_modifier = {	#Modifier that are applied if the specified conditions are true. At 100% Influence you gain 100% of the modifier.
		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 30
			}
			NOT = {
				estate_loyalty = {
					estate = estate_mages
					loyalty = 60
				}
			}
		}
		modifier = {
			mages_estate_experience_mod = 0.1
		}
	}
	influence_scaled_conditional_modifier = {	#Modifier that are applied if the specified conditions are true. At 100% Influence you gain 100% of the modifier.
		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 60
			}
		}
		modifier = {
			mages_estate_experience_mod = 0.2
		}
	}

	conditional_modifier = {
		trigger = {
			has_country_flag = J33_mage_only_flag
		}
		modifier = {
			mages_loyalty_modifier = 0.1
			mages_influence_modifier = 0.1
		}
	}
	ai_will_do = {
		factor = 5
		modifier = {
			factor = 10
			current_age = age_of_absolutism
		}
		modifier = {
			factor = 0
			has_estate_privilege = estate_mages_organization_magisterium
		}
	}
}
estate_mages_organization_guilds = {
	icon = privilege_promote_maratha_nobility
	max_absolutism = -10
	conditional_modifier = {
		trigger = {
			has_absolutism_reduction_for_estate_privileges = yes
			NOT = { has_country_flag = remove_absolutism_from_guilds }
		}
		modifier = { max_absolutism = 2 }
	}
	influence = 0.05
	is_valid = {
		NOT = { tag = A85 }
		NOT = { has_mages_special_organization_privilege = yes }
	}
	can_select = { can_pay_for_organization_swap = { estate = mages } }
	can_revoke = {
		always = no
	}
	on_granted = {
		pay_for_organization_swap = { organization = guilds }
		hidden_effect = {
			if = {
				limit = { NOT = { is_year = 1445 } }
				take_estate_land_share_gigantic = { estate = estate_mages }
			}
		}
		if = {
			limit = { has_country_flag = depowered_the_magisterium }
			custom_tooltip = guilds_mage_org_extra_effect_tt
		}
		scaling_with_influence_privilege_tooltip = {
			estate_privilege = estate_mages_organization_guilds
		}
	}
	conditional_modifier = {
		trigger = { has_country_flag = depowered_the_magisterium }
		modifier = {
			mages_influence_modifier = 0.05
			mages_loyalty_modifier = 0.05
		}
	}
	conditional_modifier = {
		trigger = { has_country_flag = remove_absolutism_from_guilds }
		modifier = { max_absolutism = 10 }
	}

	influence_scaled_conditional_modifier = {
		trigger = {
			NOT = {
				estate_loyalty = {
					estate = estate_mages
					loyalty = 30
				}
			}
		}
		modifier = {
			mages_ruler_experience_mod = -0.2
		}
	}
	influence_scaled_conditional_modifier = {	#Modifier that are applied if the specified conditions are true. At 100% Influence you gain 100% of the modifier.
		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 30
			}
			NOT = {
				estate_loyalty = {
					estate = estate_mages
					loyalty = 60
				}
			}
		}
		modifier = {
			mages_ruler_experience_mod = 0.1
		}
	}
	influence_scaled_conditional_modifier = {	#Modifier that are applied if the specified conditions are true. At 100% Influence you gain 100% of the modifier.
		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 60
			}
		}
		modifier = {
			mages_ruler_experience_mod = 0.2
		}
	}
	ai_will_do = {
		factor = 0
	}
}
estate_mages_organization_religious = {
	icon = privilege_promote_maratha_nobility
	max_absolutism = -5
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 1 } }
	influence = 0.1
	land_share = 5
	is_valid = {
		NOT = { tag = A85 }
		OR = {
			has_estate = estate_church
			religion_group = centaur_religion
			religion_group = raheni
		}
		NOT = { has_mages_special_organization_privilege = yes }
	}
	can_select = {
		if = {
			limit = {
				religion_group = centaur_religion
				NOT = { has_estate = estate_church }
			}
			OR = {
				religious_school = {
					group = centaur_religion
					school = malukhuga_school
				}
				has_country_modifier = malukhuga_scholar_modifier
			}
		}
		can_pay_for_organization_swap = { estate = mages }
	}
	can_revoke = {
		always = no
	}
	on_granted = {
		pay_for_organization_swap = { organization = religious }
		hidden_effect = {
			if = {
				limit = { NOT = { is_year = 1445 } }
				take_estate_land_share_massive = { estate = estate_mages }
			}
		}
		scaling_with_influence_privilege_tooltip = {
			estate_privilege = estate_mages_organization_religious
		}
	}
	on_invalid = {
		custom_tooltip = estate_mages_religious_invalid_tooltip
		hidden_effect = {
			if = {
				limit = { NOT = { has_mages_organization_privilege = yes } }
				set_estate_privilege = estate_mages_organization_state
			}
		}
	}
	conditional_modifier = {
		trigger = { NOT = { religious_unity = 0.5 } }
		modifier = {
			mages_loyalty_modifier = -0.05
			church_influence_modifier = -0.05
		}
		is_bad = yes
	}
	conditional_modifier = {
		trigger = { religious_unity = 0.5 }
		modifier = {
			mages_loyalty_modifier = 0.05
			church_influence_modifier = 0.05
		}
	}

	influence_scaled_conditional_modifier = {
		trigger = {
			NOT = {
				estate_loyalty = {
					estate = estate_mages
					loyalty = 30
				}
			}
		}
		modifier = {
			global_missionary_strength = -0.04

			papal_influence = -2
			monthly_fervor_increase = -0.5
			church_power_modifier = -0.2
			monthly_piety_accelerator = -0.002
			yearly_karma_decay = -0.2
			yearly_doom_reduction = -2
			yearly_authority = -0.3
			yearly_patriarch_authority = -0.01
			yearly_harmony = -0.5

			mages_monthly_experience = -0.5
		}
	}
	influence_scaled_conditional_modifier = {	#Modifier that are applied if the specified conditions are true. At 100% Influence you gain 100% of the modifier.
		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 30
			}
			NOT = {
				estate_loyalty = {
					estate = estate_mages
					loyalty = 60
				}
			}
		}
		modifier = {
			global_missionary_strength = 0.02

			papal_influence = 1
			monthly_fervor_increase = 0.25
			church_power_modifier = 0.1
			monthly_piety_accelerator = 0.001 #inaccessible unless you're at 100%
			yearly_karma_decay = 0.1
			yearly_doom_reduction = 1
			yearly_authority = 0.15
			yearly_patriarch_authority = 0.005
			yearly_harmony = 0.25

			mages_monthly_experience = 0.25
		}
	}
	influence_scaled_conditional_modifier = {	#Modifier that are applied if the specified conditions are true. At 100% Influence you gain 100% of the modifier.
		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 60
			}
		}
		modifier = {
			global_missionary_strength = 0.04

			papal_influence = 2
			monthly_fervor_increase = 0.5
			church_power_modifier = 0.2
			monthly_piety_accelerator = 0.002 #inaccessible unless you're at 50% influence
			yearly_karma_decay = 0.2
			yearly_doom_reduction = 2
			yearly_authority = 0.3
			yearly_patriarch_authority = 0.01
			yearly_harmony = 0.5

			mages_monthly_experience = 0.5
		}
	}
	ai_will_do = {
		factor = 5
		modifier = {
			factor = 0.8
			OR = {
				NOT = { crown_land_share = 40 }
				AND = {
					is_absolutism_active = yes
					NOT = { crown_land_share = 60 }
				}
			}
		}
		modifier = {
			factor = 0.8
			OR = {
				NOT = { crown_land_share = 30 }
				AND = {
					is_absolutism_active = yes
					NOT = { crown_land_share = 50 }
				}
			}
		}
		modifier = {
			factor = 0.8
			is_absolutism_active = yes
		}
	}
}

##############################
### REGIONAL ORGANIZATIONS ###
##############################

estate_mages_organization_magisterium = {
	icon = privilege_promote_maratha_nobility
	max_absolutism = 0
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 2 } }
	land_share = 5
	influence = 0.15
	is_valid = {
		OR = {
			AND = {
				tag = Z01 #Empire of Anbennar
				is_revolutionary = no #Blackpowder Anbennar
			}
			AND = {  #Magisterium exists and can form a relationship with you
				knows_country = A85
				A85 = { knows_country = ROOT }
			}
		}
		NOT = { has_mages_special_organization_privilege = yes }
	}
	can_select = {
		OR = {
			is_part_of_hre = yes
			tag = A85 #Magisterium
			reverse_has_opinion = { who = A85 value = 150 }
		}
		can_pay_for_organization_swap = { estate = mages }
	}
	can_revoke = {
		always = no
	}
	on_granted = {
		pay_for_organization_swap = { organization = magisterium }
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			custom_tooltip = estate_mages_magisterium_relations_tooltip
		}
		hidden_effect = {
			if = {
				limit = { NOT = { is_year = 1445 } }
				take_estate_land_share_massive = { estate = estate_mages }
			}
		}
		scaling_with_influence_privilege_tooltip = {
			estate_privilege = estate_mages_organization_magisterium
		}
	}

	influence_scaled_conditional_modifier = {
		trigger = {
			NOT = {
				estate_loyalty = {
					estate = estate_mages
					loyalty = 30
				}
			}
		}
		modifier = {
			mages_estate_experience_mod = -0.25
			mages_ruler_experience_mod = -0.25
			necromancy_experience_mod = 0.25
		}
	}
	influence_scaled_conditional_modifier = {	#Modifier that are applied if the specified conditions are true. At 100% Influence you gain 100% of the modifier.
		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 30
			}
			NOT = {
				estate_loyalty = {
					estate = estate_mages
					loyalty = 60
				}
			}
		}
		modifier = {
			mages_estate_experience_mod = 0.1
			mages_ruler_experience_mod = 0.1
			necromancy_experience_mod = -0.1
		}
	}
	influence_scaled_conditional_modifier = {	#Modifier that are applied if the specified conditions are true. At 100% Influence you gain 100% of the modifier.
		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 60
			}
		}
		modifier = {
			mages_ruler_experience_mod = 0.25
			mages_estate_experience_mod = 0.25
			necromancy_experience_mod = -0.25
		}
	}
	penalties = {
	}
	benefits = {
		imperial_authority = 0.05
	}
	conditional_modifier = {
		trigger = {
			exists = A85
			NOT = { is_or_was_tag = { tag = A85 } }
			NOT = {
				reverse_has_opinion = {
					who = A85 #Magisterium
					value = 0
				}
			}
		}
		modifier = {
			mages_loyalty_modifier = -0.05
		}
	}
	conditional_modifier = {
		trigger = {
			exists = A85
			NOT = { is_or_was_tag = { tag = A85 } }
			reverse_has_opinion = {
				who = A85 #Magisterium
				value = 100
			}
		}
		modifier = {
			mages_loyalty_modifier = 0.05
		}
	}
	conditional_modifier = {
		trigger = {
			OR = {
				is_or_was_tag = { tag = A85 } #Magisterium
				is_or_was_tag = { tag = Z01 } #Empire of Anbennar
			}
		}
		modifier = {
			mages_loyalty_modifier = 0.1
		}
	}
	ai_will_do = {
		factor = 5
		modifier = {
			factor = 100
			tag = A85
		}
		modifier = {
			factor = 10
			is_part_of_hre = yes
		}
	}
}

##########################
### REGULAR PRIVILEGES ###
##########################

estate_mages_magocratic_administration = {
	icon = privilege_grant_autonomy
	loyalty = 0.05
	influence = 0.05
	max_absolutism = -5
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 1 } }
	land_share = 5
	is_valid = {
		NOT = { religion = gods_of_the_taychend religion = oren_nayiru }
	}
	benefits = { governing_capacity = 100 }
	penalties = { nobles_loyalty_modifier = -0.05 uppercastes_loyalty_modifier = -0.05 }
	
	ai_will_do = {
		factor = 5

		modifier = {
			factor = 10
			OR = {
				crown_land_share = 50
				governing_capacity_percentage = 0.8
				has_estate_privilege = estate_mages_magocratic_administration
			}
		}
	}
}

estate_mages_seek_magical_advice = {
	icon = privilege_missionary
	loyalty = 0.0
	influence = 0.05
	max_absolutism = -5
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 1 } }
	is_valid = { NOT = { tag = I02 } }

	conditional_modifier = { #Deranne
		trigger = { mission_completed = deranne_traditions_of_old  }
		modifier = { 
			stability_cost_modifier = -0.05
		}
	}

	on_granted = {
		enable_estate_action = { estate_action = RECRUIT_COURT_MAGE }
	}
	on_revoked = {
		disable_estate_action = { estate_action = RECRUIT_COURT_MAGE }
	}
	on_invalid = {
		disable_estate_action = { estate_action = RECRUIT_COURT_MAGE }
	}

	ai_will_do = { factor = 0 }
}

estate_mages_reduced_research_regulations = {
	icon = privilege_land_rights
	influence = 0.05
	max_absolutism = -10
	conditional_modifier = {
		trigger = {
			has_absolutism_reduction_for_estate_privileges = yes
			NOT = { has_country_flag = remove_absolutism_from_regulations hre_reform_passed = anbennar_imperial_wizards }
		}
		modifier = { max_absolutism = 2 }
	}
	is_valid = {
		NOT = { tag = I02 }
		NOT = { has_country_flag = vacyntassi_jaherian_statute_flag }
	}
	on_granted = {
		custom_tooltip = tooltip_estate_mages_reduced_research_regulations
	}
	conditional_modifier = {
		trigger = { NOT = { has_country_flag = remove_dip_from_regulations } }
		modifier = { diplomatic_reputation = -1 }
		is_bad = yes
	}
	conditional_modifier = {
		trigger = { has_country_flag = remove_absolutism_from_regulations }
		modifier = { max_absolutism = 10 }
	}
	conditional_modifier = {
		trigger = { mission_completed = F71_a_silent_strike }
		modifier = { governing_capacity_modifier = 0.05 }
	}
	conditional_modifier = { #eoa imperial wizards
		trigger = {
			hre_reform_passed = anbennar_imperial_wizards
			OR = { is_part_of_hre = yes tag = Z01 is_subject_of = Z01 }
		}
		modifier = { max_absolutism = 10 }
	}
	conditional_modifier = {
		trigger = { has_country_flag = L68_sharknado }
		modifier = {
			global_naval_barrage_cost = -0.50
			reduced_liberty_desire = 25
		}
	}
	benefits = {
	}
	ai_will_do = {
		factor = 5
		modifier = {	#witch kings baby
			factor = 3
			capital_scope = { superregion = escann_superregion }
			current_age = age_of_absolutism
		}
		modifier = {	#witch kings are evil baby
			factor = 3
			ruler_is_witch_king = yes
		}
		modifier = {
			factor = 0.75
			NOT = { diplomatic_reputation = 1 }	#dont want to take this if you have low dip rep anyway
		}
		modifier = {
			factor = 1.5
			ruler_is_powerful_mage = yes
		}
		modifier = {
			factor = 2
			OR = {
				ruler_has_personality = naive_personality
				ruler_has_personality = free_thinker_personality
				ruler_has_personality = zealot_personality
			}
		}
		modifier = {
			factor = 0.75
			OR = {
				ruler_has_personality = careful_personality
				ruler_has_personality = just_personality
				ruler_has_personality = righteous_personality
			}
		}
		modifier = {
			factor = 0.5
			has_estate_privilege = estate_mages_organization_magisterium
		}
		modifier = {
			factor = 0
			OR = {
				has_government_attribute = is_raja
				is_emperor_of_china = yes
			}
		}
	}
}

estate_mages_development_of_mage_towers = {
	icon = privilege_temple_complex
	loyalty = 0.05
	influence = 0.05
	max_absolutism = -5
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 1 } }
	is_valid = { NOT = { tag = I02 } }

	on_granted = {
		custom_tooltip = estate_mages_development_of_mage_towers_gt
		if = {
			limit = { NOT = { has_government_attribute = caretakers_of_mage_towers_upgrade  } }
			tooltip = {
				add_province_modifier = {
					name = estate_mages_development_of_mage_towers_mod
					duration = -1
				}
			}
		}
		else = {
			tooltip = {
				add_province_modifier = {
					name = estate_mages_development_of_mage_towers_improved_mod
					duration = -1
				}
			}
		}
		
	}
	on_revoked = {
		custom_tooltip = estate_mages_development_of_mage_towers_rt
	}
	on_granted_province = {
		if = {
				limit = { has_building = mage_tower }
			if = {
				limit = { owner = { NOT = { has_government_attribute = caretakers_of_mage_towers_upgrade  } } }
				add_province_modifier = {
					name = estate_mages_development_of_mage_towers_mod
					duration = -1
				}
			}
			else = {
				add_province_modifier = {
					name = estate_mages_development_of_mage_towers_improved_mod
					duration = -1
				}
			}
		}
	}
	on_revoked_province = {
		remove_province_modifier = estate_mages_development_of_mage_towers_mod
		remove_province_modifier = estate_mages_development_of_mage_towers_improved_mod
	}
	on_invalid_province = {
		remove_province_modifier = estate_mages_development_of_mage_towers_mod
		remove_province_modifier = estate_mages_development_of_mage_towers_improved_mod
	}

	mechanics = {
		no_estate_crownland_loss_from_developing
	}

	ai_will_do = {
		factor = 100
	}
}

estate_mages_land_grant_academies = {
	icon = estate_eunuchs_land_rights_privilege
	influence = 0.05
	max_absolutism = -5
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 1 } }
	is_valid = { NOT = { tag = I02 } }
	land_share = 10

	modifier_by_land_ownership = {
		mages_ruler_experience_mod = 0.5
		mages_estate_experience_mod = 0.5
	}

	mechanics = {
		exempt_from_seize_land
	}

	on_granted = { scaling_with_land_share_privilege_tooltip = { estate_privilege = estate_mages_land_grant_academies } }

	on_revoked = { scaling_with_land_share_privilege_tooltip = { estate_privilege = estate_mages_land_grant_academies } }

	ai_will_do = { factor = 0 }
}

######################
### AGE PRIVILEGES ###
######################

estate_mages_learn_from_elven_elders = {
	icon = estate_eunuchs_royal_intrigue_keepers_privilege
	influence = 0.05

	is_valid = { NOT = { tag = I02 } current_age = age_of_discovery } #age of greentide
	can_select = {
		current_age = age_of_discovery
		NOT = { has_estate_privilege = estate_mages_monstrous_regiment }
		OR = {
			has_country_modifier = elven_administration
			any_ally = {
				has_country_modifier = elven_administration
			}
			any_subject_country = {
				has_country_modifier = elven_administration
			}
			overlord = {
				has_country_modifier = elven_administration
			}
		}
	}
	
	benefits = {
		global_institution_spread = 0.1
		mages_estate_experience_mod = 0.05
	}
	ai_will_do = {
		factor = 100
	}
}

estate_mages_monstrous_regiment = {
	icon = privilege_macuahuitl
	influence = 0.05

	is_valid = { NOT = { tag = I02 } current_age = age_of_discovery } #age of greentide
	can_select = {
		current_age = age_of_discovery
		NOT = { has_estate_privilege = estate_mages_learn_from_elven_elders }
		OR = {
			AND = {
				has_country_modifier = monstrous_nation
				custom_trigger_tooltip = {
					tooltip = annexed_non_monstrous
					has_country_flag = annexed_non_monstrous
				}
			}
			AND = {
				NOT = { has_country_modifier = monstrous_nation }
				custom_trigger_tooltip = {
					tooltip = annexed_monstrous
					has_country_flag = annexed_monstrous
				}
			}
		}
	}
	
	benefits = {
		available_province_loot = 0.1
		mages_estate_experience_mod = 0.05
	}
	ai_will_do = {
		factor = 100
	}
}

estate_mages_aelantiri_magical_rediscovery = {
	icon = privilege_new_world_mission
	loyalty = 0.05
	influence = 0.05
	
	is_valid = { NOT = { tag = I02 } current_age = age_of_reformation } #age of unraveling
	can_select = {
		current_age = age_of_reformation
		NOT = { has_estate_privilege = estate_mages_thousand_flowers_bloom }
		OR = {
			capital_scope = {
				OR = {
					continent = north_america
					continent = south_america
				}
			}
			any_ally = { has_country_modifier = ruinborn_administration }
			colony = 1
		}
		years_of_income = 1
	}

	on_granted = { add_years_of_income = -1 }
	benefits = {
		idea_cost = -0.05
		mages_estate_experience_mod = 0.1
	}

	ai_will_do = {
		factor = 100
	}
}

estate_mages_thousand_flowers_bloom = {
	icon = privilege_tolerance_heretics
	loyalty = 0.05
	influence = 0.05
	
	is_valid = { NOT = { tag = I02 } current_age = age_of_reformation } #age of unraveling
	can_select = {
		current_age = age_of_reformation
		NOT = { has_estate_privilege = estate_mages_aelantiri_magical_rediscovery }
		custom_trigger_tooltip = {
			tooltip = changed_religion
			has_country_flag = changed_religion
		}
		is_force_converted = no
		years_of_income = 1
	}

	on_granted = { add_years_of_income = -1 }
	benefits = {
		global_heretic_missionary_strength = 0.005
		tolerance_heretic = 0.5
		mages_estate_experience_mod = 0.1
	}

	ai_will_do = {
		factor = 100
	}
}

estate_mages_empowerment_of_witch_kings = {
	icon = privilege_cast_spell
	loyalty = 0.05
	influence = 0.05
	max_absolutism = 10

	is_valid = { NOT = { tag = I02 } current_age = age_of_absolutism } #age of witch kings
	can_select = {
		current_age = age_of_absolutism
		NOT = { has_estate_privilege = estate_mages_laws_against_witch_kings }
		OR = {
			ruler_is_witch_king = yes
			absolutism = 80
		}
	}

	on_granted = { custom_tooltip = higher_chance_of_powerful_mage_tt }
	benefits = { mages_ruler_experience_mod = 0.15 }
	penalties = { diplomatic_reputation = -1 }

	ai_will_do = {
		factor = 100
	}
}

estate_mages_laws_against_witch_kings = {
	icon = privilege_prohibited_education
	loyalty = 0.05
	influence = -0.05
	max_absolutism = -10
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 2 } }

	is_valid = { NOT = { tag = I02 } current_age = age_of_absolutism } #age of witch kings
	can_select = {
		current_age = age_of_absolutism
		NOT = { has_estate_privilege = estate_mages_empowerment_of_witch_kings }
		ruler_is_not_witch_king = yes
		NOT = { absolutism = 80 }
	}
	
	benefits = {
		diplomatic_reputation = 1
		mages_estate_experience_mod = 0.15
	}
	
	ai_will_do = {
		factor = 100
	}
}

estate_mages_the_scientific_method = {
	icon = privilege_Artf_Research
	loyalty = -0.05
	max_absolutism = -5
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 1 } }

	is_valid = { NOT = { tag = I02 } current_age = age_of_revolutions } #age of artificers
	can_select = {
		current_age = age_of_revolutions
		NOT = { has_estate_privilege = estate_mages_magocratic_reactionism }
		is_in_mixed_mode = yes
		innovativeness = 80
	}

	benefits = {
		mages_estate_experience_mod = 0.2
		technology_cost = -0.025
	}

	ai_will_do = {
		factor = 100
	}
}

estate_mages_magocratic_reactionism = {
	icon = privilege_seek_support_of_clergy
	loyalty = 0.05
	influence = 0.05
	max_absolutism = -5
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 1 } }

	is_valid = { NOT = { tag = I02 } current_age = age_of_revolutions } #age of artificers
	can_select = {
		current_age = age_of_revolutions
		NOT = { has_estate_privilege = estate_mages_the_scientific_method }
		is_in_mage_mode = yes
		OR = {
			custom_trigger_tooltip = {
				tooltip = is_magocracy_tt
				has_government_attribute = is_magocracy
			}
			has_reform = magical_elite_reform
		}
	}

	benefits = { mages_mana_regen_mult = 0.1 }
	penalties = { yearly_innovativeness = -0.36 }

	on_granted = { hidden_effect = { update_mana_regen_vars = yes } }
	on_revoked = { hidden_effect = { update_mana_regen_vars = yes } }
	on_invalid = { hidden_effect = { update_mana_regen_vars = yes } }

	ai_will_do = {
		factor = 100
	}
}

##############################
### Magical Infrastructure ###
##############################
estate_mages_battlemage_academies = {
	icon = privilege_demand_more_troops
	max_absolutism = -5
	conditional_modifier = {
		trigger = {
			has_absolutism_reduction_for_estate_privileges = yes
			NOT = { has_country_flag = remove_absolutism_from_battlemages hre_reform_passed = anbennar_imperial_wizards }
		}
		modifier = { max_absolutism = 1 }
	}
	influence = 0.05
	land_share = 10
	is_valid = {
		NOT = { tag = I02 }
		NOT = { has_country_flag = no_battlemage_academies }
		OR = {
			has_country_flag = may_grant_battlemage_academies
			is_in_mage_mode = yes
		}
		NOT = { mission_completed = A33_binding_the_beast }
	}
	can_select = {
		OR = {
			custom_trigger_tooltip = {
				tooltip = may_grant_battlemage_academies
				has_country_flag = may_grant_battlemage_academies
			}
			AND = {
				is_in_mage_mode = yes
				at_least_magical_infrastructure_level_1 = yes
			}
		}
		custom_trigger_tooltip = {
			tooltip = not_enabled_war_wizards_another_way
			NOT = { has_enabled_estate_action = { estate_action = RECRUIT_WAR_WIZARD } }
		}
	}
	on_granted = {
		custom_tooltip = tooltip_estate_mages_battlemage_academies
		enable_estate_action = { estate_action = RECRUIT_WAR_WIZARD }
	}
	on_revoked = {
		disable_estate_action = { estate_action = RECRUIT_WAR_WIZARD }
	}
	on_invalid = {
		disable_estate_action = { estate_action = RECRUIT_WAR_WIZARD }
	}
	conditional_modifier = {
		trigger = { NOT = { has_country_flag = remove_decay_from_battlemages } }
		modifier = { army_tradition_decay = 0.01 }
		is_bad = yes
	}
	conditional_modifier = {
		trigger = { has_country_flag = remove_absolutism_from_battlemages }
		modifier = { max_absolutism = 5 }
	}
	conditional_modifier = {
		trigger = { has_country_flag = remove_influence_from_battlemages }
		modifier = {
			mages_influence_modifier = -0.05
			mages_loyalty_modifier = 0.05
		}
	}
	conditional_modifier = {
		trigger = { mission_completed = F71_a_silent_strike }
		modifier = { governing_capacity_modifier = 0.05 }
	}
	conditional_modifier = { #eoa imperial wizards
		trigger = {
			hre_reform_passed = anbennar_imperial_wizards
			OR = { is_part_of_hre = yes tag = Z01 is_subject_of = Z01 }
		}
		modifier = { max_absolutism = 5 }
	}
	conditional_modifier = {
		trigger = { mission_completed = gor_vazumbrog_bonded_by_firepower }
		modifier = {
			mages_influence_modifier = 0.05
			mages_loyalty_modifier = 0.1
			max_absolutism = 5
			army_tradition_decay = -0.01
		}
	}
	ai_will_do = {
		factor = 6
		modifier = {
			factor = 10
			at_least_magic_project_level = { project = battlemage_academy level = 1 }
		}
	}
}

estate_mages_investments_in_magical_arts = {
	icon = privilege_give_money
	loyalty = 0.1
	influence = 0.1
	max_absolutism = -5
	conditional_modifier = {
		trigger = {
			has_absolutism_reduction_for_estate_privileges = yes
			NOT = { has_country_flag = remove_absolutism_from_investments hre_reform_passed = anbennar_imperial_wizards }
		}
		modifier = { max_absolutism = 1 }
	}
	land_share = 10
	is_valid = { NOT = { tag = I02 } is_in_mage_mode = yes }
	can_select = { is_in_mage_mode = yes at_least_magical_infrastructure_level_2 = yes }
	
	benefits = {
		mages_estate_experience_mod = 0.2
	}
	conditional_modifier = {
		trigger = { NOT = { has_country_flag = remove_tax_from_investments } }
		modifier = { global_tax_modifier = -0.1 }
		is_bad = yes
	}
	conditional_modifier = {
		trigger = { has_country_flag = remove_absolutism_from_investments }
		modifier = { max_absolutism = 5 }
	}
	conditional_modifier = {
		trigger = { mission_completed = F71_a_silent_strike }
		modifier = { governing_capacity_modifier = 0.05 }
	}
	conditional_modifier = { #eoa imperial wizards
		trigger = {
			hre_reform_passed = anbennar_imperial_wizards
			OR = { is_part_of_hre = yes tag = Z01 is_subject_of = Z01 }
		}
		modifier = { max_absolutism = 5 }
	}

	ai_will_do = {
		factor = 100
	}
}

estate_mages_mages_ascendant = {
	icon = privilege_puppet_ruler
	loyalty = -0.05
	influence = 0.05
	max_absolutism = -10
	conditional_modifier = {
		trigger = {
			has_absolutism_reduction_for_estate_privileges = yes
			NOT = { has_country_flag = remove_absolutism_from_ascendant }
		}
		modifier = { max_absolutism = 2 }
	}
	land_share = 10
	is_valid = { NOT = { tag = I02 } is_in_mage_mode = yes }
	can_select = { is_in_mage_mode = yes at_least_magical_infrastructure_level_3 = yes }
	on_granted = {
		custom_tooltip = tooltip_estate_mages_mages_ascendant
		custom_tooltip = higher_chance_of_powerful_mage_tt
	}
	conditional_modifier = {
		trigger = { has_country_flag = remove_absolutism_from_ascendant }
		modifier = { max_absolutism = 10 }
	}
	
	benefits = {
		mages_privilege_slots = 2
		monarch_spell_levels = 1
	}
	penalties = { yearly_corruption = 0.1 }

	ai_will_do = {
		factor = 0
	}
}

estate_mages_nexus_network = {
	icon = privilege_fort
	loyalty = -0.05
	influence = 0.05
	max_absolutism = -10
	conditional_modifier = {
		trigger = {
			has_absolutism_reduction_for_estate_privileges = yes
			NOT = { has_country_flag = remove_absolutism_from_nexus }
		}
		modifier = { max_absolutism = 2 }
	}
	land_share = 10
	is_valid = { NOT = { tag = I02 } is_in_mage_mode = yes }
	can_select = { is_in_mage_mode = yes at_least_magical_infrastructure_level_4 = yes }

	benefits = {
		mages_mana_regen = 0.25
		mages_mana_capacity = 50
	}
	conditional_modifier = {
		trigger = { has_country_flag = remove_absolutism_from_nexus }
		modifier = { max_absolutism = 5 }
	}

	penalties = { mages_monthly_experience = -2 }

	on_granted = { hidden_effect = { update_mana_regen_vars = yes change_mana = yes } }
	on_revoked = { hidden_effect = { update_mana_regen_vars = yes change_mana = yes } }
	on_invalid = { hidden_effect = { update_mana_regen_vars = yes change_mana = yes } }

	ai_will_do = {
		factor = 100
	}
}

##################
### MONOPOLIES ###
##################

##Slightly different, on not of
estate_mages_monopoly_of_damestear = {
	icon = privilege_monopoly_of_goods_damestear
	loyalty = 0.05
	max_absolutism = -10 #Seems high
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 2 } }
	is_valid = {
		always = yes
		has_dlc = "Emperor"
		NOT = { tag = I02 }
		damestear = 1
	}
	can_select = {
		custom_trigger_tooltip = {
			tooltip = unavailable_during_revolution_disaster
			NOT = { has_disaster = revolution }
			NOT = {
				has_disaster_progress = {
					disaster = revolution
					value = 1
				}
			}
		}
		custom_trigger_tooltip = {
			tooltip = JY_LF_not_trading #Anbennar
			NOT = { has_country_modifier = JY_LF_recent_trade }
		}
		NOT = { has_estate_privilege = estate_artificers_monopoly_of_damestear }
	}
	on_granted = {
		hidden_effect = { export_to_variable = { which = orig_treasury value = treasury } }
		add_years_of_owned_provinces_production_income = {
			years = 1
			trigger = { trade_goods = damestear }
			custom_tooltip = MONOPOLY_INCOME_DAMESTEAR_MANA_DESC
		}
		custom_tooltip = estate_mages_monopoly_of_damestear_effect_tooltip

		hidden_effect = {
			export_to_variable = { which = changed_treasury value = treasury }
			subtract_variable = { which = changed_treasury which = orig_treasury }
			if = {
				limit = { check_variable = { changed_treasury = 150 } }
				set_variable = { changed_treasury = 150 }
			}
			
			change_mana = { var_amount = changed_treasury }
			var_effect = { var = changed_treasury effect = add_treasury sign = - }
		}
	}
	on_granted_province = {
		if = {
			limit = { trade_goods = damestear }
			add_province_modifier = {
				name = estate_mages_monopoly_of_damestear_mod
				duration = -1
			}
		}
		else_if = {
			limit = { has_province_modifier = estate_mages_monopoly_of_damestear_mod }
			remove_province_modifier = estate_mages_monopoly_of_damestear_mod
		}
	}
	on_revoked = {
		custom_tooltip = estate_mages_monopoly_of_damestear_revoke_tooltip
	}
	on_revoked_province = {
		if = {
			limit = { has_province_modifier = estate_mages_monopoly_of_damestear_mod }
			remove_province_modifier = estate_mages_monopoly_of_damestear_mod
		}
	}
	on_invalid = {
		custom_tooltip = estate_mages_monopoly_of_damestear_revoke_tooltip
	}
	on_invalid_province = {
		if = {
			limit = { has_province_modifier = estate_mages_monopoly_of_damestear_mod }
			remove_province_modifier = estate_mages_monopoly_of_damestear_mod
		}
	}
	penalties = {
	}
	benefits = {
		mages_mana_regen = 0.1
	}
	cooldown_years = 10
	on_cooldown_expires = {
		country_event = { id = monopoly_privileges.12 }
	}
	ai_will_do = { #having the AI use these could lead to an unstoppable downwards spiral if it can't work out how to get rid of them
		factor = 0
	}
}

#Made precursor relics cause I could
estate_mages_monopoly_of_relics = {
	icon = privilege_monopoly_of_goods_precursor_relics
	loyalty = 0.05
	max_absolutism = -10 #Seems high
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 2 } }
	is_valid = {
		always = yes
		has_dlc = "Emperor"
		NOT = { tag = I02 }
		any_owned_province = {
			trade_goods = precursor_relics
		}
	}
	can_select = {
		custom_trigger_tooltip = {
			tooltip = unavailable_during_revolution_disaster
			NOT = { has_disaster = revolution }
			NOT = {
				has_disaster_progress = {
					disaster = revolution
					value = 1
				}
			}
		}
		custom_trigger_tooltip = {
			tooltip = JY_LF_not_trading #Anbennar
			NOT = { has_country_modifier = JY_LF_recent_trade }
		}
		NOT = { has_estate_privilege = estate_artificers_monopoly_of_relics }
	}
	on_granted = {
		hidden_effect = { export_to_variable = { which = orig_treasury value = treasury } }
		add_years_of_owned_provinces_production_income = {
			years = 1
			trigger = {
				trade_goods = precursor_relics
			}
			custom_tooltip = MONOPOLY_INCOME_PRECURSOR_RELICS_XP_DESC
		}
		custom_tooltip = estate_mages_monopoly_of_relics_effect_tooltip

		hidden_effect = {
			export_to_variable = { which = changed_treasury value = treasury }
			subtract_variable = { which = changed_treasury which = orig_treasury }
			if = {
				limit = { check_variable = { changed_treasury = 150 } }
				set_variable = { changed_treasury = 150 }
			}

			increase_magic_experience = { unmodified_var_amount = changed_treasury }
			var_effect = { var = changed_treasury effect = add_treasury sign = - }
		}
	}
	on_granted_province = {
		if = {
			limit = { trade_goods = precursor_relics }
			add_province_modifier = {
				name = estate_mages_monopoly_of_relics_mod
				duration = -1
			}
		}
		else_if = {
			limit = { has_province_modifier = estate_mages_monopoly_of_relics_mod }
			remove_province_modifier = estate_mages_monopoly_of_relics_mod
		}
	}
	on_revoked = {
		custom_tooltip = estate_mages_monopoly_of_relics_revoke_tooltip
	}
	on_revoked_province = {
		if = {
			limit = { has_province_modifier = estate_mages_monopoly_of_relics_mod }
			remove_province_modifier = estate_mages_monopoly_of_relics_mod
		}
	}
	on_invalid = {
		custom_tooltip = estate_mages_monopoly_of_relics_revoke_tooltip
	}
	on_invalid_province = {
		if = {
			limit = { has_province_modifier = estate_mages_monopoly_of_relics_mod }
			remove_province_modifier = estate_mages_monopoly_of_relics_mod
		}
	}
	penalties = {
	}
	benefits = {
		mages_ruler_experience_mod = 0.1
		mages_estate_experience_mod = 0.1
	}
	cooldown_years = 10
	on_cooldown_expires = {
		country_event = { id = monopoly_privileges.14 }
	}
	ai_will_do = { #having the AI use these could lead to an unstoppable downwards spiral if it can't work out how to get rid of them
		factor = 0
	}
}


##############################################
### REGIONAL/CULTURAL/RELIGIOUS PRIVILEGES ###
##############################################

estate_mages_monstrous_explorers = { #Monstrous
	icon = privilege_new_world_mission
	loyalty = 0.05
	influence = 0.1
	max_absolutism = -5
	conditional_modifier = { trigger = { has_absolutism_reduction_for_estate_privileges = yes } modifier = { max_absolutism = 1 } }
	
	is_valid = { has_country_modifier = monstrous_nation }
	can_select = {
		OR = {
			num_of_colonists = 1
			num_of_colonies = 1
		}
	}
	benefits = {
		may_explore = yes
		native_uprising_chance = -0.25
	}
	ai_will_do = {
		factor = 0
	}
}

estate_mages_soul_bound_weaponry = { #Shadow Pact
	icon = privilege_one_faith_one_culture
	influence = 0.1
	loyalty = 0.05
	is_valid = {
		religion = shadow_pact
		has_country_flag = shadow_warriors_soulforged_1
	}
	can_select = {
	}
	on_granted = {
		add_corruption = 1
		if = {
			limit = { has_country_flag = shadow_warriors_soulforged_2_2 }
			add_country_modifier = {
				name = shadow_warriors_soulforged_2_2
				duration = -1
			}
		}
		else_if = {
			limit = { has_country_flag = shadow_warriors_soulforged_2_1 }
			add_country_modifier = {
				name = shadow_warriors_soulforged_2_1
				duration = -1
			}
		}
		else = {
			add_country_modifier = {
				name = shadow_warriors_soulforged_1
				duration = -1
			}
		}
	}
	on_granted_province = {
	}
	on_revoked = {
		remove_country_modifier = shadow_warriors_soulforged_1
		remove_country_modifier = shadow_warriors_soulforged_2_1
		remove_country_modifier = shadow_warriors_soulforged_2_2
	}
	on_revoked_province = {
	}
	on_invalid = {
	}
	on_invalid_province = {
	}
	penalties = {
		yearly_corruption = 0.1
	}
	benefits = {
	}
	conditional_modifier = {
		trigger = { has_country_flag = shadow_warriors_soulforged_2_1 }
		modifier = {
			army_tradition = 1
		}
	}
	conditional_modifier = {
		trigger = { has_country_flag = shadow_warriors_soulforged_2_2 }
		modifier = {
			church_power_modifier = -0.15
		}
	}
	cooldown_years = 10
	ai_will_do = {
		factor = 10
#		modifier = {
#			factor = 0
#			
#		}
	}
}

# NOTE: this is a little experimental and hotfix-y, to prevent high-infamy rulers being griefed by high-infamy estates
# it may need to be revisited and potentially retuned in the future
estate_mages_endorse_corrupted_mages = {
	icon = privilege_cast_spell
	loyalty = 0
	influence = 0.05
	land_share = 5
	is_valid = {
		ruler_has_infamy_suspicious_or_worse = yes
	}
	can_select = {
		ruler_has_infamy_suspicious_or_worse = yes # for the tooltip
		estate_has_infamy_suspicious_or_worse = yes
		#NOT = { has_estate_privilege = estate_mages_expelling_corrupted_mages }
	}
	can_revoke = {
	}
	on_granted = {
		custom_tooltip = estate_mages_endorse_corrupted_mages_tt
	}
	on_invalid = {
	}
	on_revoked = {
		custom_tooltip = estate_mages_endorse_corrupted_mages_revoke_tt
	}
	conditional_modifier = {
		trigger = { type_has_infamy_suspicious = { type = country } }
		modifier = {
			mages_loyalty_modifier = 0.1 #as much as the suspicious loyalty debuff
			diplomatic_reputation = -1 # half as much as suspicious
		}
	}
	conditional_modifier = {
		trigger = { type_has_infamy_denounced = { type = country } }
		modifier = {
			mages_loyalty_modifier = 0.25 #as much as the denounced loyalty debuff
			diplomatic_reputation = -1.5 # half as much as denounced
		}
	}
	conditional_modifier = {
		trigger = { estate_has_infamy_witch_king = yes }
		modifier = {
			mages_loyalty_modifier = 0.5 #as much as the witch king loyalty debuff
			diplomatic_reputation = -2 # half as much as witch king
		}
	}
	# NOTE: if having the privilege negate the loyalty modifiers like this turns out to be too confusing,
	# or it would be preferred not to duplicate the loyalty modifiers in the estate loyalty breakdown,
	# this could instead by implemented via adding
	#NOT = { AND = { <has this privilege> <ruler is suspicious or worse> } }
	# to the triggers for the mage estate loyalty malus for suspicious+ instead
	
	benefits = {
		mages_ruler_experience_mod = 0.05
		mages_estate_experience_mod = 0.05
	}
	penalties = {
		all_estate_loyalty_equilibrium = -0.1
	}
	
	cooldown_years = 10

	ai_will_do = {
		factor = 0
	}
}

#Yudunyovi
estate_mages_dream_speakers = {
	icon = privilege_one_faith_one_culture
	loyalty = -0.1
	influence = 0.05
	
	is_valid = {
		religion = yudunyovi
	}

	can_select = {
		unlocked_yudunyovi_deity = { deity = soiti }
	}

	on_granted = {
		custom_tooltip = estate_mages_dream_speakers_tt
		if = {
			limit = { has_personal_deity = soiti }
			add_country_modifier = {
				name = yudunyovi_dream_speakers
				duration = 3650 #10 years
			}
		}
	}

	on_revoked = {
		remove_country_modifier = yudunyovi_dream_speakers
	}

	on_invalid = {
		remove_country_modifier = yudunyovi_dream_speakers
	}

	ai_will_do = {
		factor = 1
	}
}

sareyand_blazing_sun_academies = {
	icon = privilege_demand_more_troops
	influence = 0.1

	is_valid = {
		has_estate_privilege = sareyand_blazing_sun_academies
	}

	can_select = {
		always = yes
	}
	can_revoke = {
		always = no
	}

	influence_scaled_conditional_modifier = {
		trigger = {
			NOT = {
				estate_loyalty = {
					estate = estate_mages
					loyalty = 30
				}
			}
		}
		modifier = {
			land_maintenance_modifier = 0.30
			reinforce_speed = -0.15
		}
	}

	influence_scaled_conditional_modifier = {	#Modifier that are applied if the specified conditions are true. At 100% Influence you gain 100% of the modifier.
		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 30
			}
			NOT = {
				estate_loyalty = {
					estate = estate_mages
					loyalty = 60
				}
			}
		}
		modifier = {
			global_unrest = -1
			amount_of_samurai = 5
		}
	}
	influence_scaled_conditional_modifier = {	#Modifier that are applied if the specified conditions are true. At 100% Influence you gain 100% of the modifier.
		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 60
			}
		}
		modifier = {
			global_unrest = -3
			amount_of_samurai = 10
		}
	}

	on_granted = {
		custom_tooltip = tooltip_estate_mages_battlemage_academies
		enable_estate_action = { estate_action = RECRUIT_WAR_WIZARD }
	}

	on_revoked = {
		disable_estate_action = { estate_action = RECRUIT_WAR_WIZARD }
	}

	on_invalid = {
		disable_estate_action = { estate_action = RECRUIT_WAR_WIZARD }
	}

	ai_will_do = {
		factor = 6
	}	
}

estate_mages_train_rhaidd = {
	icon = privilege_demand_more_troops
	loyalty = 0.1
	influence = 0.1
	max_absolutism = -5

	can_select = {
		has_country_flag = I26_unlock_train_rhaidd_flag
	}
	is_valid = {
		has_country_flag = I26_unlock_train_rhaidd_flag
	}

	on_granted = {
		add_army_tradition = -15
		if = {
			limit = { has_estate_privilege = estate_nobles_noble_officer_right }
			remove_estate_privilege = estate_nobles_noble_officer_right
		}
	}
	benefits = {
		army_tradition = 0.5
		leader_land_shock = 1
		allowed_marine_fraction = 0.05
	}
	on_granted = {
		enable_estate_action = { estate_action = RECRUIT_RHAIDD }
	}
	on_revoked = {
		disable_estate_action = { estate_action = RECRUIT_RHAIDD }
	}
	on_invalid = {
		disable_estate_action = { estate_action = RECRUIT_RHAIDD }
	}

	ai_will_do = {
		factor = 0
	}
}

estate_mages_black_herd_shockshroud_mages = { #Black Herd
	icon = privilege_cast_spell
	loyalty = 0.1
	influence = 0.1
	
	is_valid = { has_country_flag = enable_shockshroud_mages_flag }
	on_granted = { custom_tooltip = shockshroud_mages_effect_tt }

	ai_will_do = { factor = 1 }
}
