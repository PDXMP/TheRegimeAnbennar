
###################
##NSC Incidents
###################

#-------------#NSC Incidents#--------------#

#UI spot 1 - Incidents on the same spot need to have mutually exclusive potentials
incident_bulwar_under_threat = {

	frame = 1
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		OR = {
			tag = F21 #Birsartanses
			tag = F25 #Sareyand
			tag = F34 #Azka-Evran
			tag = F37 #Irrliam
			tag = F42 #Varamhar
		}
	}

	trigger = {
		NOT = { is_year = 1446 }
	}

	immediate_effect = {
		if = { limit = { OR = { tag = F21 tag = F34 } }
			country_event = { id = new_sun_cult.49 }
		}
		else = {
			country_event = { id = new_sun_cult.50 }
		}
		set_country_flag = active_nsc_incident_flag
	}
}

incident_vassals_placeholder = {

	frame = 2
	variable_initial = 0

	potential = {
		always = no
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		OR = {
			tag = F33 #Akal�es
			tag = F40 #Anzabad
			tag = F35 #Azkabar
			tag = U19 #Aqatbahar
			tag = F24 #Brasan
			tag = F32 #Drolakand
			tag = F26 #Gelkalis
			tag = F44 #Kalib
			tag = F30 #Kumarkand
			tag = F41 #Zanbar
			tag = F43 #Zan�ap
		}
	}

	trigger = {
		always = no
	}

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

incident_naqtazan = {
	frame = 3
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		AND = {	# Causes errors without this extra scope
			tag = F39
			ai = no
		}
	}

	trigger = {
		NOT = { is_year = 1446 }
	}

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
		country_event = { id = flavour_bulwar_tag.5 }
	}
}

incident_half_a_king = {	#Azka-sur
	frame = 4
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		ruler_is_human = yes
		OR = {
			tag = U20
			AND = {
				tag = F52
				was_tag = U20
			}
		}
	}

	trigger = {
		mission_completed = U20_audience_hall
		government = monarchy
		has_regency = no
		has_government_attribute = heir
		NOT = { ruler_is_immortal = yes }
		is_incident_active = no
		custom_trigger_tooltip = {
			tooltip = nsc_5_years_since_last_incident_tt
			OR = {
				NOT = { has_country_flag = had_nsc_incident_flag }
				had_country_flag = { flag = had_nsc_incident_flag days = 1825 }
			}
		}
	}

	immediate_effect = {	
		country_event = { id = flavor_azka_sur.12 }
		set_country_flag = active_nsc_incident_flag
	}
}

incident_thirteenth_night = {
	frame = 5
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		AND = {	# Causes errors without this extra scope
			tag = F31
			ai = no
		}
	}

	trigger = {
		NOT = { is_year = 1446 }
	}

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
		country_event = { id = flavor_vacyn.12 }
	}
}

incident_elizna_placeholder = {

	frame = 6
	variable_initial = 0

	potential = {
		always = no
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		AND = { tag = U05 } #Elizna 	# Causes errors without this extra scope
		is_year = 1444
	}

	trigger = {
		always = no
	}

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

incident_trapped_in_shadows = {

	frame = 7
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		AND = {	# Causes errors without this extra scope
			ai = no
			tag = H66 #Jaherian Exemplars
		}
	}

	trigger = {
		has_country_flag = rezankand_jaherian_landing_flag
	}

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
		country_event = { id = flavor_rezankand.9 }
	}
}

#UI spot 2
incident_death_of_taelarios = {

	frame = 8
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		NOT = { capital_scope = { continent = south_america } }
		NOT = { capital_scope = { continent = north_america } }
		NOT = { has_global_flag = delete_bulwar_region }
	}

	trigger = {
		OR = {	
			F37 = { NOT = { has_ruler = "Taelarios I" } }
			NOT = { exists = F37 }
		}
		custom_trigger_tooltip = {
			tooltip = no_one_has_incident_active_tt
			NOT = {
				any_known_country = {
					is_incident_potential = incident_death_of_taelarios
					OR = {
						is_incident_active = yes
						AND = {
							ai = no
							NOT = { had_country_flag = { flag = had_nsc_incident_flag days = 1825 } }
						}
					}
				}
			}
		}
		custom_trigger_tooltip = {
			tooltip = nsc_5_years_since_last_incident_tt
			OR = {
				ai = yes
				NOT = { has_country_flag = had_nsc_incident_flag }
				had_country_flag = { flag = had_nsc_incident_flag days = 1825 }
			}
		}
		custom_trigger_tooltip = {
			tooltip = nsc_council_of_medurubar_has_started_tt
			NOT = { has_global_flag = taelarios_incident_happened }
		}
	}

	immediate_effect = {
		country_event = { id = new_sun_cult.125 days = 1 }
		set_country_flag = active_nsc_incident_flag
		REB = { 
			nsc_init_choice_variables_effect = yes
			set_variable = { which = nscUnityVar value = 0 }
		}
		hidden_effect = {
			F46 = {
				country_event = {
					id = bulwar_flavour.149
				}
			}
		}
	}
}

incident_one_sun = {

	frame = 9
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		has_country_flag = rezankand_one_sun_ready
	}

	trigger = {
	}

	mean_time_to_happen = { }

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

#UI spot 3
incident_summit_of_samartal = {

	frame = 10
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		NOT = { capital_scope = { continent = south_america } }
		NOT = { capital_scope = { continent = north_america } }
		NOT = { has_global_flag = delete_bulwar_region }
	}

	trigger = {
		custom_trigger_tooltip = {
			tooltip = no_one_has_incident_active_tt
			NOT = {
				any_known_country = {
					is_incident_potential = incident_summit_of_samartal
					OR = {
						is_incident_active = yes
						AND = {
							ai = no
							NOT = { had_country_flag = { flag = had_nsc_incident_flag days = 1825 } }
						}
					}
				}
			}
		}
		custom_trigger_tooltip = {
			tooltip = three_countries_eligible_for_samartal_tt
			calc_true_if = {
				all_known_country = {
					religion = bulwari_sun_cult
					is_subject = no
					OR = {
						is_incident_potential = incident_summit_of_samartal
						is_incident_active = incident_summit_of_samartal
					}
				}
				amount = 3
			}
		}
		custom_trigger_tooltip = {
			tooltip = nsc_summit_of_sammartal_started_tt
			NOT = { has_global_flag = nsc_summit_of_sammartal_started }
		}
		custom_trigger_tooltip = {
			tooltip = nsc_5_years_since_last_incident_tt
			OR = {
				ai = yes
				NOT = { has_country_flag = had_nsc_incident_flag }
				had_country_flag = { flag = had_nsc_incident_flag days = 1825 }
			}
		}
		custom_trigger_tooltip = {
			tooltip = nsc_samartal_tensions_100_tt
			REB = { check_variable = { nscTensionsVar = 100 } }
		}
		hidden_trigger = {
			OR = {
				has_global_flag = taelarios_incident_happened
				is_year = 1475
			}
		}
	}

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
		country_event = { id = new_sun_cult.170 }
	}
}

incident_aelantir_3_placeholder = {

	frame = 11
	variable_initial = 0

	potential = {
		always = no
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		OR = {
			capital_scope = { continent = south_america }
			capital_scope = { continent = north_america }
		}
	}

	trigger = {
		always = no
	}

	mean_time_to_happen = { }

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

#UI spot 4
incident_call_of_aelantir = {

	frame = 12
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		NOT = { capital_scope = { continent = south_america } }
		NOT = { capital_scope = { continent = north_america } }
		NOT = { has_global_flag = delete_bulwar_region }
		NOT = { has_global_flag = delete_north_aelantir }
	}

	trigger = {
		custom_trigger_tooltip = {
			tooltip = nsc_exemplars_have_departed_tt
			OR = {
				exists = H66
				exists = H67
			}
		}
		is_incident_active = no
		custom_trigger_tooltip = {
			tooltip = nsc_5_years_since_last_incident_tt
			OR = {
				NOT = { has_country_flag = had_nsc_incident_flag }
				had_country_flag = { flag = had_nsc_incident_flag days = 1825 }
			}
		}
	}

	immediate_effect = {
		country_event = { id = new_sun_cult.147 }
		set_country_flag = active_nsc_incident_flag
	}
}

incident_aelantir_4_placeholder = {

	frame = 13
	variable_initial = 0

	potential = {
		always = no
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		OR = {
			capital_scope = { continent = south_america }
			capital_scope = { continent = north_america }
		}
	}

	trigger = {
		always = no
	}

	mean_time_to_happen = { }

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

#UI spot 5
incident_ashes_of_the_phoenix = {

	frame = 14
	variable_initial = 0

	potential = {
		always = no
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		NOT = { capital_scope = { continent = south_america } }
		NOT = { capital_scope = { continent = north_america } }
	}

	trigger = {
		always = no
	}

	mean_time_to_happen = { }

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

incident_aelantir_5_placeholder = {

	frame = 15
	variable_initial = 0

	potential = {
		always = no
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		OR = {
			capital_scope = { continent = south_america }
			capital_scope = { continent = north_america }
		}
	}

	trigger = {
		always = no
	}

	mean_time_to_happen = { }

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

#UI spot 6
incident_silent_as_the_grave = {

	frame = 16
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		AND = { ai = no }	# Causes errors without this extra scope
		NOT = { capital_scope = { continent = south_america } }
		NOT = { capital_scope = { continent = north_america } }
		NOT = { has_global_flag = delete_bulwar_region }
	}

	trigger = {
		is_year = 1600
		custom_trigger_tooltip = {
			tooltip = nsc_own_province_in_amussu_grave_tt
			OR = {
				num_of_owned_provinces_with = { province_group = amussus_grave_surroundings value = 6 }
				has_country_flag = nsc_amussu_incident_can_start
			}
		}
		custom_trigger_tooltip = {
			tooltip = nsc_own_province_in_bulwar_tt
			OR = {
				num_of_owned_provinces_with = { superregion = bulwar_superregion value = 120 }
				has_country_flag = nsc_amussu_incident_can_start
			}
		}
		custom_trigger_tooltip = {
			tooltip = nsc_own_suran_provinces_tt
			OR = {
				suran_river = { type = all country_or_non_sovereign_subject_holds = ROOT }
				has_country_flag = nsc_amussu_incident_can_start
			}
		}
		custom_trigger_tooltip = {
			tooltip = nsc_amussu_has_awakened_tt
			has_country_flag = nsc_amussu_incident_can_start
		}
		is_incident_active = no
	}
	
	mean_time_to_happen = {
		months = 6
	}

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
		country_event = { id = new_sun_cult.265 }
	}
}

incident_aelantir_6_placeholder = {

	frame = 17
	variable_initial = 0

	potential = {
		always = no
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		OR = {
			capital_scope = { continent = south_america }
			capital_scope = { continent = north_america }
		}
	}

	trigger = {
		always = no
	}

	mean_time_to_happen = { }

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

#UI spot 7
incident_bulwar_7_placeholder = {

	frame = 18
	variable_initial = 0

	potential = {
		always = no
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		is_chosen_country = no
	}

	trigger = {
		always = no
	}

	mean_time_to_happen = {
		
	}

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

incident_aelantir_7_placeholder = {

	frame = 19
	variable_initial = 0

	potential = {
		always = no
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		OR = {
			capital_scope = { continent = south_america }
			capital_scope = { continent = north_america }
		}
	}

	trigger = {
		always = no
	}

	mean_time_to_happen = { }

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

#UI spot 8
incident_rise_of_artificery = {

	frame = 20
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		is_chosen_country = yes
	}

	trigger = {
		has_institution = manufactories
		is_incident_active = no
		custom_trigger_tooltip = {
			tooltip = nsc_5_years_since_last_incident_tt
			OR = {
				NOT = { has_country_flag = had_nsc_incident_flag }
				had_country_flag = { flag = had_nsc_incident_flag days = 1825 }
			}
		}
	}

	mean_time_to_happen = {
		months = 6
	}

	immediate_effect = {
		country_event = { id = new_sun_cult.195 }
		set_country_flag = active_nsc_incident_flag
	}
}

incident_spread_of_ravelianism = {

	frame = 21
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		is_chosen_country = no
	}

	trigger = {
		is_religion_enabled = ravelian
		if = {
			limit = {
				NOT = { capital_scope = { continent = south_america } }
				NOT = { capital_scope = { continent = north_america } }
			}
			custom_trigger_tooltip = {
				tooltip = nsc_lucian_carter_arrived_tt
				has_country_flag = nsc_lucian_carter_happened #Only countries in the old world will get the lucian carter flag
			}
		}
		is_incident_active = no
		custom_trigger_tooltip = {
			tooltip = nsc_5_years_since_last_incident_tt
			OR = {
				NOT = { has_country_flag = had_nsc_incident_flag }
				had_country_flag = { flag = had_nsc_incident_flag days = 1825 }
			}
		}
	}

	mean_time_to_happen = {
		months = 12
		modifier = {
			factor = 15
			NOT = { has_country_flag = nsc_lucian_carter_happened } #Incident takes 15 years to spawn for countries in Aelantir
		}
	}

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
		country_event = { id = new_sun_cult.210 }
	}
}

#UI spot 9
incident_elves_9_placeholder = {

	frame = 22
	variable_initial = 0

	potential = {
		always = no
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
	}

	trigger = {
		always = no
	}

	mean_time_to_happen = {
		
	}

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

incident_rebirth_magic = {

	frame = 23
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		is_chosen_country = no
	}

	trigger = {
		is_incident_active = no
		custom_trigger_tooltip = {
			tooltip = nsc_rebirth_magic_incident_tt
			has_country_flag = nsc_rebirth_magic_started
		}
	}

	mean_time_to_happen = { days = 30 }

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
		country_event = { id = new_sun_cult.242 } #The Grand Council of the Magi
	}
}

#UI spot 10
incident_whisper_shadows = {

	frame = 24
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		AND = {	# Causes errors without this extra scope
			tag = F30
			ai = no
		}
	}

	trigger = {
		NOT = { is_year = 1446 }
	}

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
		country_event = { id = flavor_kumarkand.71 }
		hidden_effect = {
			set_country_flag = kumarkand_ruler_start
		}
	}
}

incident_aelantir_10_placeholder = {

	frame = 25
	variable_initial = 0

	potential = {
		always = no
		has_dlc = "Mandate of Heaven"
		religion = bulwari_sun_cult
		OR = {
			capital_scope = { continent = south_america }
			capital_scope = { continent = north_america }
		}
	}

	trigger = {
		always = no
	}

	mean_time_to_happen = { }

	immediate_effect = {
		set_country_flag = active_nsc_incident_flag
	}
}

incident_rinta_dark_magic = {

	frame = 26
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = rinta_seekers
		NOT = { tag = S93 }
	}

	trigger = {
		if = {
			limit = { has_global_flag = rinta_seeker_dark_activated }
			always = yes
		}
		else = {
			is_year = 1550
			custom_trigger_tooltip = {
				tooltip = rinta_no_one_has_incident_active_tt
				NOT = {
					has_global_flag = incident_rinta_rise_of_the_adeen_ongoing_flag
					has_global_flag = incident_rinta_hunting_for_relics_ongoing_flag
					has_global_flag = incident_rinta_light_up_the_night_sky_ongoing_flag
					has_global_flag = incident_rinta_invention_of_artificery_ongoing_flag
					has_global_flag = incident_rinta_path_of_saaxir_ongoing_flag
				}
			}
			custom_trigger_tooltip = {
				tooltip = incident_rinta_dark_magic_trigger_tt
				OR = {
					estate_loyalty = {
					estate = estate_mages
					loyalty = 60
					}
					AND = {
						ruler_is_powerful_mage = yes
						OR = {
							is_ruler_necromancy_level_3 = yes
							is_ruler_abjuration_level_3 = yes
							is_ruler_evocation_level_3 = yes
						}
					}
					has_global_flag = incident_rinta_dark_magic_ongoing_flag
				}
			}
			is_subject = no
			num_of_cities = 8
		}
	}

	immediate_effect = {
		if = {
			limit = { has_global_flag = rinta_seeker_dark_activated }
			end_incident = incident_rinta_dark_magic
		}
		else = {
			country_event = {
				id = rinta_seeker_events.201
			}
			hidden_effect = {
				if = {
					limit = { NOT = { has_global_flag = incident_rinta_dark_magic_ongoing_flag } }
					set_global_flag = incident_rinta_dark_magic_ongoing_flag
					REB = {
						country_event = {
							id = rinta_seeker_events.200
							days = 10
						}
						country_event = {
							id = rinta_seeker_events.216
							days = 3650
						}
					}
				}
			}
		}	
	}
}

incident_rinta_rise_of_the_adeen = {

	frame = 27
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = rinta_seekers
		has_estate = estate_adeen
	}

	trigger = {
		if = {
			limit = { has_global_flag = rinta_seeker_adeen_activated }
			always = yes
		}
		else = {
			custom_trigger_tooltip = {
				tooltip = rinta_no_one_has_incident_active_tt
				NOT = {
					has_global_flag = incident_rinta_dark_magic_ongoing_flag
					has_global_flag = incident_rinta_hunting_for_relics_ongoing_flag
					has_global_flag = incident_rinta_light_up_the_night_sky_ongoing_flag
					has_global_flag = incident_rinta_invention_of_artificery_ongoing_flag
					has_global_flag = incident_rinta_path_of_saaxir_ongoing_flag
				}
			}
			custom_trigger_tooltip = {
				tooltip = adeen_enabled_happened_tt
				has_country_flag = adeen_enabled
			}
			custom_trigger_tooltip = {
				tooltip = incident_rinta_rise_adeen_trigger_tt
				OR = {
					AND = {
						land_forcelimit = 60
						num_of_marines = 25
					}
					AND = {
						land_forcelimit = 40
						estate_influence = {
							estate = estate_adeen
							influence = 60
						}
					}
					has_global_flag = incident_rinta_rise_of_the_adeen_ongoing_flag
				}
			}
			is_subject = no
			custom_trigger_tooltip = {
				tooltip = rinta_seeker_island_is_ours
				6040 = {
					owner = {
						religion = rinta_seekers
						NOT = { is_subject = yes }
					}
				}
			}
		}
	}

	immediate_effect = {
		if = {
			limit = { has_global_flag = rinta_seeker_adeen_activated }
			end_incident = incident_rinta_rise_of_the_adeen
		}
		else = {
			country_event = {
				id = rinta_seeker_events.305
			}
			hidden_effect = {
				if = {
					limit = { NOT = { has_global_flag = incident_rinta_rise_of_the_adeen_ongoing_flag } }
					REB = {
						country_event = {
							id = rinta_seeker_events.300
							days = 730
						}
					}
					set_global_flag = incident_rinta_rise_of_the_adeen_ongoing_flag
				}
			}
		}
	}
}
incident_rinta_hunting_for_relics = {

	frame = 28
	variable_initial = 0

	potential = {
		always = no #So it doesn't show up before it's added to avoid confusion

		has_dlc = "Mandate of Heaven"
		religion = rinta_seekers
	}

	trigger = {
		custom_trigger_tooltip = {
			tooltip = rinta_no_one_has_incident_active_tt
			NOT = {
				has_global_flag = incident_rinta_dark_magic_ongoing_flag
				has_global_flag = incident_rinta_rise_of_the_adeen_ongoing_flag
				has_global_flag = incident_rinta_light_up_the_night_sky_ongoing_flag
				has_global_flag = incident_rinta_invention_of_artificery_ongoing_flag
				has_global_flag = incident_rinta_path_of_saaxir_ongoing_flag
			}
		}
		always = no
	}

	mean_time_to_happen = { }

	immediate_effect = {
		set_global_flag = incident_rinta_hunting_for_relics_ongoing_flag
	}
}
incident_rinta_light_up_the_night_sky = {

	frame = 29
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = rinta_seekers
	}

	trigger = {
		if = {
			limit = { has_global_flag = incident_rinta_light_up_the_night_sky_end_flag }
			always = yes
		}
		else = {
			custom_trigger_tooltip = {
				tooltip = rinta_no_one_has_incident_active_tt
				NOT = {
					has_global_flag = incident_rinta_dark_magic_ongoing_flag
					has_global_flag = incident_rinta_rise_of_the_adeen_ongoing_flag
					has_global_flag = incident_rinta_hunting_for_relics_ongoing_flag
					has_global_flag = incident_rinta_light_up_the_night_sky_ongoing_flag
					has_global_flag = incident_rinta_invention_of_artificery_ongoing_flag
					has_global_flag = incident_rinta_path_of_saaxir_ongoing_flag
				}
			}
			custom_trigger_tooltip = {
				tooltip = incident_rinta_night_sky_trigger_tt
				OR = {
					has_global_flag = incident_rinta_light_up_the_night_sky_start_flag
					AND = {
						innovativeness = 50
						has_institution = printing_press
					}
				}
			}
		}
	}

	immediate_effect = {
		set_global_flag = incident_rinta_light_up_the_night_sky_start_flag
		if = {
			limit = { has_global_flag = incident_rinta_light_up_the_night_sky_end_flag }
			end_incident = incident_rinta_light_up_the_night_sky
		}
		else = {
			country_event = {
				id = rinta_seeker_events.500 #Background Setup Event
				days = 1
			}
			country_event = {
				id = rinta_seeker_events.501 #Intro Event
				days = 2
			}
		}
	}
}
incident_rinta_invention_of_artificery = {

	frame = 30
	variable_initial = 0

	potential = {
		always = no #So it doesn't show up before it's added to avoid confusion
		
		has_dlc = "Mandate of Heaven"
		religion = rinta_seekers
	}

	trigger = {
		custom_trigger_tooltip = {
			tooltip = rinta_no_one_has_incident_active_tt
			NOT = {
				has_global_flag = incident_rinta_dark_magic_ongoing_flag
				has_global_flag = incident_rinta_rise_of_the_adeen_ongoing_flag
				has_global_flag = incident_rinta_hunting_for_relics_ongoing_flag
				has_global_flag = incident_rinta_light_up_the_night_sky_ongoing_flag
				has_global_flag = incident_rinta_path_of_saaxir_ongoing_flag
			}
		}
		always = no
	}

	mean_time_to_happen = { }

	immediate_effect = {
		set_global_flag = incident_rinta_invention_of_artificery_ongoing_flag
	}
}
incident_rinta_path_of_saaxir = {

	frame = 31
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = rinta_seekers
	}

	trigger = {
		if = {
			limit = { has_global_flag = rinta_seeker_saaxir_activated }
			always = yes
		}
		else = {
			custom_trigger_tooltip = {
				tooltip = rinta_no_one_has_incident_active_tt
				NOT = {
					has_global_flag = incident_rinta_dark_magic_ongoing_flag
					has_global_flag = incident_rinta_rise_of_the_adeen_ongoing_flag
					has_global_flag = incident_rinta_hunting_for_relics_ongoing_flag
					has_global_flag = incident_rinta_light_up_the_night_sky_ongoing_flag
				}
			}
			is_year = 1445
		}
	}

	mean_time_to_happen = { }

	immediate_effect = {
		if = {
			limit = { has_global_flag = rinta_seeker_saaxir_activated }
			end_incident = incident_rinta_path_of_saaxir
		}
		else = {
			country_event = {
				id = rinta_seeker_events.601
			}
			set_global_flag = incident_rinta_path_of_saaxir_ongoing_flag
		}
	}
}

##############################
## Volcanic Truth Incidents ##
##############################

# We want these to be "global", happening at the same time for all VT countries
# For the icons, rather than creating placeholder ones, I am re-using existing ones to save us changing
# the image another time in the repo

incident_volcanic_organizational_crisis = {

	frame = 1
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = volcanic_truth
	}

	trigger = {
		# We'll use the same pattern on all of these VT incidents - check if the global flags for _active or _finished
		# are set, and if so, start the incident immediately. If not, check the normal conditions, and the first
		# country to see them as true will set the _active flag
		if = {
			limit = {
				NOT = {
					has_global_flag = vt_incident_organizational_crisis_active
					has_global_flag = vt_incident_organizational_crisis_finished
				}
			}
			custom_trigger_tooltip = {
				tooltip = volcanic_no_one_has_incident_active_tt
				# Make sure there are no other incidents happening to anyone at the same time
				NOT = { has_global_flag = vt_incident_taga_ala_influence_active }
				NOT = { has_global_flag = vt_incident_mass_eruption_active }
				NOT = { has_global_flag = vt_incident_weakening_of_the_kiamoa_active }
				NOT = { has_global_flag = vt_incident_the_molten_eternity_active }
				NOT = { has_global_flag = vt_incident_a_dragon_turtles_place_active }
				NOT = { has_global_flag = vt_incident_mechanim_awakening_active }
				# Either enough time has passed since the start of the last incident, or we are in the middle of this incident,
				# or the incident is over for everyone
				# This matters because the first country to start the incident adds the modifier, and also a country might
				# convert to VT during the incident
				OR = {
					had_global_flag = {
						flag = vt_wait_a_few_years_for_next_incident
						days = 4500 #at least 12 years 120 days between incidents
					}
					NOT = { has_global_flag = vt_wait_a_few_years_for_next_incident } #Since we don't start with the flag
				}
			}
			OR = {
				custom_trigger_tooltip = {
					tooltip = vt_twin_under_proper_governance_tt.1
					# Either one tag with the reform owns both, or neither are owned by a tag with the reform
					6181 = {
						owner = {
							owns = 6182
							has_reform = cuahu_teotlehu_reform
						}
					}
				}
				custom_trigger_tooltip = {
					tooltip = vt_twin_under_proper_governance_tt.2
					6181 = { owner = { NOT = { has_reform = cuahu_teotlehu_reform } } }
					6182 = { owner = { NOT = { has_reform = cuahu_teotlehu_reform } } }
				}
			}
		}
	}

	mean_time_to_happen = { }

	immediate_effect = {
		hidden_effect = {
			if = { # If the incident is already over globally, no event popups - just end it. This can happen if you convert to VT late.
				limit = { has_global_flag = vt_incident_organizational_crisis_finished }
				end_incident = incident_volcanic_organizational_crisis
			}
			else_if = { # If someone else has already started it, just give me the popup explaining what's happening.
						# This should be for every VT coutry except the first to trigger
				limit = { has_global_flag = vt_incident_organizational_crisis_active }
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
			}
			else = { # Otherwise, no-one has started the event, so trigger the control event and set the right flags
				set_global_flag = vt_incident_organizational_crisis_active
				clr_global_flag = vt_wait_a_few_years_for_next_incident
				set_global_flag = vt_wait_a_few_years_for_next_incident #forced delay between incidents
				6162 = {
					# This resets the variables and sets off other events for voting and the results
					province_event = {
						id = volcanic_truth.1
						days = 1
					}
				}
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
				# The owner(s) of these provinces receives an informative warning if they are not Volcanic Truth
				6181 = { #Muatlaqua
					owner = {
						country_event = {
							id = volcanic_truth.102
						}
					}
				}
				6182 = { #Quahopilo
					owner = {
						country_event = {
							id = volcanic_truth.102
						}
					}
				}
			}
			
		}
		
	}
}

incident_volcanic_taga_ala_influence = {

	frame = 3
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = volcanic_truth
	}

	trigger = {
		# For this incident, since the check about the mangroves is quite expensive, we'll have an outer OR
		# for a quick check if anyone has started the incident, and the any_known_country stuff will only
		# check your own knowledge
		if = {
			limit = {
				NOT = {
					has_global_flag = vt_incident_taga_ala_influence_active
					has_global_flag = vt_incident_taga_ala_influence_finished
				}
			}
			custom_trigger_tooltip = {
				tooltip = volcanic_no_one_has_incident_active_tt
				NOT = { has_global_flag = vt_incident_organizational_crisis_active }
				NOT = { has_global_flag = vt_incident_mass_eruption_active }
				NOT = { has_global_flag = vt_incident_weakening_of_the_kiamoa_active }
				NOT = { has_global_flag = vt_incident_the_molten_eternity_active }
				NOT = { has_global_flag = vt_incident_a_dragon_turtles_place_active }
				NOT = { has_global_flag = vt_incident_mechanim_awakening_active }
				# Either enough time has passed since the start of the last incident, or we are in the middle of this incident,
				# or the incident is over for everyone
				# This matters because the first country to start the incident adds the modifier, and also a country might
				# convert to VT during the incident
				OR = {
					had_global_flag = {
						flag = vt_wait_a_few_years_for_next_incident
						days = 4500 #at least 12 years 120 days between incidents
					}
					NOT = { has_global_flag = vt_wait_a_few_years_for_next_incident } #Since we don't start with the flag
				}
			}
			# A VT country can either see a "Mangrove Republic" country, or
			# the whole mangrove region is discovered
			custom_trigger_tooltip = {
				tooltip = vt_tagaala_influence_condition_tt.1
				OR = {
					any_known_country = {
						culture_group = tagaala
					}
					tagaala_mangroves_region = {
						type = all
						has_discovered = PREV
					}
				}
			}
			# A VT country has a 5% trade share in Fave Tasaai
			custom_trigger_tooltip = {
				tooltip = vt_tagaala_influence_condition_tt.2
				OR = {
					any_known_country = {
						religion = volcanic_truth
						3572 = { # Fave Tasaai trade node
							trade_share = {
								country = PREV
								share = 5
							}
						}
					}
					# Of course, any_known_country doesn't include the one actually checking this...
					3572 = { # Fave Tasaai trade node
						trade_share = {
							country = ROOT
							share = 5
						}
					}
				}
			}
		}
	}

	mean_time_to_happen = { }

	immediate_effect = {
		hidden_effect = {
			if = { # If the incident is already over globally, no event popups - just end it. This can happen if you convert to VT late.
				limit = { has_global_flag = vt_incident_taga_ala_influence_finished }
				end_incident = incident_volcanic_taga_ala_influence
			}
			else_if = { # If someone else has already started it, just give me the popup explaining what's happening.
						# This should be for every VT coutry except the first to trigger
				limit = { has_global_flag = vt_incident_taga_ala_influence_active }
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
			}
			else = { # Otherwise, no-one has started the event, so trigger the control event and set the right flags
				set_global_flag = vt_incident_taga_ala_influence_active
				clr_global_flag = vt_wait_a_few_years_for_next_incident
				set_global_flag = vt_wait_a_few_years_for_next_incident #forced delay between incidents
				6162 = {
					# This resets the variables and sets off other events for voting and the results
					province_event = {
						id = volcanic_truth.1
						days = 1
					}
				}
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
			}
		}
	}
}

# This incident is a little different as there is no voting, so we don't call volcanic_truth.1
incident_volcanic_mass_eruption_of_the_twin_gods = {

	frame = 4
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = volcanic_truth
	}

	trigger = {
		if = {
			limit = {
				NOT = {
					has_global_flag = vt_incident_mass_eruption_active
					has_global_flag = vt_incident_mass_eruption_finished
				}
			}
			custom_trigger_tooltip = {
				tooltip = volcanic_no_one_has_incident_active_tt
				NOT = { has_global_flag = vt_incident_organizational_crisis_active }
				NOT = { has_global_flag = vt_incident_taga_ala_influence_active }
				NOT = { has_global_flag = vt_incident_weakening_of_the_kiamoa_active }
				NOT = { has_global_flag = vt_incident_the_molten_eternity_active }
				NOT = { has_global_flag = vt_incident_a_dragon_turtles_place_active }
				NOT = { has_global_flag = vt_incident_mechanim_awakening_active }
				# Either enough time has passed since the start of the last incident, or we are in the middle of this incident,
				# or the incident is over for everyone
				# This matters because the first country to start the incident adds the modifier, and also a country might
				# convert to VT during the incident
				OR = {
					had_global_flag = {
						flag = vt_wait_a_few_years_for_next_incident
						days = 4500 #at least 12 years 120 days between incidents
					}
					NOT = { has_global_flag = vt_wait_a_few_years_for_next_incident } #Since we don't start with the flag
				}
			}
			custom_trigger_tooltip = {
				tooltip = vt_twin_god_eruption_trigger_tt
				has_global_flag = vt_twin_god_eruption_flag
			}
		}
	}

	mean_time_to_happen = { }

	immediate_effect = {
		hidden_effect = {
			if = { # If the incident is already over globally, no event popups - just end it. This can happen if you convert to VT late.
				limit = { has_global_flag = vt_incident_mass_eruption_finished }
				end_incident = incident_volcanic_mass_eruption_of_the_twin_gods
			}
			else_if = { # If someone else has already started it, just give me the popup explaining what's happening.
						# This should be for every VT coutry except the first to trigger
				limit = { has_global_flag = vt_incident_mass_eruption_active }
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
				country_event = {
					id = volcanic_truth.300
					days = 200
				}
			}
			else = { # Otherwise, no-one has started the event, so trigger the control event and set the right flags
				set_global_flag = vt_incident_mass_eruption_active
				clr_global_flag = vt_wait_a_few_years_for_next_incident
				set_global_flag = vt_wait_a_few_years_for_next_incident #forced delay between incidents
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
				country_event = {
					id = volcanic_truth.300
					days = 200
				}
			}
		}
	}
}

incident_volcanic_weakening_of_the_kiamoa = {

	frame = 5
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = volcanic_truth
	}

	trigger = {
		if = {
			limit = {
				NOT = {
					has_global_flag = vt_incident_weakening_of_the_kiamoa_active
					has_global_flag = vt_incident_weakening_of_the_kiamoa_finished
				}
			}
			custom_trigger_tooltip = {
				tooltip = volcanic_no_one_has_incident_active_tt
				NOT = { has_global_flag = vt_incident_organizational_crisis_active }
				NOT = { has_global_flag = vt_incident_taga_ala_influence_active }
				NOT = { has_global_flag = vt_incident_mass_eruption_active }
				NOT = { has_global_flag = vt_incident_the_molten_eternity_active }
				NOT = { has_global_flag = vt_incident_a_dragon_turtles_place_active }
				NOT = { has_global_flag = vt_incident_mechanim_awakening_active }
				# Either enough time has passed since the start of the last incident, or we are in the middle of this incident,
				# or the incident is over for everyone
				# This matters because the first country to start the incident adds the modifier, and also a country might
				# convert to VT during the incident
				OR = {
					had_global_flag = {
						flag = vt_wait_a_few_years_for_next_incident
						days = 4500 #at least 12 years 120 days between incidents
					}
					NOT = { has_global_flag = vt_wait_a_few_years_for_next_incident } #Since we don't start with the flag
				}
			}
			custom_trigger_tooltip = {
				tooltip = vt_kiamoa_opend_incident_trigger_tt
				has_global_flag = stormwall_open
			}
		}
	}

	mean_time_to_happen = { }

	immediate_effect = {
		hidden_effect = {
			if = { # If the incident is already over globally, no event popups - just end it. This can happen if you convert to VT late.
				limit = { has_global_flag = vt_incident_weakening_of_the_kiamoa_finished }
				end_incident = incident_volcanic_weakening_of_the_kiamoa
			}
			else_if = { # If someone else has already started it, just give me the popup explaining what's happening.
						# This should be for every VT coutry except the first to trigger
				limit = { has_global_flag = vt_incident_weakening_of_the_kiamoa_active }
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
			}
			else = { # Otherwise, no-one has started the event, so trigger the control event and set the right flags
				set_global_flag = vt_incident_weakening_of_the_kiamoa_active
				clr_global_flag = vt_wait_a_few_years_for_next_incident
				set_global_flag = vt_wait_a_few_years_for_next_incident #forced delay between incidents
				6162 = {
					# This resets the variables and sets off other events for voting and the results
					province_event = {
						id = volcanic_truth.1
						days = 1
					}
				}
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
			}
		}
	}
}

incident_volcanic_the_molten_eternity = {

	frame = 7
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = volcanic_truth
	}

	trigger = {
		if = {
			limit = {
				NOT = {
					has_global_flag = vt_incident_the_molten_eternity_active
					has_global_flag = vt_incident_the_molten_eternity_finished
				}
			}
			custom_trigger_tooltip = {
				tooltip = volcanic_no_one_has_incident_active_tt
				NOT = { has_global_flag = vt_incident_organizational_crisis_active }
				NOT = { has_global_flag = vt_incident_taga_ala_influence_active }
				NOT = { has_global_flag = vt_incident_mass_eruption_active }
				NOT = { has_global_flag = vt_incident_weakening_of_the_kiamoa_active }
				NOT = { has_global_flag = vt_incident_a_dragon_turtles_place_active }
				NOT = { has_global_flag = vt_incident_mechanim_awakening_active }
				# Either enough time has passed since the start of the last incident, or we are in the middle of this incident,
				# or the incident is over for everyone
				# This matters because the first country to start the incident adds the modifier, and also a country might
				# convert to VT during the incident
				OR = {
					had_global_flag = {
						flag = vt_wait_a_few_years_for_next_incident
						days = 4500 #at least 12 years 120 days between incidents
					}
					NOT = { has_global_flag = vt_wait_a_few_years_for_next_incident } #Since we don't start with the flag
				}
			}
			is_religion_enabled = molten_eternity # See event great_plateau_colonization.6
		}
	}

	mean_time_to_happen = { }

	immediate_effect = {
		hidden_effect = {
			if = { # If the incident is already over globally, no event popups - just end it. This can happen if you convert to VT late.
				limit = { has_global_flag = vt_incident_the_molten_eternity_finished }
				end_incident = incident_volcanic_the_molten_eternity
			}
			else_if = { # If someone else has already started it, just give me the popup explaining what's happening.
						# This should be for every VT coutry except the first to trigger
				limit = { has_global_flag = vt_incident_the_molten_eternity_active }
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
			}
			else = { # Otherwise, no-one has started the event, so trigger the control event and set the right flags
				set_global_flag = vt_incident_the_molten_eternity_active
				clr_global_flag = vt_wait_a_few_years_for_next_incident
				set_global_flag = vt_wait_a_few_years_for_next_incident #forced delay between incidents
				6162 = {
					# This resets the variables and sets off other events for voting and the results
					province_event = {
						id = volcanic_truth.1
						days = 1
					}
				}
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
			}
		}
	}
}

# No content or triggers yet
incident_volcanic_a_dragon_turtles_place = {

	frame = 8
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = volcanic_truth
	}

	trigger = {
		custom_trigger_tooltip = {
			tooltip = vt_sufficient_dragon_turtles_tt
			always = no
		}
	}

	mean_time_to_happen = { }

	immediate_effect = {
		hidden_effect = {
			end_incident = incident_volcanic_a_dragon_turtles_place
		}
	}
}

incident_volcanic_mechanim_awakening = {

	frame = 9
	variable_initial = 0

	potential = {
		has_dlc = "Mandate of Heaven"
		religion = volcanic_truth
	}

	trigger = {
		if = {
			limit = {
				NOT = {
					has_global_flag = vt_incident_mechanim_awakening_active
					has_global_flag = vt_incident_mechanim_awakening_finished
				}
			}
			custom_trigger_tooltip = {
				tooltip = volcanic_no_one_has_incident_active_tt
				NOT = { has_global_flag = vt_incident_organizational_crisis_active }
				NOT = { has_global_flag = vt_incident_taga_ala_influence_active }
				NOT = { has_global_flag = vt_incident_mass_eruption_active }
				NOT = { has_global_flag = vt_incident_weakening_of_the_kiamoa_active }
				NOT = { has_global_flag = vt_incident_the_molten_eternity_active }
				NOT = { has_global_flag = vt_incident_a_dragon_turtles_place_active }
				# Either enough time has passed since the start of the last incident, or we are in the middle of this incident,
				# or the incident is over for everyone
				# This matters because the first country to start the incident adds the modifier, and also a country might
				# convert to VT during the incident
				OR = {
					had_global_flag = {
						flag = vt_wait_a_few_years_for_next_incident
						days = 4500 #at least 12 years 120 days between incidents
					}
					NOT = { has_global_flag = vt_wait_a_few_years_for_next_incident } #Since we don't start with the flag
				}
			}
			is_year = 1490
			custom_trigger_tooltip = {
				tooltip = vt_arrival_of_the_mechanim_tt
				has_global_flag = vt_arrival_of_the_mechanim_flag
			}
		}
	}

	mean_time_to_happen = { }

	immediate_effect = {
		hidden_effect = {
			if = { # If the incident is already over globally, no event popups - just end it. This can happen if you convert to VT late.
				limit = { has_global_flag = vt_incident_mechanim_awakening_finished }
				end_incident = incident_volcanic_mechanim_awakening
			}
			else_if = { # If someone else has already started it, just give me the popup explaining what's happening.
						# This should be for every VT coutry except the first to trigger
				limit = { has_global_flag = vt_incident_mechanim_awakening_active }
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
			}
			else = { # Otherwise, no-one has started the event, so trigger the control event and set the right flags
				set_global_flag = vt_incident_mechanim_awakening_active
				clr_global_flag = vt_wait_a_few_years_for_next_incident
				set_global_flag = vt_wait_a_few_years_for_next_incident #forced delay between incidents
				6162 = {
					# This resets the variables and sets off other events for voting and the results
					province_event = {
						id = volcanic_truth.1
						days = 1
					}
				}
				country_event = {
					id = volcanic_truth.5 #Different loc depending on the incident
				}
			}
		}
	}
}